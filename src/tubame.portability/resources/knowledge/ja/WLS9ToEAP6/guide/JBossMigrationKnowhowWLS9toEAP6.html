<HTML xmlns:knowhow="http://generated.model.biz.knowhow.tubame/knowhow" xmlns:doc="http://docbook.org/ns/docbook">
<HEAD>
<META http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Weblogic9からJBossEAP6へのマイグレーションガイド</title>
<link href="css/knowhow.css" type="text/css" rel="stylesheet">
<meta content="DocBook XSL Stylesheets V1.78.1" name="generator">
</HEAD>
<BODY>
<H1 class="title">Weblogic9からJBossEAP6へのマイグレーションガイド</H1>
<div class="toc">
<p>
<b>Index</b>
</p>
<dl class="toc">
<dt>
<span class="1."><a href="#tubame_1.">1.アプリケーションの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.1."><a href="#tubame_1.1.">1.1.J2EE非推奨APIについて</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.1.1."><a href="#tubame_1.1.1.">1.1.1.Servletの非推奨APIについて</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.1.1.1."><a href="#tubame_1.1.1.1.">1.1.1.1.Servlet2.5で既に非推奨となる機能</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.1.1.2."><a href="#tubame_1.1.1.2.">1.1.1.2.Servlet3.0で非推奨となる機能</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.1.2."><a href="#tubame_1.1.2.">1.1.2.Servlet以外の非推奨API</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.1.2.1."><a href="#tubame_1.1.2.1.">1.1.2.1.JAXB非推奨API</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.1.2.2."><a href="#tubame_1.1.2.2.">1.1.2.2.JSF非推奨API</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.1.2.3."><a href="#tubame_1.1.2.3.">1.1.2.3.EJB非推奨API</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.1.2.4."><a href="#tubame_1.1.2.4.">1.1.2.4.JCA非推奨API</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.1.2.5."><a href="#tubame_1.1.2.5.">1.1.2.5.SOAP及びJWS非推奨API</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.1.2.6."><a href="#tubame_1.1.2.6.">1.1.2.6.Deployment 及びActivation API</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.2."><a href="#tubame_1.2.">1.2.JSPの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.2.1."><a href="#tubame_1.2.1.">1.2.1.WebLogic固有タグの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.2.1.1."><a href="#tubame_1.2.1.1.">1.2.1.1.cacheタグ</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.2.1.2."><a href="#tubame_1.2.1.2.">1.2.1.2.processタグ</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.2.1.3."><a href="#tubame_1.2.1.3.">1.2.1.3.repeatタグ</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.2.2."><a href="#tubame_1.2.2.">1.2.2.暗黙的にimportされるパッケージ</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.2.3."><a href="#tubame_1.2.3.">1.2.3.JSPでのnullと空文字列の表示について</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.2.4."><a href="#tubame_1.2.4.">1.2.4.セッションのハンドリングについて</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.2.5."><a href="#tubame_1.2.5.">1.2.5.JSPファイルヘッダのtaglibの宣言について</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.2.6."><a href="#tubame_1.2.6.">1.2.6.UseBeanのgetProperty及びsetProperty利用時の移植</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.3."><a href="#tubame_1.3.">1.3.Servetの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.3.1."><a href="#tubame_1.3.1.">1.3.1.WebLogic Servlet APIの移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.4."><a href="#tubame_1.4.">1.4.JNDIの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.4.1."><a href="#tubame_1.4.1.">1.4.1.JNDI名の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.4.2."><a href="#tubame_1.4.2.">1.4.2.JNDIルックアップの呼び出し実装の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.4.2.1."><a href="#tubame_1.4.2.1.">1.4.2.1.APサーバのコンテナ内のJNDIルックアップ呼び出し</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.4.2.2."><a href="#tubame_1.4.2.2.">1.4.2.2.APサーバのコンテナ外のJNDIルックアップ呼び出し</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5."><a href="#tubame_1.5.">1.5.EJBの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.5.1."><a href="#tubame_1.5.1.">1.5.1.デプロイメントデスクリプタの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.5.1.1."><a href="#tubame_1.5.1.1.">1.5.1.1.StatelessSessionBeanの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.5.1.1.1."><a href="#tubame_1.5.1.1.1.">1.5.1.1.1.SLSBデプロイメントディスクリプタ定義の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.1.2."><a href="#tubame_1.5.1.1.2.">1.5.1.1.2.SLSBインスタンスプール関連タグの移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.1.3."><a href="#tubame_1.5.1.1.3.">1.5.1.1.3.SLSBクラスタリング関連タグの変換方法</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.2."><a href="#tubame_1.5.1.2.">1.5.1.2.StatefullSessionBeanの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.5.1.2.1."><a href="#tubame_1.5.1.2.1.">1.5.1.2.1.SFSBデプロイメントディスクリプタ定義の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.2.2."><a href="#tubame_1.5.1.2.2.">1.5.1.2.2.SFSBインスタンスキャッシュ関連タグの変換方法</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.2.3."><a href="#tubame_1.5.1.2.3.">1.5.1.2.3.SFSBクラスタリング関連タグの変換方法</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3."><a href="#tubame_1.5.1.3.">1.5.1.3.EntityBeanの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.5.1.3.1."><a href="#tubame_1.5.1.3.1.">1.5.1.3.1.EntityBeanデプロイメントディスクリプタ定義の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.5.1.3.1.1."><a href="#tubame_1.5.1.3.1.1.">1.5.1.3.1.1.デプロイメントディスクリプタ定義の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3.1.2."><a href="#tubame_1.5.1.3.1.2.">1.5.1.3.1.2.EJBインスタンスプール関連タグの移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3.1.3."><a href="#tubame_1.5.1.3.1.3.">1.5.1.3.1.3.EJBインスタンスキャッシュ関連タグの変換方法</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3.1.4."><a href="#tubame_1.5.1.3.1.4.">1.5.1.3.1.4.EntityBeanの永続化設定の変換方法</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3.1.5."><a href="#tubame_1.5.1.3.1.5.">1.5.1.3.1.5.クラスタリング関連タグの変換方法</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3.2."><a href="#tubame_1.5.1.3.2.">1.5.1.3.2.CMP用のデプロイメントディスクリプタ定義の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.5.1.3.2.1."><a href="#tubame_1.5.1.3.2.1.">1.5.1.3.2.1.datasource関連タグ及び、enterprise-beans関連タグへの変換方法</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3.2.2."><a href="#tubame_1.5.1.3.2.2.">1.5.1.3.2.2.CMP(Container-Managed Persistence)フィールド宣言タグの変換方法</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3.2.3."><a href="#tubame_1.5.1.3.2.3.">1.5.1.3.2.3.CMR(Container-Managed Relationships)関連タグの変換方法</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3.2.4."><a href="#tubame_1.5.1.3.2.4.">1.5.1.3.2.4.プライマリキー生成関連タグの変換方法</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3.2.5."><a href="#tubame_1.5.1.3.2.5.">1.5.1.3.2.5.テーブルの自動作成・削除の宣言タグの変換方法</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3.2.6."><a href="#tubame_1.5.1.3.2.6.">1.5.1.3.2.6.EJB-QL宣言タグの変換方法</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3.2.7."><a href="#tubame_1.5.1.3.2.7.">1.5.1.3.2.7.EJB CMP Bean変換の全体例</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.3.2.8."><a href="#tubame_1.5.1.3.2.8.">1.5.1.3.2.8.EntityBeanのインサート遅延設定の移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.4."><a href="#tubame_1.5.1.4.">1.5.1.4.MessageDrivenBeanの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.5.1.4.1."><a href="#tubame_1.5.1.4.1.">1.5.1.4.1.MDBデプロイメントディスクリプタ定義の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.4.2."><a href="#tubame_1.5.1.4.2.">1.5.1.4.2.destinationJNDI名の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.4.3."><a href="#tubame_1.5.1.4.3.">1.5.1.4.3.MDBインスタンスプール関連タグの移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.5."><a href="#tubame_1.5.1.5.">1.5.1.5.トランザクション関連の設定</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.5.1.5.1."><a href="#tubame_1.5.1.5.1.">1.5.1.5.1.トランザクション関連タグの変換方法</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.5.1.6."><a href="#tubame_1.5.1.6.">1.5.1.6.参照渡し及び値渡し設定</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.6."><a href="#tubame_1.6.">1.6.Webサービスのサーバ移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.6.1."><a href="#tubame_1.6.1.">1.6.1.WebLogicのWebサービス特徴</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.6.2."><a href="#tubame_1.6.2.">1.6.2.JAVA実装のWebサービス（JAX-RPC仕様）への移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.6.3."><a href="#tubame_1.6.3.">1.6.3.JAVA実装のWebサービス（JAX-WS仕様）への移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.6.4."><a href="#tubame_1.6.4.">1.6.4.EJB実装のWebサービス（JAX-RPC仕様）への移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.6.5."><a href="#tubame_1.6.5.">1.6.5.EJB実装のWebサービス（JAX-WS仕様）への移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.7."><a href="#tubame_1.7.">1.7.Webサービスのクライアント移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.8."><a href="#tubame_1.8.">1.8.RMI-IIOP実装の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.8.1."><a href="#tubame_1.8.1.">1.8.1.EJBサーバ実装の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.8.2."><a href="#tubame_1.8.2.">1.8.2.EJBクライアント実装の移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9."><a href="#tubame_1.9.">1.9.APサーバ固有機能の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.9.1."><a href="#tubame_1.9.1.">1.9.1.WebLogicの起動・停止クラス</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9.2."><a href="#tubame_1.9.2.">1.9.2.WebLogic独自のJMXを使用した実装</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9.3."><a href="#tubame_1.9.3.">1.9.3.WebLogic Time APIを使用した実装</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9.4."><a href="#tubame_1.9.4.">1.9.4.WebLogic独自のXercesを使用した実装</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9.5."><a href="#tubame_1.9.5.">1.9.5.WebLogic独自のXMLBeansを使用した実装</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9.6."><a href="#tubame_1.9.6.">1.9.6.WebLogic独自のEnviromentクラスを使用した実装</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9.7."><a href="#tubame_1.9.7.">1.9.7.WebLogic独自のweblogic.utils.wrapper.Wrapperクラスを使用した実装</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9.8."><a href="#tubame_1.9.8.">1.9.8.WebLogic独自のロギイング実装</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9.9."><a href="#tubame_1.9.9.">1.9.9.WebLogic独自のサーバセッションプール機能を利用したJMSコンシューマの移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9.10."><a href="#tubame_1.9.10.">1.9.10.WebLogic独自のJDBC 接続プールを用いたデータベース接続の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9.11."><a href="#tubame_1.9.11.">1.9.11.WebLogic Workshopについて</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9.12."><a href="#tubame_1.9.12.">1.9.12.WebLogic独自のweblogic.jms.extensions.WLSessionの実装</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.9.13."><a href="#tubame_1.9.13.">1.9.13.WebLogic独自weblogic.utilsの実装</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.10."><a href="#tubame_1.10.">1.10.アプリケーションロギング</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.10.1."><a href="#tubame_1.10.1.">1.10.1.Log4jの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.10.1.1."><a href="#tubame_1.10.1.1.">1.10.1.1.Log4jの設定をアプリケーション内で完結させる方法</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.10.1.2."><a href="#tubame_1.10.1.2.">1.10.1.2.Log4jの設定をJBossのログ出力設定にマージする方法</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.11."><a href="#tubame_1.11.">1.11.パッケージング</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.12."><a href="#tubame_1.12.">1.12.Tuxedoクライアントの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.12.1."><a href="#tubame_1.12.1.">1.12.1.WebLogic既存環境の確認</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="1.12.1.1."><a href="#tubame_1.12.1.1.">1.12.1.1.WTCを利用したTuxedoのCORBAサーバとの接続確認</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.12.1.2."><a href="#tubame_1.12.1.2.">1.12.1.2.WLECを利用したTuxedoのCORBAサーバとの接続確認</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.12.1.3."><a href="#tubame_1.12.1.3.">1.12.1.3.WTCを利用したTuxedoのATMIサービスとの接続確認</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="1.12.1.4."><a href="#tubame_1.12.1.4.">1.12.1.4.JOLTを利用したTuxedoのATMIサービスとの接続確認</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dt>
<span class="2."><a href="#tubame_2.">2.サーバ設定の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.1."><a href="#tubame_2.1.">2.1.JDBCドライバの移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.2."><a href="#tubame_2.2.">2.2.データソースの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.2.1."><a href="#tubame_2.2.1.">2.2.1.データソース設定の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.2.1.1."><a href="#tubame_2.2.1.1.">2.2.1.1.JDBCドライバーのパラメータ設定(jdbc-driver-params)の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.2.1.2."><a href="#tubame_2.2.1.2.">2.2.1.2.コネクションプールのパラメータ設定(jdbc-connection-pool-params)の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.2.1.3."><a href="#tubame_2.2.1.3.">2.2.1.3.データソースのパラメータ設定(jdbc-data-source-params)の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.2.1.4."><a href="#tubame_2.2.1.4.">2.2.1.4.XAデータソースのパラメータ設定(jdbc-xa-params)の移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3."><a href="#tubame_2.3.">2.3.アプリケーションサーバにおけるサーバ設定</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.3.1."><a href="#tubame_2.3.1.">2.3.1.セキュリティ設定の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.3.1.1."><a href="#tubame_2.3.1.1.">2.3.1.1.Database認証モジュール(DatabaseServerLoginModule)</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.1.2."><a href="#tubame_2.3.1.2.">2.3.1.2.File認証モジュール(UsersRolesLoginModule)</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.1.3."><a href="#tubame_2.3.1.3.">2.3.1.3.DataSource認証モジュール(SecureIdentity)</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.2."><a href="#tubame_2.3.2.">2.3.2.ログ設定の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.3.2.1."><a href="#tubame_2.3.2.1.">2.3.2.1.サーバログのローテーション設定</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.2.2."><a href="#tubame_2.3.2.2.">2.3.2.2.Webアクセスログのローテーション設定</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.3."><a href="#tubame_2.3.3.">2.3.3.組み込みLDAP設の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.4."><a href="#tubame_2.3.4.">2.3.4.SNMPエージェント設定の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.5."><a href="#tubame_2.3.5.">2.3.5.JTA設定の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.6."><a href="#tubame_2.3.6.">2.3.6.JDBCリソース設定の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.7."><a href="#tubame_2.3.7.">2.3.7.JMS設定</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.3.7.1."><a href="#tubame_2.3.7.1.">2.3.7.1.JMSパーシステンス設定の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.7.2."><a href="#tubame_2.3.7.2.">2.3.7.2.JMSシステムリソース設定の移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.3.7.2.1."><a href="#tubame_2.3.7.2.1.">2.3.7.2.1.JMSコネクションファクトリの移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.7.2.2."><a href="#tubame_2.3.7.2.2.">2.3.7.2.2.JMSキュー設定の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.7.2.3."><a href="#tubame_2.3.7.2.3.">2.3.7.2.3.JMSトピック設定の移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.8."><a href="#tubame_2.3.8.">2.3.8.デプロイメント設定</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.3.8.1."><a href="#tubame_2.3.8.1.">2.3.8.1.JBossのデプロイメントについて</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.8.2."><a href="#tubame_2.3.8.2.">2.3.8.2.デプロイメント順序について</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.3.9."><a href="#tubame_2.3.9.">2.3.9.自動チューニング設定</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.3.9.1."><a href="#tubame_2.3.9.1.">2.3.9.1.スレッド制約</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4."><a href="#tubame_2.4.">2.4.アプリケーションサーバにおけるWebアプリケーション設定</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.4.1."><a href="#tubame_2.4.1.">2.4.1.セッションに関連するパラメータの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.4.1.1."><a href="#tubame_2.4.1.1.">2.4.1.1.クッキーの有効/無効化設定の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4.1.2."><a href="#tubame_2.4.1.2.">2.4.1.2.クッキー名の設定移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4.1.3."><a href="#tubame_2.4.1.3.">2.4.1.3.クッキーのパス設定移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4.1.4."><a href="#tubame_2.4.1.4.">2.4.1.4.URLリライティング設定の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4.1.5."><a href="#tubame_2.4.1.5.">2.4.1.5.セッションIDの長さ設定の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4.1.6."><a href="#tubame_2.4.1.6.">2.4.1.6.セッションタイムアウト設定の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4.1.7."><a href="#tubame_2.4.1.7.">2.4.1.7.セッション永続化設定の移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4.2."><a href="#tubame_2.4.2.">2.4.2.JSPに関連するパラメータの移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4.3."><a href="#tubame_2.4.3.">2.4.3.コンテナに関連するパラメータの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.4.3.1."><a href="#tubame_2.4.3.1.">2.4.3.1.セッションモニタリングの制御設定の移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4.4."><a href="#tubame_2.4.4.">2.4.4.ワークマネージャーに関連するパラメータの移行</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.4.4.1."><a href="#tubame_2.4.4.1.">2.4.4.1.同時接続時の最大スレッド数の制約設定の移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4.5."><a href="#tubame_2.4.5.">2.4.5.charset設定の移行</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.4.6."><a href="#tubame_2.4.6.">2.4.6.起動時終了時のリスナ設定の移行</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.5."><a href="#tubame_2.5.">2.5.日本語文字化け対応</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.5.1."><a href="#tubame_2.5.1.">2.5.1.Get及びPostのエンコーディングについて</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.5.2."><a href="#tubame_2.5.2.">2.5.2.静的コンテンツのエンコーディング</a></span>
</dt>
</dl>
</dd>
<dd>
<dl>
<dt>
<span class="2.5.3."><a href="#tubame_2.5.3.">2.5.3.JSPのエンコーディング</a></span>
</dt>
<dd>
<dl>
<dt>
<span class="2.5.3.1."><a href="#tubame_2.5.3.1.">2.5.3.1.ページエンコーディングの一括設定</a></span>
</dt>
</dl>
</dd>
</dl>
</dd>
</dl>
</dd>
</dl>
</div>
<HR>
<a name="tubame_1."></a>
<h2 class="title">1.アプリケーションの移行</h2>
<br>
<a name="tubame_1.1."></a>
<h3 class="title">1.1.J2EE非推奨APIについて</h3>
<br>
<br>
<a name="tubame_1.1.1."></a>
<h3 class="title">1.1.1.Servletの非推奨APIについて</h3>
<br>
<br>
<a name="tubame_1.1.1.1."></a>
<h3 class="title">1.1.1.1.Servlet2.5で既に非推奨となる機能</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>以下はServlet 2.5で既に非推奨となってい機能一覧であり、推奨されていないAPIが利用されている場合は、代替となるAPIを利用するように修正する必要がある。</p>
<p>推奨されていないインタフェース</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.SingleThreadModel
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSessionContext
				</p>
</li>
<li class="listitem">
<p>javax.resource.spi.security.GenericCredential
				</p>
</li>
<li class="listitem">
<p>javax.servlet.jsp.el.FunctionMapper
				</p>
</li>
<li class="listitem">
<p>javax.servlet.jsp.el.VariableResolver
				</p>
</li>
</ul>
</div>
<p>推奨されていないクラス</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p> javax.faces.application.StateManager.SerializedView
				</p>
</li>
<li class="listitem">
<p> javax.faces.el.MethodBinding
				</p>
</li>
<li class="listitem">
<p>javax.faces.el.PropertyResolver
				</p>
</li>
<li class="listitem">
<p>javax.faces.el.ValueBinding
				</p>
</li>
<li class="listitem">
<p>javax.faces.el.VariableResolver
				</p>
</li>
<li class="listitem">
<p>javax.faces.webapp.AttributeTag
				</p>
</li>
<li class="listitem">
<p>javax.faces.webapp.ConverterTag
				</p>
</li>
<li class="listitem">
<p> javax.faces.webapp.UIComponentBodyTag
				</p>
</li>
<li class="listitem">
<p>javax.faces.webapp.UIComponentTag
				</p>
</li>
<li class="listitem">
<p>javax.faces.webapp.ValidatorTag
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpUtils
				</p>
</li>
<li class="listitem">
<p>javax.servlet.jsp.el.Expression
				</p>
</li>
<li class="listitem">
<p>javax.servlet.jsp.el.ExpressionEvaluator
				</p>
</li>
<li class="listitem">
<p>javax.xml.soap.SOAPElementFactory
				</p>
</li>
</ul>
</div>
<p>推奨されていないメソッド</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.http.HttpServletResponse.encodeRedirectUrl(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpServletResponse.encodeUrl(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSessionContext.getIds()
				</p>
</li>
<li class="listitem">
<p>javax.servlet.ServletRequest.getRealPath(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.UnavailableException.getServlet()
				</p>
</li>
<li class="listitem">
<p>javax.servlet.ServletContext.getServlet(String)
				</p>
</li>
<li class="listitem">
<p> javax.servlet.ServletContext.getServletNames()
				</p>
</li>
<li class="listitem">
<p>javax.servlet.ServletContext.getServlets()
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSessionContext.getSession(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSession.getSessionContext()
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSession.getValue(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpSession.getValueNames()
				</p>
</li>
<li class="listitem">
<p> javax.servlet.http.HttpServletRequest.isRequestedSessionIdFromUrl()
				</p>
</li>
<li class="listitem">
<p>javax.servlet.ServletContext.log(Exception, String)
				</p>
</li>
<li class="listitem">
<p> javax.servlet.http.HttpSession.putValue(String, Object)
				</p>
</li>
<li class="listitem">
<p> javax.servlet.http.HttpSession.removeValue(String)
				</p>
</li>
<li class="listitem">
<p> javax.servlet.http.HttpServletResponse.setStatus(int, String)
				</p>
</li>
</ul>
</div>
<p>この他多数。詳細は下記のURLを参照のこと</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>http://java.sun.com/javaee/5/docs/api/
				</p>
</li>
<li class="listitem">
<p>http://java.sun.com/javaee/5/docs/api/deprecated-list.html
				</p>
</li>
</ul>
</div>
<p>なお、Servet2.5で以下のような変更も含まれているため、該当コードが存在する場合は，注意すること。
        </p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.ServletRequestインタフェースのgetReaderメソッドが呼び出されたあと，setCharacterEncodingメソッドの呼び出しが無効になることについて明記された
				</p>
</li>
<li class="listitem">
<p>無効化されたjavax.servlet.http.HttpSessionオブジェクトのgetIdメソッドが呼び出された場合にjava.lang.IllegalStateException例外がスローされる仕様が削除された。
				</p>
</li>
</ul>
</div>
<p>
        
</p>
</div>
<br>
<br>
<a name="tubame_1.1.1.2."></a>
<h3 class="title">1.1.1.2.Servlet3.0で非推奨となる機能</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>以下はServlet
			3.0で非推奨となっていた一覧であり、推奨されていないAPIが利用されている場合は、代替となるAPIを利用するように修正する必要がある。
		</p>
<p>推奨されていないメソッド</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>javax.servlet.http.HttpServletResponseWrapper.encodeRedirectUrl(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpServletResponseWrapper.encodeUrl(String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpServletRequestWrapper.isRequestedSessionIdFromUrl()
				</p>
</li>
<li class="listitem">
<p>javax.servlet.http.HttpServletResponseWrapper.setStatus(int,
					String)
				</p>
</li>
<li class="listitem">
<p>javax.servlet.ServletRequestWrapper.getRealPath(String)
				</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_1.1.2."></a>
<h3 class="title">1.1.2.Servlet以外の非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Servlet以外のAPIとして、JAXB,JSF,EJB,JCAなどのAPIを利用している場合も、代替となるAPIを利用するように修正する必要がある。</p>
</div>
<br>
<br>
<a name="tubame_1.1.2.1."></a>
<h3 class="title">1.1.2.1.JAXB非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP6では、JAXB2.2をサポートしており、、JAXB2.2で推奨されていないAPIが利用されている場合は、代替となるAPIを利用するように修正する必要がある。</p>
</div>
<br>
<br>
<a name="tubame_1.1.2.2."></a>
<h3 class="title">1.1.2.2.JSF非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP6では、JSF2.0をサポートしており、、JXF2.0で推奨されていないAPIが利用されている場合は、代替となるAPIを利用するように修正する必要がある。</p>
</div>
<br>
<br>
<a name="tubame_1.1.2.3."></a>
<h3 class="title">1.1.2.3.EJB非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP6では、EJB3.1をサポートしており、、EJB3.1で推奨されていないAPIが利用されている場合は、代替となるAPIを利用するように修正する必要がある。</p>
</div>
<br>
<br>
<a name="tubame_1.1.2.4."></a>
<h3 class="title">1.1.2.4.JCA非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP6では、Java EE Connector Architecture(JCA)1.6をサポートしており、、JCA1.6で推奨されていないAPIが利用されている場合は、代替となるAPIを利用するように修正する必要がある。</p>
</div>
<br>
<br>
<a name="tubame_1.1.2.5."></a>
<h3 class="title">1.1.2.5.SOAP及びJWS非推奨API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossEAP6では、Web Services Metadata for the Java Platform (JWS)2.1をサポートしており、、JWS2.1で推奨されていないAPIが利用されている場合は、代替となるAPIを利用するように修正する必要がある。</p>
</div>
<br>
<br>
<a name="tubame_1.1.2.6."></a>
<h3 class="title">1.1.2.6.Deployment 及びActivation API</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JAVAEE6で非推奨となっているDeployment 及び Activation APIを利用している場合、代替となるAPIを利用するように修正する必要がある</p>
</div>
<br>
<br>
<a name="tubame_1.2."></a>
<h3 class="title">1.2.JSPの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogic 9はJSP 2.0に準拠しており、JBoss EAP 6はJSP 2.1に準拠している。JSP仕様の差異による振る舞いについて注意が必要だが、同じJSPコードでもAPサーバに挙動が異なる点があるので注意すること。
        </p>
</div>
<br>
<br>
<a name="tubame_1.2.1."></a>
<h3 class="title">1.2.1.WebLogic固有タグの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>各ベンダによって、独自のJSPカスタムタグが提供されている場合があり、WebLogicでも、JSPで特殊なJSPタグが提供されている。以下で「cache、process、repeat」など、主なタグについての移行方法を説明する。
			なお、WebLogicカスタムタグを使用している場合、weblogic-tags.jarファイルをWebアプリケーションのWEB-INF/libディレクトリ置き、Web
			アプリケーション・デプロイメント記述子（web.xml）のtaglib要素にて参照する。以下に、web.xmlの例を示す。
		</p>
<div class="figure">
<a name="N147F4"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebアプリケーションでのWebLogicカスタム・タグの使用
			</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
				
&lt;taglib&gt;
  &lt;taglib-uri&gt;weblogic-tags.tld&lt;/taglib-uri&gt;
  &lt;taglib-location&gt;
     /WEB-INF/lib/weblogic-tags.jar
  &lt;/taglib-location&gt;
&lt;/taglib&gt;

			</pre>
</div>
</div>
<br class="figure-break">
</div>
<br>
<br>
<a name="tubame_1.2.1.1."></a>
<h3 class="title">1.2.1.1.cacheタグ</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>wl:cacheタグは、JSPソースファイル内のcacheタグ内で行われた処理をキャッシュするために使用する。
        </p>
<div class="figure">
<a name="N1480A"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;cacheタグを使用したJSPの例
			</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
				
&lt;wl:cache&gt;
&lt;!--the content between these tags will only be refreshed
on server  restart--&gt;
&lt;/wl:cache&gt;
&lt;wl:cache timeout="15m"&gt;
&lt;!--get the new headlines from the database every 15 minutes
and display them--&gt;
&lt;/wl:cache&gt;

			</pre>
</div>
</div>
<p>
<br class="figure-break">    
        上記のようなコードが存在する場合、wl:cacheで囲まれた部分を取り外さなければならない。キャッシュしないと性能要件が満足できないシステムか否かを検討し、キャッシュを外すかサードパーティのライブラリを利用するかなどの検討が必要となる。サードパーティのライブラリの例として以下を挙げる
        	</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>Cache Taglib：http://jakarta.apache.org/taglibs/doc/cache-doc/index.html</p>
</li>
<li class="listitem">
<p>OSCache：http://wiki.opensymphony.com/display/CACHE/JSP+Tags</p>
</li>
</ul>
</div>
<p>
         
</p>
<div class="important" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Important">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Important]" src="images/important.png"></td><th align="left">Important</th>
</tr>
<tr>
<td valign="top" align="left">
<p>サードパーティのライブラリを利用してキャッシュ機能を実現する場合は、キャッシュに関する部分のサポートをRed Hat社から受けられないことに留意すること</p>
</td>
</tr>
</table>
</div>
</div>
<br>
<br>
<a name="tubame_1.2.1.2."></a>
<h3 class="title">1.2.1.2.processタグ</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			wl:processタグは、クエリ パラメータベースのフロー制御用に使用する。
			リクエストパラメータの値を基に条件を指定することで、JSP をページにインクルードするかどうかを決められ、各属性を組み合わせて使用することで、wl:processタグと wl:process
			タグに囲まれた文を選択的に実行できる。
			JBossにはprocessタグに相当するタグはないため、Javaコードを記述してこのタグの代替とする方法がある。また、別の方法として、スクリプトレットのif文、Apache
			Strutsのlogic:existsタグ、またはJSTLタグで代用する方法がある。
			processタグを以下の表に従って属性名毎にそれぞれ代替を行う。

			</p>
<div class="table">
<a name="N1482C"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;processタグの属性名の代替表
				</b>
</p>
<div class="table-contents">
<table summary="processタグの属性名の代替表
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>属性名</th><th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>name</td><td>
								
<p>クエリパラメータに指定した名称があれば実行される</p>
								
<p>代替： if( null !=
									request.getParameter(&ldquo;[nameに指定された文字列]&rdquo;) )</p>
							
</td>
</tr>
<tr>
<td>2</td><td>notname</td><td>
								
<p>クエリパラメータに指定した名称がなければ実行される。</p>
								
<p>代替： if( null ==
									request.getParameter(&ldquo;[nameに指定された文字列]&rdquo;) )</p>
							
</td>
</tr>
<tr>
<td>3</td><td>value</td><td>
								
<p>クエリパラメータに指定した名称の値が指定した値と同じであれば実行される。</p>
								
<p>代替： if(
									true==&ldquo;[valueに指定された文字列]&rdquo;.equals(request.getParameter(&ldquo;[nameに指定された文字列]&rdquo;)))
								</p>
							
</td>
</tr>
<tr>
<td>4</td><td>notvalue</td><td>
								
<p>クエリパラメータに指定した名称の値と指定した値が異なれば実行される。</p>
								
<p>代替： if(
									false==&ldquo;[valueに指定された文字列]&rdquo;.equals(request.getParameter(&ldquo;[nameに指定された文字列]&rdquo;)))
								</p>
							
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
		
</p>
<p>
			以下ではJavaコードで代替する方法を説明する。
			</p>
<div class="figure">
<a name="N14871"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;processタグを使用した変更前のjspの例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;wl:process notname="update"&gt;
&lt;wl:process notname="delete"&gt;
&lt;!--Only show this if there is no update or delete parameter--&gt;
&lt;form action="&lt;%= request.getRequestURI() %&gt;"&gt;
      &lt;input type="text" name="name"/&gt;
      &lt;input type="submit" name="update" value="Update"/&gt;
      &lt;input type="submit" name="delete" value="Delete"/&gt;
&lt;/form&gt;
&lt;/wl:process&gt;
&lt;/wl:process&gt;
 
&lt;wl:process name="update"&gt;
&lt;!-- do the update --&gt;
&lt;/wl:process&gt;
 
&lt;wl:process name="delete"&gt;
&lt;!--do the delete--&gt;
&lt;/wl:process&gt;
 
&lt;wl:process name="lastBookRead" value="A Man in Full"&gt;
&lt;!--this section of code will be executed if lastBookRead exists
and the value of lastBookRead is "A Man in Full"--&gt;
&lt;/wl:process&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">

			
</p>
<div class="figure">
<a name="N1487C"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;変更後のjspの例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;% if( null == request.getParameter(&ldquo;update&rdquo;) ) { %&gt;
&lt;% if( null == request.getParameter(&ldquo;delete&rdquo;) ) { %&gt;
&lt;!--Only show this if there is no update or delete parameter--&gt;
&lt;form action="&lt;%= request.getRequestURI() %&gt;"&gt;
  &lt;input type="text" name="name"/&gt;
  &lt;input type="submit" name="update" value="Update"/&gt;
  &lt;input type="submit" name="delete" value="Delete"/&gt;
&lt;/form&gt;
&lt;% } %&gt;
&lt;% } %&gt;
 
&lt;% if( null != request.getParameter(&ldquo;update&rdquo;) ) { %&gt;
&lt;!-- do the update --&gt;
&lt;% } %&gt;
 
&lt;% if( null != request.getParameter(&ldquo;delete&rdquo;) ) { %&gt;
&lt;!--do the delete--&gt;
&lt;% } %&gt;
 
&lt;% if( true==&rdquo;A Man in Full&rdquo;.equals(request.getParameter(&ldquo;lastBookRead&rdquo;))) %&gt;
&lt;!--this section of code will be executed if lastBookRead exists
 and the value of lastBookRead is "A Man in Full"--&gt;
&lt;% } %&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">


		
</p>
</div>
<br>
<br>
<a name="tubame_1.2.1.3."></a>
<h3 class="title">1.2.1.3.repeatタグ</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>wl:repeatタグは、列挙値、イテレータ、コレクション、オブジェクト配列、ベクトル、結果セット、結果セットメタデータ、およびハッシュテーブル
			キーなど、さまざまなタイプの集合に対して処理を繰り返す場合に使用している。
			JBossにはrepeatタグに相当するタグはないため、Javaコードを記述してこのタグの代替とする方法がある。また、別の方法として、JSTLタグのc:forEachまたはx:forEachで代用する方法がある。
		</p>
<div class="table">
<a name="N14893"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;repeatタグの要素
			</b>
</p>
<div class="table-contents">
<table summary="repeatタグの要素
			" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>項目</th><th>説明</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>set</td><td>集合オブジェクト（配列、コレクション、結果セット）を表す。  </td>
</tr>
<tr>
<td>2</td><td>count</td><td>集合内で最初のcountエントリに対して、処理を繰り返す。</td>
</tr>
<tr>
<td>3</td><td>id</td><td>コレクションから取り出した要素を格納する変数名。</td>
</tr>
<tr>
<td>4</td><td>type</td><td>
							
<p>クエリパラメータの値が異なれば実行される。</p>
							
<p>代替： if(
								false==&ldquo;[valueに指定された文字列]&rdquo;.equals(request.getParameter(&ldquo;[nameに指定された文字列]&rdquo;)))
							</p>
						
</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
<p>
			J2SE5.0から導入されたfor文の拡張により、Javaコードによりrepeatの代替する方法を以下に示す。
			</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
						for文の拡張
					</span>
</dt>
<dd>
<p>for( [変数の型] [変数] ： [集合] )</p>
</dd>
</dl>
</div>
<p>
			 
</p>
<div class="figure">
<a name="N148CD"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;repeatタグを使用した変更前のjspの例
			</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
				
&lt;wl:repeat id="name" set="&lt;%= new String[] { "sam", "fred", "ed" } %&gt;"&gt;
&lt;%= name %&gt;&lt;BR&gt;
&lt;/wl:repeat&gt;

			</pre>
</div>
</div>
<p>
<br class="figure-break">
            
</p>
<div class="figure">
<a name="N148D8"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;変更後のjspの例
			</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
				
&lt;% for(String name : new String[] { "sam", "fred", "ed" }) { %&gt;
&lt;%= name %&gt;&lt;BR&gt;
&lt;% } %&gt;

			</pre>
</div>
</div>
<p>
<br class="figure-break">    
		
</p>
</div>
<br>
<br>
<a name="tubame_1.2.2."></a>
<h3 class="title">1.2.2.暗黙的にimportされるパッケージ</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicの独自仕様として、JSPはjava.util.*やjava.io.*パッケージ等もデフォルトでインポートするように実装している。そのため、WebLogicで動作しているJSPファイルでは、デフォルトインポートにより、本来インポートする必要があるインポートの記述がなくても動作している可能性がある。
		</p>
<p>
			JBossに移行する際にインポートを宣言する必要があり、以下の1または2の方法で対処を行う。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>修正対象ファイル数が少ない場合</p>
<p>対象のJSPファイルにインポート宣言を追加する。</p>
<div class="figure">
<a name="N148F7"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JSPのヘッダ部分のインポート宣言の例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;% page import="java.io.*"%&gt;
&lt;% page import="java.util.*"%&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
<li class="listitem">
<p>修正対象ファイル数が多い場合</p>
<p>web.xmlへの共通JSPファイルの定義の追加とJSPの共通ヘッダファイルを作成する。以下に具体的な方法を示す。
					</p>
<p>
						web.xmlファイルのヘッダの定義を変更し、共通JSPの定義(jsp-config/jsp-property-group/include-preludedタグに共通JSPファイル)を追加する。
						</p>
<div class="figure">
<a name="N14909"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;web.xmlファイルのヘッダ例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee"
xmlns:j2ee="http://java.sun.com/xml/ns/javaee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" version="2.5"
  si:schemaLocation="http://java.sun.com/xml/ns/javaee
  http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"&gt;

&lt;jsp-config&gt;
    &lt;jsp-property-group&gt;
      &lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
      &lt;page-encoding&gt;Windows-31J&lt;/page-encoding&gt;
      &lt;include-prelude&gt;/CommonJSPHeaders.jsp&lt;/include-prelude&gt;
    &lt;/jsp-property-group&gt;
  &lt;/jsp-config&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
<p>
						JSPの共通ヘッダファイルCommonJSPHeaders.jspを以下の内容で作成する。
						</p>
<div class="figure">
<a name="N14916"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;JSPの共通ヘッダファイルの例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;%@ page language="java"  %&gt;
&lt;%@ page import="java.io.*" %&gt;
&lt;%@ page import="java.util.*" %&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.2.3."></a>
<h3 class="title">1.2.3.JSPでのnullと空文字列の表示について</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JSP標準仕様では、&lt;%= xxx %&gt;
			で変数xxxの値がnullの場合、画面には「null」という文字が表示される。
		</p>
<p>WebLogic Server 6.1 からは、weblogic.xml に printNulls
			という新しいパラメータが導入された。このprintNulls設定はデフォルトでtrueであり、JSP仕様通り「null」が表示される。ここで、printNulls設定がfalseに設定されている場合は、空文字列（""）が表示される。
			JBossには、printNullsと同等な設定がない。例えばWebLogic Serverでweblogic.xml に
			printNullsがfalseで設定されている場合は、変数の値がnullである場合に空文字列（""）を表示するよう修正する必要がある。
		</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>参考URL：http://otndnld.oracle.co.jp/document/products/wls/docs81/upgrade/upgrade51to81.html
				</p>
</li>
</ul>
</div>
<p>
			以下の条件に該当する場合はJBoss側でjspファイルの修正が必要である。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>WebLogic6.1以降の場合でweblogic.xmlのprintNulls設定がfalseの場合（空文字列（""）を返す）
						</p>
<div class="figure">
<a name="N1493A"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic.xmlのprintNulls設定例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;weblogic-web-app&gt;
&lt;jsp-param&gt;
    &lt;param-name&gt;printNulls&lt;/param-name&gt;
    &lt;param-value&gt;false&lt;/param-value&gt;
  &lt;/jsp-param&gt;
&lt;/weblogic-web-app&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
						
</p>
<div class="figure">
<a name="N14945"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;変更前のjspの例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;%
String xxx = null;
%&gt;
value=&lt;%= xxx %&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
</ul>
</div>
<p>
		
</p>
<p>
			以下に、3種類のJSP変更方法について例示する。
			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>
						三項演算子を用いた修正後のJSPの例(nullチェックを行い、空文字列（""）を設定する例)
						</p>
<div class="figure">
<a name="N14957"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;三項演算子を用いた変更後のjspの例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;%
  String xxx = null;
%&gt;
value=&lt;%= xxx == null ? "" : xxx %&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
<li class="listitem">
<p>
						IF文を用いた修正後のJSPの例(nullチェックを行い、空文字列（""）を設定する例)
						</p>
<div class="figure">
<a name="N14965"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;IF文を用いた変更後のjspの例	
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;%
  String xxx = null;
%&gt;
&lt;!-- 追加--&gt;
&lt;%
if(xxx==null){
xxx="";
}
%&gt;
value=&lt;%= xxx %&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
<li class="listitem">
<p>EL文を用いた修正後のJSPの例(EL式が適用できる場合に限る</p>
<p>
						EL式を適用した場合および出力がnullの場合、&rdquo;null&rdquo;と表示されるのでなく、空文字列（""）が出力される。
						</p>
<div class="figure">
<a name="N14975"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;変更前のjspの例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;%= ((UserBean) request.getAttribute("user")).getName() %&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
						
</p>
<div class="figure">
<a name="N14980"></a>
<p class="title">
<b>Figure&nbsp;6.&nbsp;EL式を用いた変更後のjspの例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
...
&lt;%=${user.name}%&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.2.4."></a>
<h3 class="title">1.2.4.セッションのハンドリングについて</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>該当JSPにて「&lt;%@
			page session="false" %&gt;」 のようにセッションを明示的に無効化させている場合で、かつ
			該当JSP内にjspインクルードを行い、他のjspページをインクルードさせるような場合、JBoss
			EAP6で以下のような事象になる場合がある。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>インクルードしたjspの出力が実施されない。</p>
</li>
<li class="listitem">
<p>意図せずSessionが払い出される
					</p>
<p>具体的なケースとしては、jspのtopページにアクセス時にSessionを払いださないようにするために、
						topページのjspにて、page session="false"を宣言している場合である。
						この場合に該当JSP内でheaderページ等をインクルードしている場合、
						JBossでは、headページの出力はされず、Sessionが払い出せる事象が発生する。
						なお、WebLogicでは、想定どおり、headerページ出力も行われ、Sessionは払い出される。
						</p>
<div class="figure">
<a name="N149A1"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;top.jsp
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;%@ page session="false"%&gt;
&lt;%@ page language="java" contentType="text/html; charset=Windows-31J" pageEncoding="Windows-31J" %&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS"&gt;
&lt;title&gt;Header Include Test&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;

	&lt;jsp:include page="header.jsp" flush="true"/&gt;

	&lt;div&gt;Main Content&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">

						
</p>
<div class="figure">
<a name="N149AC"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;heaer.jsp
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;%
out.println("My Header");
%&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
</ul>
</div>
<p>
		
</p>
<p>修正方法を以下に示す。jsp:includeタグにかわり、includeディレクティブを利用する。
		</p>
<div class="figure">
<a name="N149BA"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;変更後のtop.jsp
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;
&lt;%@ page session="false"%&gt;
&lt;%@ page language="java" contentType="text/html; charset=Windows-31J" pageEncoding="Windows-31J" %&gt;
&lt;html&gt;
&lt;head&gt;
&lt;meta http-equiv="Content-Type" content="text/html; charset=Shift_JIS"&gt;
&lt;title&gt;Header Include Test&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;!--
	&lt;jsp:include page="header.jsp" flush="true"/&gt;
	--&gt;
	&lt;%@ include file="header.jsp" %&gt;
	&lt;div&gt;Main Content&lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_1.2.5."></a>
<h3 class="title">1.2.5.JSPファイルヘッダのtaglibの宣言について</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicでは「&lt;%@ taglib uri="xxxx-taglib.tld"
			prefix="xxxx"
			%&gt;」と宣言している場合、WEB-INFディレクトリに「xxxx-taglib.tld」ファイルがあれば、このファイルを認識して正常に動作する。
			JBossでは上記宣言の場合、宣言を行っているJSPファイルと同一のディレクトリに存在している必要がある。
		</p>
<p>
			この仕様の違いにより、移行時にファイルが存在しないためエラーが発生することがある。この問題に対しては、以下に示すいずれかの方法により対処を行う。
			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>web.xmlにtaglibを定義する方法</p>
<p>
						web.xmlファイルとjspファイルを修正する。
						</p>
<div class="orderedlist">
<ol class="orderedlist" type="a">
<li class="listitem">
<p>web.xmlファイルの変更</p>
<p>
									以下のようにweb.xmlファイルのtaglib-urlにエイリアスを指定することにより、taglib-locationで定義する。
									</p>
<div class="figure">
<a name="N149DF"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;web.xmlへtaglibの定義を追加する例
										</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
											
&lt;taglib&gt;
&lt;taglib-uri&gt;xxxx-taglib&lt;/taglib-uri&gt;
&lt;taglib-location&gt;/WEB-INF/xxxx-taglib.tld&lt;/taglib-location&gt;
&lt;/taglib&gt;

										</pre>
</div>
</div>
<p>
<br class="figure-break">
								
</p>
</li>
<li class="listitem">
<p>jspファイルの変更</p>
<p>
									ファイル名で指定した箇所をエイリアス名の指定に変更する。
									</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>変更前：&lt;%@ taglib uri="xxxx-taglib.tld"
												prefix="xxxx" %&gt;</p>
</li>
<li class="listitem">
<p>変更後：&lt;%@ taglib uri="xxxx-taglib"
												prefix="xxxx" %&gt;</p>
</li>
</ul>
</div>
<p>
								
</p>
</li>
</ol>
</div>
<p>
					
</p>
</li>
<li class="listitem">
<p>JSPに直接書き込む方法</p>
<p>
						uri属性にtldファイルへのパスを記載する
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>変更前：&lt;%@ taglib uri="xxxx-taglib.tld"
									prefix="xxxx" %&gt;</p>
</li>
<li class="listitem">
<p>変更後：&lt;%@ taglib uri="/WEB-INF/xxxx-taglib.tld"
									prefix="xxxx" %&gt;</p>
</li>
</ul>
</div>
<p>
					
</p>
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.2.6."></a>
<h3 class="title">1.2.6.UseBeanのgetProperty及びsetProperty利用時の移植</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossは、以下のようにBeanで大文字のgetter(getURL)やsetterメソッド(setURL)が定義されているBeanに対して、jsp:getPropertyタグでpropertyに小文字(url)で設定すると、setUrlやgetUrlが定義されていないため実行時エラーとなる。この挙動の違いはJSP実装の違いで発生するもので、JSP仕様では特に明記されていない。
			</p>
<div class="figure">
<a name="N14A12"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;UseBeanタグで利用されるBean
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
public class FooBean {
 
private int count;
private String URL = "http://hoge.com" ;
 
public FooBean() {
super();
  }
 
public String getURL() {
return URL;
  }
 
public void setURL(String url) {
URL = url;
  }
  ・・・
}

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			
</p>
<div class="figure">
<a name="N14A1D"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;実行時エラーが発生するJSP
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;body&gt;
&lt;jsp:useBean id="foo" class="orz.FooBean" scope="page"&gt;&lt;/jsp:useBean&gt;
&lt;jsp:getProperty name="foo" property="count" /&gt;
&lt;jsp:getProperty name="foo" property="url" /&gt;
&lt;/body&gt;
&lt;/html&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>実行時エラーを回避するため、以下の2つのいづれかの方法で修正を行う。
		</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>setXXX、getXXXの最初のXのみ大文字にし以降は小文字にするように、該当Beanのセッターとゲッターを修正する方法。</p>
<div class="figure">
<a name="N14A2E"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;UseBeanタグで利用されるBeanのゲッターとセッターの変更例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
public class FooBean {
 
private int count;
private String URL = "http://hoge.com" ;
 
public FooBean() {
super();
  }
 
public String getUrl() {
return URL;
  }
 
public void setUrl(String url) {
URL = url;
  }
}

				</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>Beanのセッターとゲッターを修正せずにjspのpropertyを修正する方法。</p>
<div class="figure">
<a name="N14A3B"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;property属性を修正したJSP修正後の例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;body&gt;
&lt;jsp:useBean id="foo" class="orz.FooBean" scope="page"&gt;&lt;/jsp:useBean&gt;
&lt;jsp:getProperty name="foo" property="URL" /&gt;
&lt;/body&gt;

				</pre>
</div>
</div>
<br class="figure-break">
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.3."></a>
<h3 class="title">1.3.Servetの移行</h3>
<br>
<br>
<a name="tubame_1.3.1."></a>
<h3 class="title">1.3.1.WebLogic Servlet APIの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではWebLogic Servlet APIが提供されているため、このAPIを利用している場合、移行作業が必要になる。JBossではJBoss独自のServlet APIは提供していないため、WebLogic Servlet APIで実現した機能相当をJBossで
実現可能か、別途確認する必要がある。 </p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>参考URL：http://docs.oracle.com/cd/E13222_01/wls/docs92/javadocs/
				</p>
</li>
</ul>
</div>
<p>
        
</p>
</div>
<br>
<br>
<a name="tubame_1.4."></a>
<h3 class="title">1.4.JNDIの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p></p>
</div>
<br>
<br>
<a name="tubame_1.4.1."></a>
<h3 class="title">1.4.1.JNDI名の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JavaEE6では、JNDI名が標準化されており、app、module,globalなどのスコープ名がJavaEE6標準で利用できる。EJBの場合は、以下のようなJNDI名となる。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>EJBのJNDI名</p>
<p>java:&lt;スコープ&gt;[/&lt;アプリケーション名&gt;]/&lt;モジュール名&gt;/&lt;Bean名&gt;[!&lt;完全修飾インタフェース名&gt;]
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>スコープ:app、module,globalなどが指定可能。
							</p>
</li>
<li class="listitem">
<p>アプリケーション名:セッションBeanがearファイル内にパッケージ化されている場合にのみ必要</p>
</li>
<li class="listitem">
<p>モジュール名:セッションBeanがパッケージ化されているモジュールの名前</p>
</li>
<li class="listitem">
<p>Bean名:セッションBeanの名前</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>
			
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>上記のJavaEE6で標準化されたJNDIを利用しなくても、デプロイメントディスクリプタのリソースリファレンス設定を行うことで、
					プログラムコード上は、上記のJNDIスコープを利用することなく、参照が可能となる。
				</p>
<div class="figure">
<a name="N14AD1"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;デプロイメントディスクリプタ(jboss-ejb3.xml)</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
&lt;enterprise-beans&gt;
	&lt;session&gt;
		&lt;ejb-name&gt;MusicLibraryEJB&lt;/ejb-name&gt;
		&lt;ejb-ref&gt;
			&lt;ejb-ref-name&gt;ejb/BandHome&lt;/ejb-ref-name&gt;
			&lt;jndi-name&gt;java:app/bands-ejb21-module/BandEJB!examples.ejb20.relationships.bands.BandHome&lt;/jndi-name&gt;
		&lt;/ejb-ref&gt;

					</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N14ADB"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;EJB呼び出しもとのプログラムコード（MusicLibraryEJB内での呼び出し）</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
      Context ic    = new InitialContext();
      Context env = (Context) ic.lookup("java:comp/env");
      bandHome      = (BandHome)      env.lookup("ejb/BandHome");


					</pre>
</div>
</div>
<br class="figure-break">
</td>
</tr>
</table>
</div>
<p>
		
</p>
<p>また、JBossEAP6でJBoss固有の「jboss」スコープが導入されている。このスコープは、アプリケーションサーバーインスタンス内にデプロイされている全アプリケーションから参照可能なっている。
		</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>データソースのJNDI名</p>
<p>java:jboss/datasources/ExampleDS</p>
</li>
</ul>
</div>
<p>
				
</p>
<div class="note" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Note">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Note]" src="images/note.png"></td><th align="left">Note</th>
</tr>
<tr>
<td valign="top" align="left">
<p>移植を行う上で、なるべくJBoss固有の「jboss」スコープをアプリケーション上から利用するのは避けるべきであり、可能な限りリソースリファレンスの設定で、ポータビリティを保つようにしたほうがよい。</p>
<div class="figure">
<a name="N14AF2"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;Webのリソースリファレンス設定(web.xml)</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
	&lt;web-app xmlns:j2ee="http://java.sun.com/xml/ns/j2ee"&gt;
	     &lt;resource-ref&gt;
			&lt;res-ref-name&gt;jdbc/ExampleDS&lt;/res-ref-name&gt;
			&lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
			&lt;res-auth&gt;Container&lt;/res-auth&gt;
			&lt;lookup-name&gt;java:jboss/datasources/ExampleDS&lt;/lookup-name&gt;
		&lt;/resource-ref&gt;
	&lt;/web-app&gt;

					</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N14AFC"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;呼び出しもとのプログラムコード（SerletB内での呼び出し）</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
	Context ic = new InitialContext();
	Context env = (Context) ic.lookup("java:comp/env");
	DataSource lookup = (DataSource) env.lookup("jdbc/ExampleDS");

					</pre>
</div>
</div>
<br class="figure-break">
</td>
</tr>
</table>
</div>
<p>
		
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>
			なお、リモート呼び出しなどの場合は以下のようにJBoss独自の「ejb」を利用してJNDIルックアップを行う必要がある。

			</p>
<div class="figure">
<a name="N14B0A"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;EJBのJNDI名の変更例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
	//private static final String homeJNDIName = "MusicLibraryEJB.MusicLibraryHome";
	private static final String homeJNDIName = "ejb:/bands-ejb21-module/MusicLibraryEJB!examples.ejb20.relationships.bands.MusicLibraryHome";
	
	...

	/**
	 * JNDI を使って、MusicLibrary Bean のホーム インタフェースをルックアップします。
	 */
	private MusicLibraryHome lookupMusicLibraryHome() throws NamingException {
	...
		Context ctx = getInitialContext();
		Object home = (MusicLibraryHome) ctx.lookup(homeJNDIName);
	...
	
	}


				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</td>
</tr>
</table>
</div>
</div>
<br>
<br>
<a name="tubame_1.4.2."></a>
<h3 class="title">1.4.2.JNDIルックアップの呼び出し実装の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JNDIのInitialContextを取得する際のProvider URLやlookupするJNDI名が、アプリケーション中にハードコーディングされているケースがあり、この場合はアプリケーションの修正が必要となる。properties ファイルで設定されている場合は、properties ファイルの修正が必要となる</p>
</div>
<br>
<br>
<a name="tubame_1.4.2.1."></a>
<h3 class="title">1.4.2.1.APサーバのコンテナ内のJNDIルックアップ呼び出し</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBossでAPサーバのコンテナ内からのJNDIルックアップを行う場合、InitialContextのコンストラクタの引数にPropertiesを設定する必要はなく、引数なしのコンストラクタでInitialContextを生成し、Jndiルックアップが可能である </p>
<div class="figure">
<a name="N14A63"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogic（移行前）のソースコード例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
Properties props = new Properties();
props.put(InitialContext.INITIAL_CONTEXT_FACTORY,"weblogic.jndi.WLInitialContextFactory");
props.put(InitialContext.PROVIDER_URL, "t3://127.0.0.1:7001");
InitialContext initialContext = new InitialContext(props);

            </pre>
</div>
</div>
<br class="figure-break">
<p>JBossに移行する際に、以下のようにプログラムを変更する。</p>
<div class="figure">
<a name="N14A6F"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;JBoss（移行後）のソースコード例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
InitialContext initialContext = new InitialContext();

            </pre>
</div>
</div>
<br class="figure-break">
</div>
<br>
<br>
<a name="tubame_1.4.2.2."></a>
<h3 class="title">1.4.2.2.APサーバのコンテナ外のJNDIルックアップ呼び出し</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			EJBクライアントなどのようにAPサーバのコンテナ外からのJNDIルックアップ呼び出しが必要な場合に、APサーバのコンテナ外からのJNDIルックアップ呼び出しが必要である。JBossではAPサーバのコンテナ外からのJNDIルックアップ呼び出しを行う場合、InitialContextの引数にPropertiesを設定する必要がある
			</p>
<div class="figure">
<a name="N14A85"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogicのInitialContextのコンストラクタのProperties設定</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
   private void lookupBean() throws NamingException {
      ...
      Hashtable&lt;String,String&gt; h = new Hashtable&lt;String,String&gt;();
      h.put(Context.INITIAL_CONTEXT_FACTORY, "weblogic.jndi.WLInitialContextFactory");
      h.put(Context.PROVIDER_URL, url);
      h.put(Context.SECURITY_PRINCIPAL, user);
      h.put(Context.SECURITY_CREDENTIALS, password);
      new InitialContext(h);
      ...
  }

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>
			JBossでAPサーバのコンテナ内からのJNDIルックアップ呼び出しする場合、以下を行う必要がある
			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>InitialContextのコンストラクタの引数に設定するPropertiesの内容を変更する
					</p>
<div class="figure">
<a name="N14A96"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;JBossのInitialContextのコンストラクタのProperties設定</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
Properties props = new Properties();
props.put(InitialContext.INITIAL_CONTEXT_FACTORY,"org.jboss.naming.remote.client.InitialContextFactory");
props.put(InitialContext.PROVIDER_URL, "remote://localhost:4447");
props.put(InitialContext.URL_PKG_PREFIXES, "org.jboss.ejb.client.naming");
props.put(InitialContext.SECURITY_PRINCIPAL, "username");
props.put(InitialContext.SECURITY_CREDENTIALS, "userpass");
InitialContext initialContext = new InitialContext(props);

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>プロパティファイル(jboss-ejb-client.properties)を配置して、クラスパスに通す必要がある。(本例ではEJBクライアントの例を示す)
					</p>
<div class="figure">
<a name="N14AA3"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;jboss-ejb-client.properties</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
remote.connectionprovider.create.options.org.xnio.Options.SSL_ENABLED=false
remote.connections=default
remote.connection.default.host=localhost
remote.connection.default.port = 4447
remote.connection.default.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false


#remote.connection.two.host=localhost
#remote.connection.two.port = 4447
#remote.connection.two.connect.options.org.xnio.Options.SASL_POLICY_NOANONYMOUS=false

						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.5."></a>
<h3 class="title">1.5.EJBの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			EJBは、StatelessSessionBean、StatefulSessionBean、EntityBean、およびMessageDrivenBeanが存在し、それぞれJBossへの移行が必要である。以下に移植方法を示す。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>WebLogic独自EJBの移行</p>
<p>
						WebLogic上で開発したBeanが
						weblogic.ejb.Generic○○○Beanクラスから派生したものであった場合、JavaEE標準のEJBクラスから派生するようにEJBの実装を修正する。
						</p>
<div class="table">
<a name="N1559D"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;WebLogic独自クラスとJavaEE標準のEJBクラスとの対応</b>
</p>
<div class="table-contents">
<table summary="WebLogic独自クラスとJavaEE標準のEJBクラスとの対応" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>WebLogic</th><th>JBoss</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>weblogic.ejb.GenericEntityBean</td><td>javax.ejb.EntityBean</td>
</tr>
<tr>
<td>2</td><td>weblogic.ejb.GenericMessageDrivenBean</td><td>javax.ejb.MessageDrivenBean</td>
</tr>
<tr>
<td>3</td><td>wweblogic.ejb.GenericSessionBean</td><td>javax.ejb.SessionBean</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
					
</p>
</li>
<li class="listitem">
<p>デプロイメントディスクリプタの移行</p>
<p>weblogic-ejb-jar.xmlからjboss-ejb3.xmlへの移行する。デプロイメントディスクリプタの移行方法の詳細は「デプロイメントデスクリプタの移行」を参照。ヘッダ部分については以下のように移植すること
					</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>なお、WebLogicではweblogic.ejbgenパッケージを利用したWebLogic独自のアノテーションによりweblogic-ejb-jar.xmlのデプロイメントディスクリプタと同等な設定がBean自体(javaファイル)に可能である。WebLogic独自のアノテーションによりBean自体に定義を行っている場合、weblogic-ejb-jar.xmlのデプロイメントディスクリプタとの対応を確認し、WebLogic独自のアノテーションで定義した内容をjboss-ejb3.xmlに移行する必要がある。
						</p>
</td>
</tr>
</table>
</div>
<div class="figure">
<a name="N155C9"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-ejb-jar.xmlのヘッダ例
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;weblogic-ejb-jar
  xmlns="http://www.bea.com/ns/weblogic/90" xmlns:j2ee="http://java.sun.com/xml/ns/j2ee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.bea.com/ns/weblogic/90 http://www.bea.com/ns/weblogic/90/weblogic-ejb-jar.xsd"&gt;

						</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N155D3"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jboss-ejb3.xmlのヘッダ例
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
 xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
 http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"
 version="3.1" impl-version="2.0"&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>JNDIの移行</p>
<p>プロパティファイルまたは、ハードコーディングされた実装固有のJNDIを削除し、JBossでも適用できるように置換する。詳細は「JNDIの移行」を参照。</p>
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1."></a>
<h3 class="title">1.5.1.デプロイメントデスクリプタの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogic固有のデプロイメント・ディスクリプタであるweblogic-ejb-jar.xmlをJBossのデプロイメントディスクリプタであるjboss-ejb3.xmlに移行を行う。  </p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>以下のWebLogic基底クラスを拡張し、WebLogic独自のアノテーション設定で、デプロイメントディスクリプタファイルで定義できる内容をEJB(Bean)のJavaファイル上に定義することができる。
         </p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>weblogic.ejb.GenericSessionBean</p>
</li>
<li class="listitem">
<p>weblogic.ejb.GenericMessageDrivenBean</p>
</li>
</ul>
</div>
<p>
         WebLogic独自のアノテーションで設定できるパラメータはweblogic-ejb-jar.xmlのデプロイメントディスクリプタと同等な定義が存在するので、本書の内容を参考に、WebLogic独自のアノテーションで定義した内容をjboss-ejb3.xmlに移行する必要がある。
        </p>
</td>
</tr>
</table>
</div>
</div>
<br>
<br>
<a name="tubame_1.5.1.1."></a>
<h3 class="title">1.5.1.1.StatelessSessionBeanの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>weblogic-ejb-jar.xmlのweblogic-enterprise-beanタグ配下のタグの対応表を以下に示す
		</p>
<div class="table">
<a name="N14B21"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;タグの変換対応表（Stateless Session Bean）
			</b>
</p>
<div class="table-contents">
<table summary="タグの変換対応表（Stateless Session Bean）
			" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>WebLogic<p>weblogic-ejb-jar.xml</p>
                        
</th><th>JBoss</th><th>参考章項目</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>weblogic-ejb-jar</td><td>jboss</td><td rowspan="9">「デプロイメントディスクリプタ定義の移行」を参照</td>
</tr>
<tr>
<td>2</td><td>weblogic-enterprise-bean</td><td>enterprise-beans</td>
</tr>
<tr>
<td>3</td><td>stateless-session-descriptor</td><td>session</td>
</tr>
<tr>
<td>4</td><td>weblogic-enterprise-bean/ejb-name</td><td>ejb-name</td>
</tr>
<tr>
<td>5</td><td>weblogic-enterprise-bean/jndi-name</td><td>対応なし</td>
</tr>
<tr>
<td>6</td><td>weblogic-enterprise-bean/local-jndi-name</td><td>対応なし</td>
</tr>
<tr>
<td>7</td><td>reference-descriptor/resource-description</td><td>resource-ref</td>
</tr>
<tr>
<td>8</td><td>reference-descriptor/resource-env-description</td><td>resource-env-ref</td>
</tr>
<tr>
<td>9</td><td>reference-descriptor/ejb-reference-description</td><td>ejb-ref</td>
</tr>
<tr>
<td>10</td><td>stateless-session-descriptor/pool</td><td>&nbsp;</td><td rowspan="3">EJBインスタンスプール関連タグの移行</td>
</tr>
<tr>
<td>12</td><td>stateless-session-descriptor/pool/initial-beans-in-free-pool</td><td>該当なし：JBossの場合デフォルトで0が設定される</td>
</tr>
<tr>
<td>11</td><td>stateless-session-descriptor/pool/max-beans-in-free-pool</td><td>MaximumSize</td>
</tr>
<tr>
<td>13</td><td>stateless-session-descriptor/stateless-clustering</td><td>clustered</td><td>「クラスタリング関連タグの変換方法」を参照</td>
</tr>
<tr>
<td>14</td><td>transaction-descriptor/trans-timeout-seconds</td><td>&nbsp;</td><td rowspan="7">「トランザクション関連タグの変換方法」を参照 </td>
</tr>
<tr>
<td>15</td><td>transaction-isolation</td><td>&nbsp;</td>
</tr>
<tr>
<td>16</td><td>transaction-isolation/isolation-level</td><td>&nbsp;</td>
</tr>
<tr>
<td>17</td><td>transaction-isolation/isolation-level/method</td><td>&nbsp;</td>
</tr>
<tr>
<td>18</td><td>transaction-isolation/isolation-level/description</td><td>&nbsp;</td>
</tr>
<tr>
<td>19</td><td>transaction-isolation/isolation-level/method-intf</td><td>&nbsp;</td>
</tr>
<tr>
<td>20</td><td>transaction-isolation/isolation-level/method-name</td><td>&nbsp;</td>
</tr>
<tr>
<td>21</td><td>clients-on-same-server</td><td>移行不要</td><td>&nbsp;</td>
</tr>
<tr>
<td>22</td><td>disable-warning</td><td>移行不要</td><td>&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
</div>
<br>
<br>
<a name="tubame_1.5.1.1.1."></a>
<h3 class="title">1.5.1.1.1.SLSBデプロイメントディスクリプタ定義の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>weblogic-enterprise-bean配下にstateless-session-descriptorが設定されている場合は、jboss-ejb3.xmlのenterprise-beans配下の&rdquo;session&rdquo;として置き換えて設定する。</p>
<div class="figure">
<a name="N14BDF"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-ejb-jar.xmlの例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
&lt;weblogic-ejb-jar
  xmlns="http://www.bea.com/ns/weblogic/90" xmlns:j2ee="http://java.sun.com/xml/ns/j2ee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.bea.com/ns/weblogic/90 http://www.bea.com/ns/weblogic/90/weblogic-ejb-jar.xsd"&gt;
    &lt;weblogic-enterprise-bean&gt;
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;stateless-session-descriptor&gt;&lt;/stateless-session-descriptor&gt;
    &lt;reference-descriptor&gt;
      &lt;ejb-reference-description&gt;
        &lt;ejb-ref-name&gt;□□□&lt;/ejb-ref-name&gt;
        &lt;jndi-name&gt;■■■&lt;/jndi-name&gt;
      &lt;/ejb-reference-description&gt;
    &lt;jndi-name&gt;&times;&times;&times;&lt;/jndi-name&gt;
    &lt;local-jndi-name&gt;&times;&times;&times;&lt;/local-jndi-name&gt; 
    ...

            </pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N14BE9"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jboss-ejb3.xmlの例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
 xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
 http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"
 version="3.1" impl-version="2.0"&gt;
  &lt;enterprise-beans&gt;
   &lt;session&gt;
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;ejb-ref&gt;
     &lt;ejb-ref-name&gt;□□□&lt;/ejb-ref-name&gt;
     &lt;jndi-name&gt;※■■■&lt;/jndi-name&gt;
    &lt;/ejb-ref&gt;

            </pre>
</div>
</div>
<br class="figure-break">
<p>weblogic-ejb-jar.xmlではstateless-session-descriptorの指定が省略可能であり、なお、weblogic-ejb-jar.xmlではstateless-session-descriptorの指定が省略可能であり、指定の無い場合はejb-jar.xmlのsessionタグ及び、session-typeタグのパラメータが&rdquo;Stateless&rdquo;であることを判断した上でタグの設定を行う</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.1.2."></a>
<h3 class="title">1.5.1.1.2.SLSBインスタンスプール関連タグの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではweblogic-ejb-jar.xmlのpoolタグにより、EJBインスタンスプール設定を行う。JBossの場合は、以下の手順でEJBインスタンスプールの設定を行う

		</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>EJBのインスタンスプール設定を管理CLIより登録する。以下にweblogic-ejb-jar.xmlのnameタグに指定された値が「TestBean」の場合を想定して、インスタンスプール「TestBeanPool」を登録する例を示す。またweblogic-ejb-jar.xmlのmax-beans-in-free-poolタグで
					設定されるインスタンスプールの上限値の設定を、JBossのインスタンスプール設定のmax-pool-sizeに設定する。なおインスタンスプールの下限値についてはJBossでは設定されないので注意すること。
				</p>
<div class="figure">
<a name="N14C05"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;EJBのインスタンスプール設定を管理CLIより登録する.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
#EJBインスタンスプール「TestBeanPool」の登録
[standalone@localhost:9999/] /subsystem=ejb3/strict-max-bean-instance-pool=TestBeanPool:add (max-pool-size=25)
{"outcome" =&gt; "success"}

#結果確認
[standalone@localhost:9999/]
 /subsystem=ejb3/strict-max-bean-instance-pool=TestBeanPool:read-resource()
--(CLIで上記をオペレーション実行し、成功すると以下のように表示される)---
{
    "outcome" =&gt; "success",
    "result" =&gt; {
        "max-pool-size" =&gt; 25,
        "name" =&gt; "TestBeanPool",
        "timeout" =&gt; 5L,
        "timeout-unit" =&gt; "MINUTES"
    }
}

					</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>
					デプロイメントデスクリプタファイル(jboss-ejb3.xml）を作成し、EJBに対してインスタンスプールのリファレンス(bean-instance-pool-ref)を設定する
					</p>
<div class="figure">
<a name="N14C12"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jboss-ebj3.xmlのインスタンスプール設定</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jboss xmlns="http://java.sun.com/xml/ns/javaee" xmlns:p="urn:ejb-pool:1.0"&gt;
  &lt;assembly-descriptor&gt;
    &lt;p:pool&gt;
      &lt;ejb-name&gt;TestBean&lt;/ejb-name&gt;
       &lt;p:bean-instance-pool-ref&gt;TestBeanPool&lt;/p:bean-instance-pool-ref&gt;
    &lt;/p:pool&gt;
  &lt;/assembly-descriptor&gt;
&lt;/jboss&gt;

						</pre>
</div>
</div>
<p>
<br class="figure-break">
				
</p>
</li>
</ol>
</div>
</div>
<br>
<br>
<a name="tubame_1.5.1.1.3."></a>
<h3 class="title">1.5.1.1.3.SLSBクラスタリング関連タグの変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではweblogic-ejb-jar.xmlのstateless-clusteringタグでEJBクラスタリングの設定を行う。

			</p>
<div class="figure">
<a name="N14C29"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogicのEJBクラスタリングの設定).</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;weblogic-ejb-jar  xmlns="http://www.bea.com/ns/weblogic/90" ...&gt;
...
  &lt;stateless-clustering&gt;
    &lt;use-serverside-stubs&gt;false&lt;/use-serverside-stubs&gt;
    &lt;stateless-bean-is-clusterable&gt;true&lt;/stateless-bean-is-clusterable&gt;
    &lt;stateless-bean-load-algorithm&gt;random&lt;/stateless-bean-load-algorithm&gt;
    &lt;stateless-bean-call-router-class-name&gt;beanRouter&lt;/stateless-bean-call-router-class-name&gt;
    &lt;stateless-bean-methods-are-idempotent&gt;true&lt;/stateless-bean-methods-are-idempotent&gt;
  &lt;/stateless-clustering&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			WebLogicにおけるEJBクラスタリング設定について以下の表に示す。

			</p>
<div class="table">
<a name="N14C34"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;WebLogicのEJBクラスタ設定内容
				</b>
</p>
<div class="table-contents">
<table summary="WebLogicのEJBクラスタ設定内容
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>
								タグ
							</th><th>設定内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>use-serverside-stubs</td><td>

<p>true | false（デフォルト）</p>Bean ホームがサーバのコンテキストでサーバサイド スタブを使用する。</td>
</tr>
<tr>
<td>2</td><td>stateless-bean-is-clusterable</td><td>

<p>Beanをクラスタ化するかを指定.True | False</p>ホーム スタブの呼び出しは、Bean がデプロイされるサーバ間で負荷分散する。Bean のホスト サーバにアクセスできなかった場合、呼び出しは、Bean を提供する他のサーバに自動的にフェイルオーバする</td>
</tr>
<tr>
<td>3</td><td>stateless-bean-load-algorithm</td><td>

<p>ロードバランスアルゴリズムを指定</p>round-robin | random | weight-based | round-robin-affinity | weight-based-affinity | random-affinity</td>
</tr>
<tr>
<td>4</td><td>stateless-bean-call-router-class-name</td><td>ルーティングを拡張できる(This class must implement weblogic.rmi.extensions.CallRouter)ルーティング拡張クラスを指定する。</td>
</tr>
<tr>
<td>5</td><td>stateless-bean-methods-are-idempotent</td><td>

<p>True | False</p>True に設定すると、Bean を提供する他のサーバが使用できるようになっている限り、Bean スタブは障害から自動的に回復する。
(WebLogic9で非推奨)</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
		
</p>
<p>JBossではClusteredアノテーションまたは、jboss-ejb3.xmlにclusterdを付与することで、クラスタ対応化される。クラスタ環境であれば、ejb-client-libraryにより透過的に負荷分散アルゴリズム（org.jboss.ejb.client.RandomClusterNodeSelector)が適用される。
		JBossEAP6では、ロードバランスアルゴリズムはランダムのみサポートで、WebLogicのようなランダムロビンなどのアルゴリズムはサポートしない。
		</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>EJBをlookupしたproxyインスンタスを作成するたびにorg.jboss.ejb.client.RandomClusterNodeSelectorによりノードの選択が実施されるので、最初に作成したproxyインスンタスを再利用すれば、あらたにノードを選択されることがないため、負荷分散先を一つのノードにすることができる。</p>
<p>http://blog.akquinet.de/2012/11/09/load-balancing-and-failover-of-remote-ejb-clients-in-eap6-and-jboss-as7/</p>
</td>
</tr>
</table>
</div>
</div>
<br>
<br>
<a name="tubame_1.5.1.2."></a>
<h3 class="title">1.5.1.2.StatefullSessionBeanの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>weblogic-ejb-jar.xmlのweblogic-enterprise-beanタグ配下のタグの対応表を以下に示す
		</p>
<div class="table">
<a name="N14C85"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;タグの変換対応表（Statefull Session Bean）
			</b>
</p>
<div class="table-contents">
<table summary="タグの変換対応表（Statefull Session Bean）
			" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>WebLogic<p>weblogic-ejb-jar.xml</p>
                        
</th><th>JBoss</th><th>参考章項目</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>weblogic-ejb-jar</td><td>jboss</td><td rowspan="9">「デプロイメントディスクリプタ定義の移行」を参照</td>
</tr>
<tr>
<td>2</td><td> weblogic-enterprise-bean</td><td>session</td>
</tr>
<tr>
<td>3</td><td>  stateful-session-descriptor</td><td>session</td>
</tr>
<tr>
<td>4</td><td>  ejb-name</td><td>ejb-name</td>
</tr>
<tr>
<td>5</td><td>  jndi-name</td><td>対応なし</td>
</tr>
<tr>
<td>6</td><td>  local-jndi-name</td><td>対応なし</td>
</tr>
<tr>
<td>7</td><td>  reference-descriptor/resource-description</td><td>resource-ref</td>
</tr>
<tr>
<td>8</td><td>  reference-descriptor/resource-env-description</td><td>resource-env-ref</td>
</tr>
<tr>
<td>9</td><td>reference-descriptor/ejb-reference-description</td><td>ejb-ref</td>
</tr>
<tr>
<td>10</td><td>stateful-session-descriptor/persistent-store-dir</td><td>relative-to</td><td rowspan="6">「EJBインスタンスキャッシュ関連タグの変換方法」を参照</td>
</tr>
<tr>
<td>11</td><td>stateful-session-descriptor/stateful-session-cache</td><td>-</td>
</tr>
<tr>
<td>12</td><td>  stateful-session-descriptor/stateful-session-cache/max-beans-in-cache</td><td>max-size</td>
</tr>
<tr>
<td>13</td><td>  stateful-session-descriptor/stateful-session-cache/idle-timeout-seconds</td><td>idle-timeout</td>
</tr>
<tr>
<td>14</td><td> stateful-session-descriptor/stateful-session-cache/session-timeout-seconds</td><td>該当なし</td>
</tr>
<tr>
<td>15</td><td>stateful-session-descriptor/stateful-session-cache/cache-type</td><td>&nbsp;</td>
</tr>
<tr>
<td>16</td><td>  stateful-session-clustering</td><td>&nbsp;</td><td>「クラスタリング関連タグの変換方法」を参照</td>
</tr>
<tr>
<td>17</td><td>  transaction-descriptor/trans-timeout-seconds</td><td>&nbsp;</td><td rowspan="7">「トランザクション関連タグの変換方法」を参照 </td>
</tr>
<tr>
<td>18</td><td> transaction-isolation</td><td>&nbsp;</td>
</tr>
<tr>
<td>19</td><td> transaction-isolation/isolation-level</td><td>&nbsp;</td>
</tr>
<tr>
<td>20</td><td> transaction-isolation/isolation-level/method</td><td>&nbsp;</td>
</tr>
<tr>
<td>21</td><td> transaction-isolation/isolation-level/method/ejb-name</td><td>移行不要</td>
</tr>
<tr>
<td>22</td><td> transaction-isolation/isolation-level/method/method-intf</td><td>移行不要</td>
</tr>
<tr>
<td>23</td><td> transaction-isolation/isolation-level/method/method-name</td><td>&nbsp;</td>
</tr>
<tr>
<td>24</td><td>clients-on-same-server</td><td>&nbsp;</td><td>&nbsp;</td>
</tr>
<tr>
<td>25</td><td>disable-warning</td><td>不要</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>26</td><td>enable-call-by-reference</td><td>&nbsp;</td><td>「その他タグの変換方法」を参照</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
</div>
<br>
<br>
<a name="tubame_1.5.1.2.1."></a>
<h3 class="title">1.5.1.2.1.SFSBデプロイメントディスクリプタ定義の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>weblogic-enterprise-bean配下にstatefull-session-descriptorが設定されている場合は、jboss-ejb3.xmlのenterprise-beans配下の&rdquo;session&rdquo;として置き換え、ejb-name、jndi-nameタグはsessionタグの子要素として設定する。</p>
<div class="figure">
<a name="N14D5F"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-ejb-jar.xmlの例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
&lt;weblogic-ejb-jar  xmlns="http://www.bea.com/ns/weblogic/90" ...&gt;
  &lt;weblogic-enterprise-bean&gt;
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;stateful-session-descriptor&gt;&lt;/stateful-session-descriptor&gt;
    &lt;reference-descriptor&gt;
      &lt;ejb-reference-description&gt;
        &lt;ejb-ref-name&gt;□□□&lt;/ejb-ref-name&gt;
        &lt;jndi-name&gt;■■■&lt;/jndi-name&gt;
      &lt;/ejb-reference-description&gt;
    &lt;/reference-descriptor&gt;
    &lt;jndi-name&gt;&times;&times;&times;&lt;/jndi-name&gt;
    &lt;local-jndi-name&gt;&times;&times;&times;&lt;/local-jndi-name&gt; 
    ...

            </pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N14D69"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jboss-ejb3.xmlの例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
 xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
 http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"
 version="3.1" impl-version="2.0"&gt;
  &lt;enterprise-beans&gt;
    &lt;session&gt;
      &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
      &lt;ejb-ref&gt;
        &lt;ejb-ref-name&gt;□□□&lt;/ejb-ref-name&gt;
        &lt;jndi-name&gt;※■■■&lt;/jndi-name&gt;
      &lt;/ejb-ref&gt;
    &lt;/session&gt;
  &lt;/enterprise-beans&gt;

            </pre>
</div>
</div>
<br class="figure-break">
<p>weblogic-ejb-jar.xmlではstateful-session-descriptorの指定が省略可能であり、指定の無い場合はejb-jar.xmlのsessionタグ及び、session-typeタグのパラメータが&rdquo;Stateful&rdquo;であることを判断した上でタグの設定を行う</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.2.2."></a>
<h3 class="title">1.5.1.2.2.SFSBインスタンスキャッシュ関連タグの変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではweblogic-ejb-jar.xmlのstateful-session-descriptorタグ配下のstateful-session-cacheにてEJBインスタンスキャッシュ設定を行う。

			JBossではEJBインスタンスキャッシュ設定は、ejb3およびinfinispanサブシステムで設定を行う。なおEJBインスタンスキャッシュ設定の移行はWebLogicとJBossで異なり単純なタグの置き換えレベルでは移行できないため、JBossの挙動に準拠した設定が必要である。
		</p>
<p>
			JBossでは環境により、simple、passivating、clusterdのいづれかのキャッシュ設定が適用される。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>非クラスタ環境ではsimpleキャッシュが利用される(パッシベート実施されない)。</p>
</li>
<li class="listitem">
<p>非クラスタ環境(明示的にpassivatingアノテーションを付与）では、passvatingキャッシュが利用される(ファイルにパッシベートが実施される）。
					</p>
</li>
<li class="listitem">
<p>クラスタ環境(明示的にclusterdアノテーションを付与。またはクラスタ構成環境ではアノテーション付与は必要なく、自動で設定される）では、clusterdキャッシュが適用される(infinispanのキャッシュ機構でファイルにパッシベートされる）。
					</p>
</li>
</ul>
</div>
<p>

			キャッシュ設定に関して注意点及び、参考情報を示す。移行する際には以下の5点を参考にすること。

			</p>
<div class="figure">
<a name="N154D9"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogicのキャッシュ設定(weblogic-ejb-jar.xmlのstateful-session-cache)
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
・・・
&lt;weblogic-enterprise-bean&gt;
	&lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
	&lt;stateful-session-descriptor&gt;
	      &lt;stateful-session-cache&gt;                     
			&lt;max-beans-in-cache&gt;●●●&lt;/max-beans-in-cache&gt;
			&lt;idle-timeout-seconds&gt;□□□&lt;/idle-timeout-seconds&gt;
			&lt;session-timeout-seconds&gt;■■■&lt;/session-timeout-seconds&gt;
			&lt;cache-type&gt;△△△&lt;/cache-type&gt;
		  &lt;/stateful-session-cache&gt;
		  &lt;persistent-store-dir&gt;△△△&lt;/persistent-store-dir&gt;
	&lt;/stateful-session-descriptor&gt;
・・・

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>キャッシュの設定（max-beans-in-cacheの移行）</p>
<p>WebLogicでは、&rdquo;max-bans-in-cache&rdquo;にてキャッシュサイズをバイト単位またはメガバイト単位で指定する。
					</p>
<p>
						JBossでは、以下の通りである
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>非クラスタ環境</p>
<p>simple及びpassvatingキャッシュでは、キャッシュの上限を設定することができない。
								</p>
</li>
<li class="listitem">
<p>クラスタ環境</p>
<p>clusterdキャッシュでは/subsystem=infinispan/cache-container=ejb/replicaed-cache=replリソースのeviction属性のmax-entriesに、キャッシュ内のBeanのエントリ数の上限が設定可能である。
								</p>
<div class="figure">
<a name="N154F7"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;管理CLIによる設定.
									</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
										
/subsystem=infinispan/cache-container=ejb/replicated-cache=repl/eviction=EVICTION:write-attribute(name=max-entries,value=10000)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}

									</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>
					
</p>
</li>
<li class="listitem">
<p>キャッシュアルゴリズムの設定（cache-typeの移行）</p>
<p>WebLogicでは&rdquo;cache-type&rdquo;はデフォルトでNRU（Not Recently
						Used）で設定変更によりLRUも設定可能である。
					</p>
<p>
						JBossの場合は、NRUには未対応で以下のようになる。
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>非クラスタ環境</p>
<p>simple及びpassvatingキャッシュでは、EVICTアルゴリズムは選択できない。
								</p>
</li>
<li class="listitem">
<p>クラスタ環境</p>
<p>/subsystem=infinispan/cache-container=ejb/replicaed-cache=replリソースのeviction属性のstrategyでLRUが設定可能。これらのほかにFIFO,LRU,LIRSが設定可能。
								</p>
<div class="figure">
<a name="N15514"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;管理CLIによる設定.
									</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
										
/subsystem=infinispan/cache-container=ejb/replicated-cache=repl/eviction=EVICTION:write-attribute(name=strategy,value=LIRS)
{
    "outcome" =&gt; "success",
    "response-headers" =&gt; {
        "operation-requires-reload" =&gt; true,
        "process-state" =&gt; "reload-required"
    }
}

									</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>

					
</p>
</li>
<li class="listitem">
<p>キャッシュに保持される最長時間設定（idle-timeout-secondsの移行）</p>
<p>WebLogicでは、&rdquo;idle-timeout-seconds&rdquo;にてEJB単位でキャッシュに保持される最長時間（秒単位）を定義する
					</p>
<p>
						JBossの場合は、以下のようになる。
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>非クラスタ環境</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
											simpleキャッシュ
										</span>
</dt>
<dd>
<p>パッシベートしなたいめ、該当パラメータなし</p>
</dd>
<dt>
<span class="term">
											passviateキャッシュ
										</span>
</dt>
<dd>
<p>/subsystem=ejb3/file-passivation-store=fileリソースのidle-timeoutで設定可能
											</p>
<div class="figure">
<a name="N15537"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;管理CLIによる設定.
												</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
													
/subsystem=ejb3/file-passivation-store=file:write-attribute(name=idle-timeout,value=300L)

												</pre>
</div>
</div>
<br class="figure-break">
</dd>
</dl>
</div>
</li>
<li class="listitem">
<p>クラスタ環境</p>
<p>/subsystem=ejb3/cluster-passivation-store=infinispanリソースのidle-timeoutで設定可能
								</p>
<div class="figure">
<a name="N15546"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;管理CLIによる設定.
									</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
										
/subsystem=ejb3/cluster-passivation-store=infinispan:write-attribute(name=idle-timeout,value=300L)

									</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>

					
</p>
</li>
<li class="listitem">
<p>パッシベート時の永続化ディレクトリ設定（persistent-store-dirの移行）</p>
<p>WebLogicでは&rdquo;persistent-store-dir&rdquo;にて非活性化されたステートフル セッション
						Bean
						インスタンスを格納するディレクトリを指定できる
					</p>
<p>
						JBossの場合は、以下のようになる。
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>非クラスタ環境</p>
<div class="variablelist">
<dl class="variablelist">
<dt>
<span class="term">
											simpleキャッシュ
										</span>
</dt>
<dd>
<p>パッシベートしなたいめ、該当パラメータなし</p>
</dd>
<dt>
<span class="term">
											passviateキャッシュ
										</span>
</dt>
<dd>
<p>/subsystem=ejb3/file-passivation-store=fileリソースのrelative-toで設定可能。デフォルトではjboss.server.data.dirが設定
											</p>
<div class="figure">
<a name="N15569"></a>
<p class="title">
<b>Figure&nbsp;6.&nbsp;管理CLIによる設定.
												</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
													
/subsystem=ejb3/file-passivation-store=file:write-attribute(name=relative-to,value=パス)

												</pre>
</div>
</div>
<br class="figure-break">
</dd>
</dl>
</div>
</li>
<li class="listitem">
<p>クラスタ環境</p>
<p>/subsystem=ejb3/cluster-passivation-store=infinispanリソースのfile-storeのrelative-toで設定可能。デフォルトではjboss.server.data.dirが設定
								</p>
<div class="figure">
<a name="N15578"></a>
<p class="title">
<b>Figure&nbsp;7.&nbsp;管理CLIによる設定.
									</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
										
/subsystem=infinispan/cache-container=ejb/replicated-cache=repl/file-store=FILE_STORE:write-attribute(name=relative-to,value=path)

									</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>非活性化ストアに保持される最長時間設定（session-timeout-secondsの移行）</p>
<p>WebLogicでは、&rdquo;session-timeout-seconds&rdquo;にて非活性化されたBeanをどのくらい非活性化ストアに置いておくのかを指定（秒単位）する
								</p>
<p>JBossでは該当パラメータは存在しない</p>
</li>
</ul>
</div>
<p>

					
</p>
</li>
</ol>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.2.3."></a>
<h3 class="title">1.5.1.2.3.SFSBクラスタリング関連タグの変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではweblogic-ejb-jar.xmlのstateful-clusteringタグでEJBクラスタリングの設定を行う。

			</p>
<div class="figure">
<a name="N14D81"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogicのEJBクラスタリングの設定.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;weblogic-ejb-jar  xmlns="http://www.bea.com/ns/weblogic/90" ...&gt;
...
  &lt;stateful-session-clustering&gt;
 
    ...
  &lt;/stateful-session-clustering&gt;
  
 
				</pre>
</div>
</div>
<p>
<br class="figure-break">

			
</p>
<div class="table">
<a name="N14D8C"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;WebLogicのEJBクラスタ設定内容
				</b>
</p>
<div class="table-contents">
<table summary="WebLogicのEJBクラスタ設定内容
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>
								タグ
							</th><th>設定内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>use-serverside-stubs</td><td>

<p>true | false（デフォルト）</p>Bean ホームがサーバのコンテキストでサーバサイド スタブを使用する。</td>
</tr>
<tr>
<td>2</td><td>home-is-clusterable</td><td>

<p>Beanをクラスタ化するかを指定.True | False</p>ホーム スタブの呼び出しは、Bean がデプロイされるサーバ間で負荷分散する。Bean のホスト サーバにアクセスできなかった場合、呼び出しは、Bean を提供する他のサーバに自動的にフェイルオーバする</td>
</tr>
<tr>
<td>3</td><td>home-load-algorithm</td><td>

<p>ロードバランスアルゴリズムを指定</p>round-robin | random | weight-based | round-robin-affinity | weight-based-affinity | random-affinity</td>
</tr>
<tr>
<td>4</td><td>home-call-router-class-name</td><td>ルーティングを拡張できる(This class must implement weblogic.rmi.extensions.CallRouter)ルーティング拡張クラスを指定する。</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
		
</p>
<p>JBossではClusteredアノテーションまたは、jboss-ejb3.xmlにclusterdを付与することで、クラスタ対応化される。クラスタ環境であれば、ejb-client-libraryにより透過的に負荷分散アルゴリズム（org.jboss.ejb.client.RandomClusterNodeSelector)が適用される。
		JBossEAP6では、ロードバランスアルゴリズムはランダムのみサポートで、WebLogicのようなランダムロビンなどのアルゴリズムはサポートしない。
		</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>EJBをlookupしたproxyインスンタスを作成するたびにorg.jboss.ejb.client.RandomClusterNodeSelectorによりノードの選択が実施されるので、最初に作成したproxyインスンタスを再利用すれば、あらたにノードを選択されることがないため、負荷分散先を一つのノードにすることができる。</p>
<p>http://blog.akquinet.de/2012/11/09/load-balancing-and-failover-of-remote-ejb-clients-in-eap6-and-jboss-as7/</p>
</td>
</tr>
</table>
</div>
</div>
<br>
<br>
<a name="tubame_1.5.1.3."></a>
<h3 class="title">1.5.1.3.EntityBeanの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			Entity Beanでは以下の２つのデプロイメントディスクリプタが存在し、それぞれJBoss独自のデプロイメントディスクリプタに移植する必要がある
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>EJB用デプロイメントディスクリプタ</p>
<p>weblogic-ejb-jar.xmlからjboss-ejb3.xmlへ変換する</p>
</li>
<li class="listitem">
<p>EJB用デプロイメントディスクリプタ</p>
<p>weblogic-cmp-rdbms-jar.xmlからjbosscmp-jdbc.xmlへ変換する</p>
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.1."></a>
<h3 class="title">1.5.1.3.1.EntityBeanデプロイメントディスクリプタ定義の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>weblogic-ejb-jar.xmlからjboss-ejb3.xmlへ移行する。weblogic-ejb-jar.xmlのEntity Beanに関連するタグとjboss-ejb3.xmlの対応表を以下に示す
		</p>
<div class="table">
<a name="N14DD3"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;タグの変換対応表（Entity Bean）
			</b>
</p>
<div class="table-contents">
<table summary="タグの変換対応表（Entity Bean）
			" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>WebLogic<p>weblogic-ejb-jar.xml</p>
                        
</th><th>JBoss</th><th>参考章項目</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>weblogic-ejb-jar</td><td>jboss</td><td rowspan="9">「デプロイメントディスクリプタ定義の移行」を参照</td>
</tr>
<tr>
<td>2</td><td> weblogic-enterprise-bean</td><td>session</td>
</tr>
<tr>
<td>3</td><td>  entity-descriptor</td><td>session</td>
</tr>
<tr>
<td>4</td><td>  ejb-name</td><td>ejb-name</td>
</tr>
<tr>
<td>5</td><td>  weblogic-enterprise-bean/jndi-name</td><td>対応なし</td>
</tr>
<tr>
<td>6</td><td>  weblogic-enterprise-bean/local-jndi-name</td><td>対応なし</td>
</tr>
<tr>
<td>7</td><td>  reference-descriptor/resource-description</td><td>resource-ref</td>
</tr>
<tr>
<td>8</td><td>  reference-descriptor/resource-env-description</td><td>resource-env-ref</td>
</tr>
<tr>
<td>9</td><td>  reference-descriptor/ejb-reference-description</td><td>ejb-ref</td>
</tr>
<tr>
<td>10</td><td>entity-descriptor/pool</td><td>JBossではEntityBeanのインスタンスプール設定はサポートしない</td><td rowspan="3">「EJBインスタンスプール関連タグの移行」を参照</td>
</tr>
<tr>
<td>11</td><td>  entity-descriptor/pool/max-beans-in-free-pool</td><td>MaximumSize</td>
</tr>
<tr>
<td>12</td><td>  entity-descriptor/pool/initial-beans-in-free-pool</td><td>max-size</td>
</tr>
<tr>
<td>13</td><td>  entity-descriptor/entity-cache/max-beans-in-cache</td><td>idle-timeout</td><td rowspan="4">「EJBインスタンスキャッシュ関連タグの変換方法」を参照</td>
</tr>
<tr>
<td>14</td><td>  entity-descriptor/entity-cache/idle-timeout-seconds</td><td>&nbsp;</td>
</tr>
<tr>
<td>15</td><td>  entity-descriptor/entity-cache/read-timeout-seconds</td><td>jbosscmp-jdbc.xmlのread-only：True 及びread-time-out にて設定</td>
</tr>
<tr>
<td>16</td><td>  entity-descriptor/entity-cache/concurrency-strategy</td><td>デフォルトではpessmisticだが、jbosscmp-jdbc.xmlの optimistic-lockingタグの子要素でチューニング可能
                        </td>
</tr>
<tr>
<td>17</td><td> entity-descriptor/persistence/delay-updates-until-end-of-tx</td><td>insert-after-ejb-post-create</td><td rowspan="5">「EntityBeanの永続化設定の変換方法タグの変換方法」を参照</td>
</tr>
<tr>
<td>18</td><td>entity-descriptor/persistence/finders-load-bean</td><td>jbosscmp-jdbc.xmlのread-ahead/strategyにて設定</td>
</tr>
<tr>
<td>19</td><td> entity-descriptor/persistence-use/type-identifier</td><td>移行不要</td>
</tr>
<tr>
<td>20</td><td> entity-descriptor/persistence-use/type-version</td><td>移行不要</td>
</tr>
<tr>
<td>21</td><td> entity-descriptor/persistence-use/type-storage</td><td>移行不要</td>
</tr>
<tr>
<td>22</td><td> entity-clustering</td><td>移植できない</td><td>&nbsp;</td>
</tr>
<tr>
<td>17</td><td> transaction-descriptor/trans-timeout-seconds</td><td>&nbsp;</td><td rowspan="7">「トランザクション関連タグの変換方法」を参照。※Stateless Session Beanの移行方法で示した設定内容と同等である</td>
</tr>
<tr>
<td>18</td><td>transaction-isolation</td><td rowspan="6">ejb-jar.xml及び、データソース設定にて設定</td>
</tr>
<tr>
<td>19</td><td> transaction-isolation/isolation-level</td>
</tr>
<tr>
<td>20</td><td> transaction-isolation/isolation-level/method</td>
</tr>
<tr>
<td>21</td><td> transaction-isolation/isolation-level/method/ejb-name</td>
</tr>
<tr>
<td>22</td><td> transaction-isolation/isolation-level/method/method-intf</td>
</tr>
<tr>
<td>23</td><td> transaction-isolation/isolation-level/method/method-name</td>
</tr>
<tr>
<td>24</td><td>clients-on-same-server</td><td>移行不要</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>25</td><td>disable-warning</td><td>移行不要</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>26</td><td>enable-call-by-reference</td><td>&nbsp;</td><td class="auto-generated">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
</div>
<br>
<br>
<a name="tubame_1.5.1.3.1.1."></a>
<h3 class="title">1.5.1.3.1.1.デプロイメントディスクリプタ定義の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>weblogic-enterprise-bean配下にentity-descriptorが設定されている場合は、jboss-ejb3.xmlのenterprise-beans配下の&rdquo;entity&rdquo;として置き換え、ejb-name、jndi-nameタグはsessionタグの子要素として設定する。</p>
<div class="figure">
<a name="N14ED6"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-ejb-jar.xmlの例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
&lt;weblogic-ejb-jar  xmlns="http://www.bea.com/ns/weblogic/90" ...&gt;
  &lt;weblogic-enterprise-bean&gt;
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;entity-descriptor&gt;&lt;/entity-descriptor&gt;
    &lt;reference-descriptor&gt;
      &lt;ejb-reference-description&gt;
        &lt;ejb-ref-name&gt;□□□&lt;/ejb-ref-name&gt;
        &lt;jndi-name&gt;■■■&lt;/jndi-name&gt;
    &lt;/ejb-reference-description&gt;
    &lt;jndi-name&gt;&times;&times;&times;&lt;jndi-name&gt;
    &lt;local-jndi-name&gt;&times;&times;&times;&lt;/local-jndi-name&gt;

            </pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N14EE0"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jboss-ejb3.xmlの例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
 xmlns="http://java.sun.com/xml/ns/javaee"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
 http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"
 version="3.1" impl-version="2.0"&gt;
  &lt;enterprise-beans&gt;
    &lt;entity&gt;
      &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
      &lt;ejb-ref&gt;
        &lt;ejb-ref-name&gt;□□□&lt;/ejb-ref-name&gt;
	    &lt;jndi-name&gt;※■■■&lt;/jndi-name&gt;
      &lt;/ejb-ref&gt;
    &lt;/entity&gt;
&lt;/jboss:ejb-jar&gt;

            </pre>
</div>
</div>
<br class="figure-break">
<p>weblogic-ejb-jar.xmlではentity-descriptorの指定が省略可能であり、指定の無い場合はejb-jar.xmlのentityタグより判断した上でタグの設定を行う</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.1.2."></a>
<h3 class="title">1.5.1.3.1.2.EJBインスタンスプール関連タグの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではweblogic-ejb-jar.xmlのpoolタグにより、EJBインスタンスプール設定を行う。
			</p>
<div class="figure">
<a name="N14EF8"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-ejb-jar.xml</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;weblogic-ejb-jar  xmlns="http://www.bea.com/ns/weblogic/90" ...&gt;
  &lt;weblogic-enterprise-bean&gt;
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;entity-descriptor&gt;
     &lt;pool&gt;
      &lt;max-beans-in-free-pool&gt;□□□&lt;/max-beans-in-free-pool&gt;
      &lt;initial-beans-in-free-pool&gt;■■■&lt;/initial-beans-in-free-pool&gt;
     &lt;/pool&gt;
     ...
    &lt;/entity-descriptor&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>
JBossではEntityBeanのインスタンスプール設定はサポートしない。関連情報:https://issues.jboss.org/browse/AS7-6395
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.1.3."></a>
<h3 class="title">1.5.1.3.1.3.EJBインスタンスキャッシュ関連タグの変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicにはEntityBeanのインスタンスキャッシュ設定が可能で、キャッシュ設定が以下のように可能である。
			</p>
<div class="figure">
<a name="N14F11"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-ejb-jar.xml</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;weblogic-enterprise-bean&gt;
  &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
   &lt;entity-descriptor&gt;
    &lt;entity-cache&gt;
      &lt;max-beans-in-cache&gt;□□□&lt;/max-beans-in-cache&gt;
      &lt;idle-timeout-seconds&gt;■■■&lt;/idle-timeout-seconds&gt;
      &lt;read-timeout-seconds&gt;◇◇◇&lt;/read-timeout-seconds&gt;
      &lt;concurrency-strategy&gt;Exclusive&lt;/concurrency-strategy&gt;
    &lt;/entity-cache&gt;
   &lt;/entity-descriptor&gt;
   ...

				</pre>
</div>
</div>
<p>
<br class="figure-break">

		
</p>
<p>
			EntityBeanのキャッシュ設定は、WebLogicとJBossで異なり単純なタグの置き換えレベルでは移行できない。そのため、同等な機能として移行する際にはJBossの挙動に準拠した設定が必要である。

			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>キャッシュの上限値設定（max-beans-in-cacheの移行）</p>
<p>JBossではキャッシュの上限値を設定することができない</p>
</li>
<li class="listitem">
<p>キャッシュに保持される最長時間設定（idle-timeout-secondsの移行）</p>
<p>JBossではキャッシュに保持される最長時間設定を設定することができない</p>
</li>
<li class="listitem">
<p>ejbLoadメソッドの呼び出し間隔設定（read-timeout-secondsの移行）</p>
<p>JBossではjbosscmp-jdbc.xmlのdefaultsタグ配下の&rdquo;read-only&rdquo;にて読み取り専用のBeanとし、&rdquo;read-time-out&rdquo;にて読み取りが有効である期間（ミリ秒単位）を指定する
					</p>
</li>
<li class="listitem">
<p>コンテナがエンティティ
						Beanへの同時アクセスを管理するためのロック戦略を指定する(concurrency-strategyの移行)
					</p>
<div class="table">
<a name="N14F31"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;weblogic-ejb-jar.xml のconcurrency-strategyタグ設定</b>
</p>
<div class="table-contents">
<table summary="weblogic-ejb-jar.xml のconcurrency-strategyタグ設定" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>設定項目</th><th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>Exclusive</td><td>
										Bean がトランザクションに関連付けられている場合、WebLogic
										ServerはキャッシュされたエンティティEJBインスタンスを排他的にロックする。EJBインスタンスに対するリクエストは、トランザクションが完了するまでブロックされる。
									</td>
</tr>
<tr>
<td>2</td><td>Database（デフォルト）</td><td>
										エンティティEJBに対するリクエストのロックを基底のデータストアに委ねる。Database
										同時方式では、WebLogic
										Serverは、独立したエンティティBeanインスタンスを割り当て、ロックとキャッシングをデータベースが処理できるようにする。
									</td>
</tr>
<tr>
<td>3</td><td>ReadOnly</td><td>
										複数のリクエストが並行して処理されるように各トランザクションで新しいインスタンスをアクティブ化する。WebLogic
										Server は、read-timeout-seconds パラメータに基づいて ReadOnly Bean の
										ejbLoad() を呼び出す。
									</td>
</tr>
<tr>
<td>4</td><td>Optimistic</td><td>
										トランザクションの間に EJB コンテナまたはデータベースでロックを行わず、EJB
										コンテナは、トランザクションをコミットする前に、あるトランザクションが更新したデータが変化していないことを確かめる。更新データのどれかが変わっていた場合、EJB
										コンテナはトランザクションをロールバックする。
									</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
<p>
						JBossの場合は、Pessimisticロック以外には、Optimisticロックが設定可能であり、Optimisticロックの戦略として以下が設定可能である。
						</p>
<div class="table">
<a name="N14F5D"></a>
<p class="title">
<b>Table&nbsp;2.&nbsp;jbosscmp-jdbc.xmlにおけるPessimisticロックの種別について
							</b>
</p>
<div class="table-contents">
<table summary="jbosscmp-jdbc.xmlにおけるPessimisticロックの種別について
							" border="1">
<colgroup>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>設定項目</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>group-name</td>
</tr>
<tr>
<td>2</td><td>modified-strategy</td>
</tr>
<tr>
<td>3</td><td>read-strategy</td>
</tr>
<tr>
<td>4</td><td>version-column</td>
</tr>
<tr>
<td>5</td><td>timestamp-column</td>
</tr>
<tr>
<td>5</td><td>key-generator-factory</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
					
</p>
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.1.4."></a>
<h3 class="title">1.5.1.3.1.4.EntityBeanの永続化設定の変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではpersistence設定を行うことで、コンテナ管理の永続性サービスを指定でき、各エンティティBeanに対応させた設定が可能である
			</p>
<div class="table">
<a name="N14F95"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;persistenceタグ子要素の対応表</b>
</p>
<div class="table-contents">
<table summary="persistenceタグ子要素の対応表" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>設定項目</th><th>WebLogic</th><th>JBoss</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>永続ストレージの更新タイミングを指定</td><td>
								
<p>delay-updates-until-end-of-tx(デフォルトtrue)</p>Ture:トランザクションの完了時にトランザクションですべての Bean の永続ストレージを更新。False:各メソッド呼び出しの完了時にBeanの永続ストレージを更新するように指定
							</td><td>

<p>jbosscmp-jdbc.xmlのjbosscmp-jdbc/defaults/sync-on-commit-onlyで指定可能</p>true:コミット時に永続ストレージを更新。false:各メソッド呼び出しの完了時に永続ストレージを更新</td>
</tr>
<tr>
<td>2</td><td>キャッシュにロードするタイミングを指定</td><td>

<p>finders-load-bean(デフォルトtrue)</p>True（デフォルト）:Bean への参照がファインダによって返されると、Beanをキャッシュにロードする。False:最初のメソッドが呼び出されるまで Bean を自動的にロードしない</td><td>

<p>jbosscmp-jdbc.xmlのjbosscmp-jdbc/defaults/read-ahead/strategyに指定可能</p>on-load（デフォルト）:JBossではデフォルトでファインダの呼び出し時にBeanをキャッシュにロードする（設定等不要）。none:キャッシュへのロードを遅延する</td>
</tr>
<tr>
<td>3</td><td>CMPのBean定義ファイルのパス</td><td>

<p>persistence-use/type-storage</p>通常 weblogic-cmp-jar.xmlという名前のファイルを利用するが、この設定によりファイル名を変更できる</td><td>JBossの場合、jbosscmp-jdbc.xmlという名前になる。ファイル名を変更するパラメータは存在しない</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.1.5."></a>
<h3 class="title">1.5.1.3.1.5.クラスタリング関連タグの変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではweblogic-ejb-jar.xmlのentity-clusteringタグでEntity Beanのクラスタリングの設定を行う。

			</p>
<div class="figure">
<a name="N14FDC"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogicのEJBクラスタリングの設定.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;weblogic-ejb-jar  xmlns="http://www.bea.com/ns/weblogic/90" ...&gt;
  &lt;weblogic-enterprise-bean&gt;
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;entity-descriptor&gt;
      &lt;entity-clustering&gt;
       ...
      &lt;/entity-clustering&gt;
    &lt;entity-descriptor&gt;
   ...

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			WebLogicにおけるEJBクラスタリング設定について以下の表に示す。

			</p>
<div class="table">
<a name="N14FE7"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;WebLogicのEJBクラスタ設定内容
				</b>
</p>
<div class="table-contents">
<table summary="WebLogicのEJBクラスタ設定内容
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>
								タグ
							</th><th>設定内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>use-serverside-stubs</td><td>

<p>true | false（デフォルト）</p>Bean ホームがサーバのコンテキストでサーバサイド スタブを使用する。</td>
</tr>
<tr>
<td>2</td><td>home-is-clusterable</td><td>

<p>Beanをクラスタ化するかを指定.True | False</p>ホーム スタブの呼び出しは、Bean がデプロイされるサーバ間で負荷分散する。Bean のホスト サーバにアクセスできなかった場合、呼び出しは、Bean を提供する他のサーバに自動的にフェイルオーバする</td>
</tr>
<tr>
<td>3</td><td>home-load-algorithm</td><td>

<p>ロードバランスアルゴリズムを指定</p>round-robin | random | weight-based | round-robin-affinity | weight-based-affinity | random-affinity</td>
</tr>
<tr>
<td>4</td><td>home-call-router-class-name</td><td>ルーティングを拡張できる(This class must implement weblogic.rmi.extensions.CallRouter)ルーティング拡張クラスを指定する。</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.2."></a>
<h3 class="title">1.5.1.3.2.CMP用のデプロイメントディスクリプタ定義の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			weblogic-cmp-rdbms-jar.xmlからjbosscmp-jdbc.xmlファイルへ移行する。ヘッダ（dtd宣言）部分と各タグの移植を行う
			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>ヘッダが参照しているdtdを変更する。</p>
<div class="figure">
<a name="N1502B"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-cmp-rdbms-jar.xmlのヘッダ例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;?xml version="1.0"?&gt;
&lt;weblogic-rdbms-jar
  xmlns="http://www.bea.com/ns/weblogic/90"
  xmlns:j2ee="http://java.sun.com/xml/ns/j2ee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.bea.com/ns/weblogic/90 http://www.bea.com/ns/weblogic/90/weblogic-rdbms20-persistence.xsd"&gt;

						</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N15035"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jbosscmp-jdbc.xmlのヘッダ例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;!DOCTYPE jbosscmp-jdbc PUBLIC "-//JBoss//DTD JBOSSCMP-JDBC 4.2//EN"
"http://www.jboss.org/j2ee/dtd/jbosscmp-jdbc_4_2.dtd"&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>各タグを以下のように変換する。
                    
                      </p>
<div class="table">
<a name="N15042"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;タグの変換対応表（Statefull Session Bean）
			</b>
</p>
<div class="table-contents">
<table summary="タグの変換対応表（Statefull Session Bean）
			" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>WebLogic<p>weblogic-cmp-rdbms-jar.xml</p>
        
</th><th>JBoss<p>jbosscmp-jdbc.xml</p>
        
</th><th>参考</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>weblogic-rdbms-jar</td><td>jbosscmp-jdbc</td><td rowspan="5">「datasource関連タグ及び、enterprise-beans関連タグへの変換方法」を参照</td>
</tr>
<tr>
<td>2</td><td>weblogic-rdbms-bean</td><td>enterprise-beans</td>
</tr>
<tr>
<td>3</td><td>data-source-name</td><td>defaults/datasourceまた、defaultsの要素にdatasource-mappingタグを追加し、対象のデータベースを設定する。</td>
</tr>
<tr>
<td>4</td><td>table-map/table-name</td><td>entity/table-name</td>
</tr>
<tr>
<td>5</td><td>ejb-name</td><td>entity/ejb-nameまた、entityの要素にcreate-tableタグを追加し、trueを設定する。</td>
</tr>
<tr>
<td>6</td><td>field-map</td><td>cmp-field</td><td rowspan="3">「CMP(Container-Managed Persistence)フィールド宣言タグの変換方法」を参照</td>
</tr>
<tr>
<td>7</td><td>cmp-field</td><td>field-name</td>
</tr>
<tr>
<td>8</td><td>dbms-column</td><td>column-name</td>
</tr>
<tr>
<td>9</td><td>weblogic-rdbms-relation</td><td>ejb-relation</td><td rowspan="8">「CMR(Container-Managed Relationships)関連タグの変換方法」を参照</td>
</tr>
<tr>
<td>10</td><td>relation-name</td><td>ejb-relation-name</td>
</tr>
<tr>
<td>11</td><td>weblogic-relationship-role</td><td>ejb-relationship-role</td>
</tr>
<tr>
<td>12</td><td>relationship-role-name</td><td>ejb-relationship-role-name</td>
</tr>
<tr>
<td>13</td><td>weblogic-relationship-role/relationship-role-map</td><td>key-fields</td>
</tr>
<tr>
<td>14</td><td>relationship-role-map/column-map</td><td>key-fields/key-field</td>
</tr>
<tr>
<td>15</td><td>foreign-key-column</td><td>column-name</td><td>&nbsp;</td>
</tr>
<tr>
<td>16</td><td>key-column</td><td>field-name</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>17</td><td>automatic-key-generation</td><td>entity-command配下にて設定</td><td>「プライマリキー生成関連タグの変換方法」参照</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>18</td><td>create-default-dbms-tables</td><td>remove-table及び、create-tableにて設定</td><td>「テーブルの自動作成・削除の宣言タグの変換方法」参照</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>19</td><td>weblogic-query</td><td>query配下にて設定</td><td>「EJB-QL宣言タグの変換方法」参照</td><td class="auto-generated">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
                    
</p>
</li>
</ol>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.2.1."></a>
<h3 class="title">1.5.1.3.2.1.datasource関連タグ及び、enterprise-beans関連タグへの変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>enterprise-beans関連タグのejb-nameやtable-mapタグは以下のように変換する
        
        </p>
<div class="figure">
<a name="N150FB"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-cmp-rdbms-jar.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
...
&lt;weblogic-rdbms-bean&gt;
  &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
  ...
  &lt;table-map&gt;
    &lt;table-name&gt;△△△&lt;/table-name&gt;
    ...

				</pre>
</div>
</div>
<p>
<br class="figure-break">
                
</p>
<div class="figure">
<a name="N15106"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jbosscmp-jdbc.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
...
&lt;enterprise-beans&gt;
  &lt;entity&gt;
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;create-table&gt;true&lt;/create-table&gt;
    &lt;table-name&gt;△△△&lt;/table-name&gt;
    ...

				</pre>
</div>
</div>
<p>
<br class="figure-break">
        
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.2.2."></a>
<h3 class="title">1.5.1.3.2.2.CMP(Container-Managed Persistence)フィールド宣言タグの変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>cmp-field関連タグは以下のように変換する
        
        </p>
<div class="figure">
<a name="N1511D"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-cmp-rdbms-jar.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;weblogic-rdbms-bean&gt;
...
  &lt;table-map&gt;
  ...
    &lt;field-map&gt;
      &lt;cmp-field&gt;●●●&lt;/cmp-field&gt;
      &lt;dbms-column&gt;▲▲▲&lt;/dbms-column&gt;
    &lt;/field-map&gt;
  &lt;/table-map&gt;
&lt;/weblogic-rdbms-bean&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
                
</p>
<div class="figure">
<a name="N15128"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jbosscmp-jdbc.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;enterprise-beans&gt;
&lt;entity&gt;
    ...
    &lt;cmp-field&gt;
      &lt;field-name&gt;●●●&lt;/field-name&gt;
      &lt;column-name&gt;▲▲▲&lt;/column-name&gt;
    &lt;/cmp-field&gt;
    ...
  &lt;/entity&gt;
&lt;/enterprise-beans&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
        
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.2.3."></a>
<h3 class="title">1.5.1.3.2.3.CMR(Container-Managed Relationships)関連タグの変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>EJBのリレーション設定は、ejb-jar.xmlのejb-relationタグで設定され、ejb-relation-nameの値で各ベンダの定義ファイル（weblogic-cmp-rdbms-jar.xml、
			jbosscmp-jdbc.xml）と紐付けされる。なお1対1、1対多、多対多などの多重度に関しては、ejb-jar.xml
			内でmultiplicityタグにより定義し、JBossへの移行の際にはejb-jar.xml
			内のmultiplicityタグによる定義は先頭を大文字で記載する必要がある
		</p>
<p>
			リレーションの変換は、1対1、1対多、多対多のリレーションによって変換方法が異なる。以降に、1対1、1対多のリレーション設定の定義方法と多対多のリレーション設定の定義方法を示す。

			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>1対1、1対多のリレーション設定</p>
<p>以下に1対1、1対多のリレーション設定の定義方法と例を示す。(各ベンダの定義ファイルでは、リレーションさせるキーなどを指定する。
						WebLogicではweblogic-rdbms-relationタグ、JBossではejb-relationタグを指定して設定する。)
					</p>
<div class="table">
<a name="N15147"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;1対1、1対多のリレーション設定対応表
						</b>
</p>
<div class="table-contents">
<table summary="1対1、1対多のリレーション設定対応表
						" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>設定項目</th><th>WebLogic</th><th>JBoss</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>リレーションの宣言</td><td>weblogic-rdbms-relation</td><td>ejb-relation</td>
</tr>
<tr>
<td>2</td><td>リレーション詳細の定義（Beanのキーカラムとテーブルのカラムとのマッピング）</td><td>weblogic-relationship-role</td><td>ejb-relationship-role</td>
</tr>
<tr>
<td>3</td><td>1対1、1対多の場合のリレーション設定の補足（リレーションが片側のみ）</td><td>リレーションがある側のみを定義する</td><td>JBoss
										DTD定義の関係上、両方のリレーションを定義する。リレーションがない側は、key-fieldの割り当てなしのejb-relationship-role定義を追加する。
									</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
<p>weblogic-cmp-rdbms-jar.xmlのweblogic-rdbms-relation関連タグ及び、ejb-jar.xmlのrelationships関連タグは以下のように変換する
					</p>
<div class="figure">
<a name="N15174"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;ejb-jar.xml（Weblogic）の例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;relationships&gt;
  ...
  &lt;ejb-relation&gt;
    &lt;ejb-relation-name&gt;○○○&lt;/ejb-relation-name&gt;
    &lt;ejb-relationship-role&gt;
      &lt;ejb-relationship-role-name&gt;△△△&lt;/ejb-relationship-role-name&gt;
      &lt;multiplicity&gt;many&lt;/multiplicity&gt;
      &lt;relationship-role-source&gt;
        &lt;ejb-name&gt;aaaEJB&lt;/ejb-name&gt;
      &lt;/relationship-role-source&gt;
      &lt;cmr-field&gt;
        ...
      &lt;/cmr-field&gt;
    &lt;/ejb-relationship-role&gt;
    &lt;ejb-relationship-role&gt;
      &lt;ejb-relationship-role-name&gt;■■■&lt;/ejb-relationship-role-name&gt;
      &lt;multiplicity&gt;one&lt;/multiplicity&gt;
      &lt;relationship-role-source&gt;
        &lt;ejb-name&gt;bbbEJB&lt;/ejb-name&gt;
      &lt;/relationship-role-source&gt;
     &lt;cmr-field&gt;
       ...
     &lt;/cmr-field&gt;
   &lt;/ejb-relationship-role&gt;
  &lt;/ejb-relation&gt;
  ...
&lt;/relationships&gt;

						</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N1517E"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;ejb-jar.xml（JBoss）の例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;relationships&gt;
...
  &lt;ejb-relation&gt;
    &lt;ejb-relation-name&gt;○○○&lt;/ejb-relation-name&gt;
    &lt;ejb-relationship-role&gt;
      &lt;ejb-relationship-role-name&gt;△△△&lt;/ejb-relationship-role-name&gt;
      &lt;multiplicity&gt;Many&lt;/multiplicity&gt;
      &lt;relationship-role-source&gt;
        &lt;ejb-name&gt;aaaEJB&lt;/ejb-name&gt;
      &lt;/relationship-role-source&gt;
      &lt;cmr-field&gt;
        ...
      &lt;/cmr-field&gt;
    &lt;/ejb-relationship-role&gt;
    &lt;ejb-relationship-role&gt;
      &lt;ejb-relationship-role-name&gt;■■■&lt;/ejb-relationship-role-name&gt;
      &lt;multiplicity&gt;One&lt;/multiplicity&gt;
      &lt;relationship-role-source&gt;
        &lt;ejb-name&gt;bbbEJB&lt;/ejb-name&gt;
      &lt;/relationship-role-source&gt;
      &lt;cmr-field&gt;
       ...
      &lt;/cmr-field&gt;
    &lt;/ejb-relationship-role&gt;
  &lt;/ejb-relation&gt;
  ...
&lt;/relationships&gt;

						</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N15188"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;weblogic-cmp-rdbms-jar.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;weblogic-rdbms-relation&gt;
  &lt;relation-name&gt;○○○&lt;/relation-name&gt;
  &lt;weblogic-relationship-role&gt;
    &lt;relationship-role-name&gt;△△△&lt;/relationship-role-name&gt;
    &lt;relationship-role-map&gt;
      &lt;column-map&gt;
        &lt;foreign-key-column&gt;□□□&lt;/foreign-key-column&gt;
        &lt;key-column&gt;●●●&lt;/key-column&gt;
      &lt;/column-map&gt;
    &lt;/relationship-role-map&gt;
  &lt;/weblogic-relationship-role&gt;
&lt;/weblogic-rdbms-relation&gt;

						</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N15192"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;jbosscmp-jdbc.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;relationships&gt;
  &lt;ejb-relation&gt;
    &lt;ejb-relation-name&gt;○○○&lt;/ejb-relation-name&gt;
    &lt;ejb-relationship-role&gt;
      &lt;ejb-relationship-role-name&gt;△△△&lt;/ejb-relationship-role-name&gt;
      &lt;key-fields&gt;
        &lt;key-field&gt;
          &lt;column-name&gt;□□□&lt;/column-name&gt;
          &lt;field-name&gt;●●●&lt;/field-name&gt;
        &lt;/key-field&gt;
      &lt;/key-fields&gt;
    &lt;/ejb-relationship-role&gt;
    &lt;ejb-relationship-role&gt;
      &lt;ejb-relationship-role-name&gt;■■■&lt;/ejb-relationship-role-name&gt;
      &lt;key-fields/&gt;
    &lt;/ejb-relationship-role&gt;
  &lt;/ejb-relation&gt;
&lt;/relationships&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>多対多のリレーション設定</p>
<p>多対多のリレーション設定の場合は、２つのテーブル間でリレーション用の中間テーブルを指定する必要がある。WebLogicでは、table-name 、JBossではrelation-table-mapping、table-nameを使用する。
ejb-jar.xml の変換については、前述の1対1、1対多の例と同様である。以下に、多対多の注意点となる箇所の定義方法と例を示す。その他は前述記述を参考のこと。</p>
<div class="table">
<a name="N151A1"></a>
<p class="title">
<b>Table&nbsp;2.&nbsp;多対多のリレーション設定対応表
						</b>
</p>
<div class="table-contents">
<table summary="多対多のリレーション設定対応表
						" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>設定項目</th><th>WebLogic</th><th>JBoss</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>リレーションの宣言</td><td>weblogic-rdbms-relation</td><td>ejb-relation</td>
</tr>
<tr>
<td>2</td><td>リレーションの中間テーブルの指定</td><td>table-name</td><td>relation-table-mapping/table-name</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
<p>対多でのweblogic-rdbms-relation関連タグ及び、ejb-jar.xmlのrelationships関連タグは以下のように変換する
					</p>
<div class="figure">
<a name="N151C5"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;ejb-jar.xml（Weblogic）の例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;relationships&gt;
  ...
  &lt;ejb-relation&gt;
    &lt;ejb-relation-name&gt;○○○&lt;/ejb-relation-name&gt;
    &lt;ejb-relationship-role&gt;
      &lt;ejb-relationship-role-name&gt;△△△&lt;/ejb-relationship-role-name&gt;
      &lt;multiplicity&gt;many&lt;/multiplicity&gt;
      &lt;relationship-role-source&gt;
        &lt;ejb-name&gt;aaaEJB&lt;/ejb-name&gt;
      &lt;/relationship-role-source&gt;
      &lt;cmr-field&gt;
        ...
      &lt;/cmr-field&gt;
    &lt;/ejb-relationship-role&gt;
    &lt;ejb-relationship-role&gt;
      &lt;ejb-relationship-role-name&gt;■■■&lt;/ejb-relationship-role-name&gt;
      &lt;multiplicity&gt;many&lt;/multiplicity&gt;
      &lt;relationship-role-source&gt;
        &lt;ejb-name&gt;bbbEJB&lt;/ejb-name&gt;
      &lt;/relationship-role-source&gt;
     &lt;cmr-field&gt;
        ...
     &lt;/cmr-field&gt;
   &lt;/ejb-relationship-role&gt;
  &lt;/ejb-relation&gt;
  ...
&lt;/relationships&gt;

						</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N151CF"></a>
<p class="title">
<b>Figure&nbsp;6.&nbsp;ejb-jar.xml（JBoss）の例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;relationships&gt;
  ...
  &lt;ejb-relation&gt;
    &lt;ejb-relation-name&gt;○○○&lt;/ejb-relation-name&gt;
    &lt;ejb-relationship-role&gt;
      &lt;ejb-relationship-role-name&gt;△△△&lt;/ejb-relationship-role-name&gt;
      &lt;multiplicity&gt;Many&lt;/multiplicity&gt;
      &lt;relationship-role-source&gt;
        &lt;ejb-name&gt;aaaEJB&lt;/ejb-name&gt;
      &lt;/relationship-role-source&gt;
      &lt;cmr-field&gt;
        ...
      &lt;/cmr-field&gt;
    &lt;/ejb-relationship-role&gt;
    &lt;ejb-relationship-role&gt;
      &lt;ejb-relationship-role-name&gt;■■■&lt;/ejb-relationship-role-name&gt;
      &lt;multiplicity&gt;Many&lt;/multiplicity&gt;
      &lt;relationship-role-source&gt;
        &lt;ejb-name&gt;bbbEJB&lt;/ejb-name&gt;
      &lt;/relationship-role-source&gt;
     &lt;cmr-field&gt;
        ...
     &lt;/cmr-field&gt;
   &lt;/ejb-relationship-role&gt;
 &lt;/ejb-relation&gt;
 ...
&lt;/relationships&gt;

						</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N151D9"></a>
<p class="title">
<b>Figure&nbsp;7.&nbsp;weblogic-cmp-rdbms-jar.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							&lt;weblogic-rdbms-relation&gt;
  &lt;relation-name&gt;○○○&lt;/relation-name&gt;
  &lt;table-name&gt;band_artist&lt;/table-name&gt;
  &lt;weblogic-relationship-role&gt;
    &lt;relationship-role-name&gt;△△△&lt;/relationship-role-name&gt;
    &lt;relationship-role-map&gt;
      &lt;column-map&gt;
        &lt;foreign-key-column&gt;□□□&lt;/foreign-key-column&gt;
        &lt;key-column&gt;●●●&lt;/key-column&gt;
      &lt;/column-map&gt;
    &lt;/relationship-role-map&gt;
  &lt;/weblogic-relationship-role&gt;
 
  &lt;weblogic-relationship-role&gt;
    &lt;relationship-role-name&gt;■■■&lt;/relationship-role-name&gt;
    &lt;relationship-role-map&gt;
      &lt;column-map&gt;
        &lt;foreign-key-column&gt;◆◆◆&lt;/foreign-key-column&gt;
        &lt;key-column&gt;◇◇◇&lt;/key-column&gt;
      &lt;/column-map&gt;
    &lt;/relationship-role-map&gt;
  &lt;/weblogic-relationship-role&gt;
&lt;/weblogic-rdbms-relation&gt;

						</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N151E3"></a>
<p class="title">
<b>Figure&nbsp;8.&nbsp;jbosscmp-jdbc.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;relationships&gt;                                                                    
  &lt;ejb-relation&gt;                                                                    
    &lt;ejb-relation-name&gt;○○○&lt;/ejb-relation-name&gt;
    &lt;relation-table-mapping&gt;
      &lt;table-name&gt;band_artist&lt;/table-name&gt;
    &lt;/relation-table-mapping&gt;
    &lt;ejb-relationship-role&gt;
      &lt;ejb-relationship-role-name&gt;△△△&lt;/ejb-relationship-role-name&gt;
      &lt;key-fields&gt;
        &lt;key-field&gt;
          &lt;column-name&gt;□□□&lt;/column-name&gt;
          &lt;field-name&gt;●●●&lt;/field-name&gt;
        &lt;/key-field&gt;
      &lt;/key-fields&gt;
    &lt;/ejb-relationship-role&gt;
 
    &lt;ejb-relationship-role&gt;
      &lt;ejb-relationship-role-name&gt;■■■&lt;/ejb-relationship-role-name&gt;
      &lt;key-fields&gt;
        &lt;key-field&gt;
          &lt;column-name&gt;◆◆◆&lt;/column-name&gt;
          &lt;field-name&gt;◇◇◇&lt;/field-name&gt;
        &lt;/key-field&gt;
      &lt;/key-fields&gt;
    &lt;/ejb-relationship-role&gt;
  &lt;/ejb-relation&gt;
&lt;/relationships&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.2.4."></a>
<h3 class="title">1.5.1.3.2.4.プライマリキー生成関連タグの変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>Weblogicの自動主キー生成設定は、weblogic-cmp-rdbms-jar.xmlの automatic-key-generationタグで設定可能で、JBossの場合はentity-commandタグを指定して設定することが可能である。以下に、定義の対応表と例を示す。
        </p>
<div class="table">
<a name="N151FA"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;自動主キー設定対応表
				</b>
</p>
<div class="table-contents">
<table summary="自動主キー設定対応表
				" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>設定項目</th><th>WebLogic</th><th>JBoss</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>自動主キー生成の宣言</td><td>automatic-key-generation</td><td>entity-command</td>
</tr>
<tr>
<td>2</td><td>自動主キー生成方法（実装）の指定</td><td>generator-type で主キーを生成する方法を指定する。例ではシーケンス用のテーブル名を指定するNAMED_SEQUENCE_TABLEを指定している。</td><td>entity-commandのname属性にkey-generatorを指定し、attributeのkey-generator-factoryにHiLoKeyGeneratorFactoryを指定する。</td>
</tr>
<tr>
<td>3</td><td>その他、生成方法の補足</td><td>generator-typeは、その他に、Oracle | SQLServer | SQLServer2000を指定できる。</td><td>attributeのkey-generator-factoryを指定しない場合は、デフォルトのUUIDKeyGeneratorFactoryが使用される。</td>
</tr>
<tr>
<td>4</td><td>key-cache-sizの指定に関して</td><td>key-cache-size で、1 回の DBMS 呼び出しでコンテナが取得するキーの数を指定する（NAMED_SEQUENCE_TABLEの場合）</td><td>現状、JBossへ変換できる機能の提供はされていない</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
        
</p>
<p>自動主キー生成の例を以下に示す
         </p>
<div class="figure">
<a name="N15231"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-cmp-rdbms-jar.xmlのヘッダ例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;weblogic-rdbms-bean&gt;
  &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
  &lt;data-source-name&gt;△△△&lt;/data-source-name&gt;
  &lt;table-map&gt;
    &lt;table-name&gt;□□□&lt;/table-name&gt;
    &lt;field-map&gt;
      &lt;cmp-field&gt;●●●&lt;/cmp-field&gt;
      &lt;dbms-column&gt;▲▲▲&lt;/dbms-column&gt;
    &lt;/field-map&gt;
  &lt;/table-map&gt;
  &lt;automatic-key-generation&gt;
    &lt;generator-type&gt;NAMED_SEQUENCE_TABLE&lt;/generator-type&gt;
    &lt;generator-name&gt;◎◎◎&lt;/generator-name&gt;
    &lt;key-cache-size&gt;1000&lt;/key-cache-size&gt;
  &lt;/automatic-key-generation&gt;
&lt;/weblogic-rdbms-bean&gt;

						</pre>
</div>
</div>
<p>
<br class="figure-break">
                    
</p>
<div class="figure">
<a name="N1523C"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jbosscmp-jdbc.xmlのHiLoKeyGeneratorFactoryを使用した例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;enterprise-beans&gt;
  &lt;entity&gt;
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;table-name&gt;□□□&lt;/table-name&gt;
    &lt;cmp-field&gt;
      &lt;field-name&gt;
        ●●●
      &lt;/field-name&gt;
      &lt;column-name&gt;▲▲▲&lt;/column-name&gt;
    &lt;/cmp-field&gt;
    &lt;entity-command name="key-generator"&gt;
     &lt;attribute name="key-generator-factory"&gt;
HiLoKeyGeneratorFactory
&lt;/attribute&gt;
    &lt;/entity-command&gt;
  &lt;/entity&gt;
&lt;/enterprise-beans&gt;

						</pre>
</div>
</div>
<p>
<br class="figure-break">
        
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.2.5."></a>
<h3 class="title">1.5.1.3.2.5.テーブルの自動作成・削除の宣言タグの変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>テーブルの自動作成・削除などの設定は、WebLogicでは、create-default-dbms-tablesタグを使用し、JBossでは、remove-table、create-tableを使用する。以下に、定義の対応表と例を示す。
         </p>
<div class="table">
<a name="N15253"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;テーブルの自動作成・削除対応表
				</b>
</p>
<div class="table-contents">
<table summary="テーブルの自動作成・削除対応表
				" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>設定項目</th><th>WebLogic</th><th>JBoss</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>テーブルの自動作成・削除の宣言</td><td>create-default-dbms-tables</td><td>remove-table、create-table</td>
</tr>
<tr>
<td>2</td><td>自動作成・削除の詳細</td><td>create-default-dbms-tablesがDropAndCreateAlwaysの場合は、EJB コンテナが、スキーマの変更を検出すると自動的にテーブルを生成する。コンテナは、カラムが変更されているかどうかに関係なくデプロイメント時にテーブルを削除してから作成する。コンテナはデータを保存しない。</td><td>

<p>remove-tableがtrueの場合</p>各エンティティおよびリレーションシップにマッピングされる各関連テーブルに対して、テーブルのドロップを試行する。アプリケーションのデプロイが解除されたときに、JBoss はテーブルのドロップを試行する。<p>create-tableがtrueの場合</p>エンティティのテーブルの作成を試行する。アプリケーションがデプロイされると、JBoss は、テーブル作成の前にすでにテーブルが存在しているかどうか確認し、テーブルが見つかった場合は、ログに記録が取られ、テーブルは作成されない。</td>
</tr>
<tr>
<td>3</td><td>その他、補足</td><td>create-default-dbms-tables ではDropAndCreateAlways の他にDisabled,CreateOnly,DropAndCreate,AlterOrCreateを指定できる。</td><td>JBossでは、WebLogicのcreate-default-dbms-tablesと完全に同等の機能はないため、remove-table、create-tableを組み合わせて代替する。</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
            
</p>
<p>WebLogicとJBossで完全に同等のタグは存在しないため、代替機能としての例を示す
             </p>
<div class="figure">
<a name="N15287"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-cmp-rdbms-jar.xmlのヘッダ例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;/weblogic-rdbms-jar&gt;
  ...
  &lt;create-default-dbms-tables&gt;DropAndCreateAlways&lt;/create-default-dbms-tables&gt;

						</pre>
</div>
</div>
<p>
<br class="figure-break">
                    
</p>
<div class="figure">
<a name="N15292"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jbosscmp-jdbc.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;jbosscmp-jdbc&gt;
  &lt;defaults&gt;
    ...
    &lt;remove-table&gt;true&lt;/remove-table&gt;
    &lt;create-table&gt;true&lt;/create-table&gt;
  &lt;/defaults&gt;
  ...

						</pre>
</div>
</div>
<p>
<br class="figure-break">
            
            
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.2.6."></a>
<h3 class="title">1.5.1.3.2.6.EJB-QL宣言タグの変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>weblogic-queryやjboss-qlでは、標準のEJB-QLでサポートしていない拡張クエリー機能を提供するが、拡張クエリー機能はベンダ固有のため、WebLogicのweblogic-qeuryでどのような機能を利用しているか特定し、同等の機能をJBossで実現可能か個別に調査する必要がある。
以下は、参考としてWeblogicにおけるweblogic-queryの定義とjboss-qlのタグの対応表を示すが、置き換えるだけでは移行はできず、WebLogicのweblogic-qeuryでどのような拡張クエリー機能を特定し、jboss-qlで代替できるかを検討する必要がある。
</p>
<div class="table">
<a name="N152A9"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;タグの変換対応表（weblogic-query、jboss-ql）
				</b>
</p>
<div class="table-contents">
<table summary="タグの変換対応表（weblogic-query、jboss-ql）
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>WebLogic<p>weblogic-cmp-rdbms-jar.xml</p>
                            
</th><th>JBoss<p>jbosscmp-jdbc.xml</p>
                            
</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>weblogic-query</td><td>query</td>
</tr>
<tr>
<td>2</td><td>query-method</td><td>query-method</td>
</tr>
<tr>
<td>3</td><td>method-name</td><td>method-name</td>
</tr>
<tr>
<td>4</td><td>method-params</td><td>method-params</td>
</tr>
<tr>
<td>5</td><td>method-param</td><td>method-param</td>
</tr>
<tr>
<td>6</td><td>weblogic-ql</td><td>jboss-ql</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
			なお、WebLogicにおける拡張クエリ機能は、上記のほかに、以下の機能が存在する
			</p>
<div class="table">
<a name="N152E8"></a>
<p class="title">
<b>Table&nbsp;2.&nbsp;WebLogicにおける拡張クエリ機能
				</b>
</p>
<div class="table-contents">
<table summary="WebLogicにおける拡張クエリ機能
				" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>WebLogic拡張クエリ機能</th><th>説明</th><th>参考URL</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>sql-query</td><td>sql-query 要素では、標準およびデータベース固有の SQL クエリを指定できる。EJB-QL の WebLogic の拡張機能を使用しない EJB-QL クエリは、ejb-jar.xml デプロイメント記述子に指定する必要がある。
WebLogic Server 9.0 より前のリリースでは EJB-QL クエリ (WebLogic 拡張あり、なし) だけがサポートされていたが、WebLogic Server 9.0では SQL クエリ、EJB-QL クエリ (WebLogic 拡張あり、なし)、またはこの 2 つの組み合わせがサポートされている。</td><td>http://otndnld.oracle.co.jp/document/products/wls/docs90/ejb/DDreference-cmp-jar.html#1240933</td>
</tr>
<tr>
<td>2</td><td>max-elements<p>移植方法については以降に示す。</p>
        
</td><td>max-elements は複数件取得するクエリによって返される要素の最大数を指定する。この要素は、JDBC の maxRows 機能とほぼ同じである。</td><td>http://otndnld.oracle.co.jp/document/products/wls/docs81/ejb/DDreference-cmp-jar.html#1113829</td>
</tr>
<tr>
<td>3</td><td>include-updates</td><td>現在のトランザクション中の更新を必ずクエリの結果に反映するかどうかを指定する。この要素を True に設定した場合、コンテナは現在のトランザクションによる変更をすべてディスクにフラッシュしてからクエリを実行する。値を False にすると、最高のパフォーマンスが得られる。</td><td>http://otndnld.oracle.co.jp/document/products/wls/docs81/ejb/DDreference-cmp-jar.html#1230369</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">

</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>max-elementsの移植について</p>
<p>max-elementsの移植についてejb-jar.xmlのejb-qlではOFFSET、LIMIT関数は使用できないため、ejb-jar.xmlでは仮のejb-qlを定義し、jbosscmp-jdbc.xmlのjboss-qlで、OFFSET、LIMIT関数を指定したjboss-qlでオーバライドする方法について示す。（起動時には、jbosscmp-jdbc.xmlの定義が優先される。）
</p>
<div class="table">
<a name="N1531D"></a>
<p class="title">
<b>Table&nbsp;3.&nbsp;拡張クエリー設定対応表
				</b>
</p>
<div class="table-contents">
<table summary="拡張クエリー設定対応表
				" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>設定項目</th><th>WebLogic</th><th>JBoss</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>拡張クエリーの指定</td><td>weblogic-query内にquery-method、max-elementsを指定する。</td><td>query内にquery-method 、jboss-qlを指定する。</td>
</tr>
<tr>
<td>2</td><td>クエリーの最大取得件数を指定</td><td>max-elements</td><td>WebLogicのmax-elements に相当するタグは、JBossでは存在しないため、jboss-ql 内でOFFSET、LIMIT関数を指定することで機能を代替する。
（max-elementの設定値が100ならば、OFFSET　0　　LIMIT　100 と変換する。）</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">


</p>
<div class="figure">
<a name="N15340"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;Weblogic、JBoss の ejb-jar.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							&lt;enterprise-beans&gt;
  ...
  &lt;entity&gt;
    &lt;ejb-name&gt;BandEJB&lt;/ejb-name&gt;
    ...
    &lt;query&gt;
      &lt;query-method&gt;
        &lt;method-name&gt;findByNameWithMaxRow&lt;/method-name&gt;
        &lt;method-params&gt;
          &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
        &lt;/method-params&gt;
      &lt;/query-method&gt;
      &lt;ejb-ql&gt;
        &lt;![CDATA[SELECT OBJECT(a) FROM BandEJB AS a WHERE a.name = ?1]]&gt;
      &lt;/ejb-ql&gt;
    &lt;/query&gt;
  &lt;/entity&gt;
  ...
&lt;enterprise-beans&gt;

						</pre>
</div>
</div>
<p>
<br class="figure-break">
            
</p>
<div class="figure">
<a name="N1534B"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;weblogic-cmp-rdbms-jar.xmlのヘッダ例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							&lt;weblogic-rdbms-bean&gt;
  &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
  &lt;data-source-name&gt;△△△&lt;/data-source-name&gt;
  &lt;table-map&gt;
    &lt;table-name&gt;□□□&lt;/table-name&gt;
    &lt;field-map&gt;
      &lt;cmp-field&gt;●●●&lt;/cmp-field&gt;
      &lt;dbms-column&gt;▲▲▲&lt;/dbms-column&gt;
    &lt;/field-map&gt;
  &lt;/table-map&gt;
  &lt;weblogic-query&gt;
    &lt;query-method&gt;
      &lt;method-name&gt;■■■&lt;/method-name&gt;
      &lt;method-params&gt;
        &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
      &lt;/method-params&gt;
    &lt;/query-method&gt;
    &lt;max-elements&gt;100&lt;/max-elements&gt;
  &lt;/weblogic-query&gt;
&lt;/weblogic-rdbms-bean&gt;

						</pre>
</div>
</div>
<p>
<br class="figure-break">
                    
</p>
<div class="figure">
<a name="N15356"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;jbosscmp-jdbc.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;enterprise-beans&gt;
  &lt;entity&gt;
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;table-name&gt;□□□&lt;/table-name&gt;
    &lt;cmp-field&gt;
      &lt;field-name&gt;●●●&lt;/field-name&gt;
      &lt;column-name&gt;▲▲▲&lt;/column-name&gt;
    &lt;/cmp-field&gt;
    &lt;query&gt;
      &lt;query-method&gt;
        &lt;method-name&gt;■■■&lt;/method-name&gt;
        &lt;method-params&gt;
          &lt;method-param&gt;java.lang.String&lt;/method-param&gt;
        &lt;/method-params&gt;
      &lt;/query-method&gt;
      &lt;jboss-ql&gt;
        &lt;![CDATA[SELECT OBJECT(a) FROM BandEJB AS a WHERE a.name = ?1 OFFSET 0 LIMIT 100 ]]&gt;
      &lt;/jboss-ql&gt;
    &lt;/query&gt;
  &lt;/entity&gt;
&lt;/enterprise-beans&gt;

						</pre>
</div>
</div>
<p>
<br class="figure-break">
            

</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.2.7."></a>
<h3 class="title">1.5.1.3.2.7.EJB CMP Bean変換の全体例</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>以下に全体の変更例を示す。
        </p>
<div class="figure">
<a name="N1536D"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-cmp-rdbms-jar.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;weblogic-rdbms-jar
  xmlns="http://www.bea.com/ns/weblogic/90"
  xmlns:j2ee="http://java.sun.com/xml/ns/j2ee"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.bea.com/ns/weblogic/90 http://www.bea.com/ns/weblogic/90/weblogic-rdbms20-persistence.xsd"&gt;
  &lt;weblogic-rdbms-bean&gt;
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;data-source-name&gt;△△△&lt;/data-source-name&gt;
    &lt;table-map&gt;
      &lt;table-name&gt;□□□&lt;/table-name&gt;
      &lt;field-map&gt;
        &lt;cmp-field&gt;●●●&lt;/cmp-field&gt;
        &lt;dbms-column&gt;▲▲▲&lt;/dbms-column&gt;
      &lt;/field-map&gt;
    &lt;/table-map&gt;
  &lt;/weblogic-rdbms-bean&gt;
&lt;weblogic-rdbms-relation&gt;
    &lt;relation-name&gt;■■■&lt;/relation-name&gt;
    &lt;weblogic-relationship-role&gt;
      &lt;relationship-role-name&gt;◎◎◎&lt;/relationship-role-name&gt;
      &lt;relationship-role-map&gt;
        &lt;column-map&gt;
          &lt;foreign-key-column&gt;▽▽▽&lt;/foreign-key-column&gt;
          &lt;key-column&gt;▼▼▼&lt;/key-column&gt;
        &lt;/column-map&gt;
      &lt;/relationship-role-map&gt;
    &lt;/weblogic-relationship-role&gt;
&lt;/weblogic-rdbms-relation&gt;
&lt;/weblogic-rdbms-jar&gt;

						</pre>
</div>
</div>
<p>
<br class="figure-break">
                    
</p>
<div class="figure">
<a name="N15378"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jbosscmp-jdbc.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;!DOCTYPE jbosscmp-jdbc PUBLIC "-//JBoss//DTD JBOSSCMP-JDBC 4.2//EN"
"http://www.jboss.org/j2ee/dtd/jbosscmp-jdbc_4_2.dtd"&gt;
&lt;jbosscmp-jdbc&gt;
  &lt;defaults&gt;
    &lt;datasource&gt;△△△&lt;/datasource&gt;
    &lt;datasource-mapping&gt;[対象のデータベース名]&lt;/datasource-mapping&gt;
  &lt;/defaults&gt;
  &lt;enterprise-beans&gt;
    &lt;entity&gt;
      &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
      &lt;create-table&gt;true&lt;/create-table&gt;
      &lt;table-name&gt;□□□&lt;/table-name&gt;
      &lt;cmp-field&gt;
        &lt;field-name&gt;●●●&lt;/field-name&gt;
        &lt;column-name&gt;▲▲▲&lt;/column-name&gt;
      &lt;/cmp-field&gt;
    &lt;/entity&gt;
  &lt;/enterprise-beans&gt;
  &lt;relationships&gt;
    &lt;ejb-relation&gt;
        &lt;ejb-relation-name&gt;■■■&lt;/ejb-relation-name&gt;
        &lt;ejb-relationship-role&gt;
          &lt;ejb-relationship-role-name&gt;◎◎◎&lt;/ejb-relationship-role-name&gt;
          &lt;key-fields&gt;
            &lt;key-field&gt;
              &lt;column-name&gt;▽▽▽&lt;/column-name&gt;
              &lt;field-name&gt;▼▼▼&lt;/field-name&gt;
            &lt;/key-field&gt;
          &lt;/key-fields&gt;
        &lt;/ejb-relationship-role&gt;
    &lt;/ejb-relation&gt;
    &lt;ejb-relationship-role&gt;                                      
      &lt;ejb-relationship-role-name&gt;◇◇◇&lt;/ejb-relationship-role-name&gt;
      &lt;key-fields /&gt;
    &lt;/ejb-relationship-role&gt;
  &lt;/relationships&gt;
&lt;/jbosscmp-jdbc&gt;

						</pre>
</div>
</div>
<p>
<br class="figure-break">
        
        
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.3.2.8."></a>
<h3 class="title">1.5.1.3.2.8.EntityBeanのインサート遅延設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではEntityBeanのインサートするタイミングをweblogic-cmp-rdbms-jar.xmlのdelay-database-insert-untilで設定することができる。デフォルトではデータベースへの挿入はEntityBeanのejbPostCreate メソッドを呼び出した後に行う。
          </p>
<div class="figure">
<a name="N1538F"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-cmp-rdbms-jar.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
...
&lt;delay-database-insert-until&gt;ejbPostCreate&lt;/delay-database-insert-until&gt;

						</pre>
</div>
</div>
<p>
<br class="figure-break">
        
</p>
<p> JBossはWebLogicの挙動と異なりejbCreateコール時にインサートするので、ejbPostCreateコール時のインサートを期待する場合、jbosscmp-jdbc.xmlのinsert-after-ejb-post-createタグにtrueを設定する。
        </p>
<div class="figure">
<a name="N1539C"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jbosscmp-jdbc.xmlの例.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;jbosscmp-jdbc&gt;
  &lt;defaults&gt;
    ...
    &lt;insert-after-ejb-post-create&gt;true&lt;/insert-after-ejb-post-create&gt;

						</pre>
</div>
</div>
<p>
<br class="figure-break">
        
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.4."></a>
<h3 class="title">1.5.1.4.MessageDrivenBeanの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>weblogic-ejb-jar.xmlのweblogic-enterprise-beanタグ配下のタグの対応表を以下に示す
		</p>
<div class="table">
<a name="N153CB"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;タグの変換対応表（MessageDrivenBean）
			</b>
</p>
<div class="table-contents">
<table summary="タグの変換対応表（MessageDrivenBean）
			" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>
							WebLogic
							<p>weblogic-ejb-jar.xml</p>
						
</th><th>JBoss</th><th>参考章項目</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>weblogic-ejb-jar</td><td>jboss</td><td rowspan="9">「デプロイメントディスクリプタ定義の移行」を参照</td>
</tr>
<tr>
<td>2</td><td>weblogic-enterprise-bean</td><td>session</td>
</tr>
<tr>
<td>6</td><td>message-driven-descriptor</td><td>message-driven</td><td>&nbsp;</td>
</tr>
<tr>
<td>3</td><td>weblogic-enterprise-bean/ejb-name</td><td>ejb-name</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>4</td><td>weblogic-enterprise-bean/jndi-name</td><td>対応なし</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>5</td><td>weblogic-enterprise-bean/local-jndi-name</td><td>対応なし</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>11</td><td>reference-descriptor/resource-description</td><td>resource-ref</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>12</td><td>reference-descriptor/
							resource-env-description
						</td><td>resource-env-ref</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>13</td><td>reference-descriptor/
							ejb-reference-description
						</td><td>ejb-ref</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>7</td><td>message-driven-descriptor/destination-jndi-name
						</td><td rowspan="4">「XXX」を参照</td><td class="auto-generated">&nbsp;</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>8</td><td>message-driven-descriptor/initial-context-factory
						</td><td class="auto-generated">&nbsp;</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>9</td><td>message-driven-descriptor/provider-url</td><td>&nbsp;</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>10</td><td>message-driven-descriptor/connection-factory-jndi-name
						</td><td>&nbsp;</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>11</td><td>message-driven-descriptor/pool</td><td>&nbsp;</td><td rowspan="3">EJBインスタンスプール関連タグの移行</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>11</td><td>message-driven-descriptor/pool/initial-beans-in-free-pool
						</td><td>該当なし：JBossの場合デフォルトで0が設定される</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>10</td><td>message-driven-descriptor/pool/max-beans-in-free-pool
						</td><td>&nbsp;</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>17</td><td> transaction-descriptor/trans-timeout-seconds
						</td><td>&nbsp;</td><td>「トランザクション関連タグの変換方法」を参照。※Stateless
							Session
							Beanの移行方法で示した設定内容と同等である
						</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>18</td><td>transaction-isolation</td><td rowspan="6">ejb-jar.xml及び、データソース設定にて設定
						</td><td class="auto-generated">&nbsp;</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>19</td><td> transaction-isolation/isolation-level</td><td class="auto-generated">&nbsp;</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>20</td><td> transaction-isolation/isolation-level/method
						</td><td class="auto-generated">&nbsp;</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>21</td><td> transaction-isolation/isolation-level/method/ejb-name
						</td><td class="auto-generated">&nbsp;</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>22</td><td>
							transaction-isolation/isolation-level/method/method-intf
						</td><td class="auto-generated">&nbsp;</td><td class="auto-generated">&nbsp;</td>
</tr>
<tr>
<td>23</td><td>
							transaction-isolation/isolation-level/method/method-name
						</td><td class="auto-generated">&nbsp;</td><td class="auto-generated">&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
</div>
<br>
<br>
<a name="tubame_1.5.1.4.1."></a>
<h3 class="title">1.5.1.4.1.MDBデプロイメントディスクリプタ定義の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>weblogic-enterprise-bean配下にmessage-driven-descriptorが設定されている場合は、jboss-ejb3.xmlのenterprise-beans配下の&rdquo;message-driven&rdquo;として置き換えて設定する。</p>
<div class="figure">
<a name="N15485"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-ejb-jar.xmlの例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
&lt;weblogic-ejb-jar&gt;                                                        
  &lt;weblogic-enterprise-bean&gt;                                             
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;jndi-name&gt;...&lt;/jndi-name&gt;
    &lt;message-driven-descriptor&gt;
      &lt;destination-jndi-name&gt;●●●&lt;/destination-jndi-name&gt;
    &lt;/message-driven-descriptor&gt;
・・・

            </pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N1548F"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jboss-ejb3.xmlの例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
	xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
                     http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"
	version="3.1" impl-version="2.0"&gt;

	&lt;jboss:enterprise-beans&gt;
		&lt;message-driven&gt;
			&lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
		&lt;/message-driven&gt;
	&lt;/jboss:enterprise-beans&gt;
	
&lt;/jboss:ejb-jar&gt;

            </pre>
</div>
</div>
<br class="figure-break">
<p>weblogic-ejb-jar.xmlではmessage-driven-descriptorの指定が省略可能であり、なお、weblogic-ejb-jar.xmlではstateless-session-descriptorの指定が省略可能であり、指定の無い場合はejb-jar.xmlのmessage-drivenタグより判断した上でタグの設定を行う。</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.4.2."></a>
<h3 class="title">1.5.1.4.2.destinationJNDI名の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>weblogic-enterprise-bean配下にdestination-jndi-nameでdestination設定が設定されている場合、ejb-jar.xmlにactivation-configタグ配下に、activation-config-property-nameとして、destinationType及びdestinationを行う。
        </p>
<div class="figure">
<a name="N16530"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-ejb-jar.xmlの例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
&lt;weblogic-ejb-jar&gt;                                                        
  &lt;weblogic-enterprise-bean&gt;                                             
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;jndi-name&gt;...&lt;/jndi-name&gt;
    &lt;message-driven-descriptor&gt;
      &lt;destination-jndi-name&gt;●●●&lt;/destination-jndi-name&gt;
    &lt;/message-driven-descriptor&gt;
・・・

            </pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N1653A"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;ejb-jar.xmlの例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
                
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;!-- ejb-jar version="3.0" xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_0.xsd" --&gt;
&lt;ejb-jar  version="2.1" xmlns="http://java.sun.com/xml/ns/j2ee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee http://java.sun.com/xml/ns/j2ee/ejb-jar_2_1.xsd"&gt;
  &lt;enterprise-beans&gt;
    &lt;message-driven&gt;
      &lt;ejb-name&gt;○&lt;/ejb-name&gt;
      &lt;ejb-class&gt;...&lt;/ejb-class&gt;
      &lt;transaction-type&gt;Container&lt;/transaction-type&gt;
       &lt;activation-config&gt;
          &lt;activation-config-property&gt;
              &lt;activation-config-property-name&gt;destinationType&lt;/activation-config-property-name&gt;
              &lt;activation-config-property-value&gt;javax.jms.Queue&lt;/activation-config-property-value&gt;
          &lt;/activation-config-property&gt;
          &lt;activation-config-property&gt;
              &lt;activation-config-property-name&gt;destination&lt;/activation-config-property-name&gt;
              &lt;activation-config-property-value&gt;java:jboss/queue/exampleQueue&lt;/activation-config-property-value&gt;
          &lt;/activation-config-property&gt;
      &lt;/activation-config&gt;
    &lt;/message-driven&gt;
  &lt;/enterprise-beans&gt;
&lt;/ejb-jar&gt;

            </pre>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>destinationTypeとしてキューを利用する場合は、javax.jms.Queueを設定し、トピックを利用する場合は、javax.jms.Topicを設定する</p>
<p>destinationに設定する値は、JBossに管理CLIよりキュー及びトピックを登録した際のJNDI名を設定する</p>
</td>
</tr>
</table>
</div>
</div>
</div>
<br class="figure-break">
</div>
<br>
<br>
<a name="tubame_1.5.1.4.3."></a>
<h3 class="title">1.5.1.4.3.MDBインスタンスプール関連タグの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではweblogic-ejb-jar.xmlのpoolタグにより、EJBインスタンスプール設定を行う。</p>
<div class="figure">
<a name="N154A7"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
&lt;weblogic-enterprise-bean&gt;
  &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
    &lt;message-driven-descriptor&gt;
      &lt;pool&gt;
        &lt;max-beans-in-free-pool&gt;△△△&lt;/max-beans-in-free-pool&gt;
        &lt;initial-beans-in-free-pool&gt;□□□&lt;/initial-beans-in-free-pool&gt;
      &lt;/pool&gt;
      &lt;destination-jndi-name&gt;●●●&lt;/destination-jndi-name&gt;
    &lt;/message-driven-descriptor&gt;

					</pre>
</div>
</div>
<br class="figure-break">
<p>JBossの場合は、以下の手順でEJBインスタンスプールの設定を行う  </p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>デフォルトで適用されるMDBのインスタンスプール設定を管理CLIより変更する。weblogic-ejb-jar.xmlのmax-beans-in-free-poolタグで
					設定されるインスタンスプールの上限値の設定を、JBossのインスタンスプール設定(mdb-strict-max-pool)のmax-pool-sizeを変更する方法を示す。
				</p>
<div class="figure">
<a name="N154B6"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;mdb-strict-max-poolののmax-pool-sizeをデフォルトの20より25に変更する.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
/subsystem=ejb3/strict-max-bean-instance-pool=mdb-strict-max-pool:write-attribute(name=max-pool-size,value=25)

					</pre>
</div>
</div>
<br class="figure-break">
</li>
</ol>
</div>
</div>
<br>
<br>
<a name="tubame_1.5.1.5."></a>
<h3 class="title">1.5.1.5.トランザクション関連の設定</h3>
<br>
<br>
<a name="tubame_1.5.1.5.1."></a>
<h3 class="title">1.5.1.5.1.トランザクション関連タグの変換方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではtransaction-descriptor配下のtrans-timeout-secondsにてトランザクションタイムアウトの設定を行う。また、transaction-isolationタグにてトランザクション
			アイソレーション設定を行う。
			以下にJBossにおけるトランザクションタイムアウト及びトランザクション
			アイソレーションの設定方法について示す。
			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>トランザクションタイムアウト設定</p>
<p>
						WebLogicではEJBのトランザクションタイムアウト設定をweblogic-ejb-jar.xmlのtransaction-descriptor/trans-timeout-secondsで設定可能であり、EJB単位での設定が可能である。JBossでは、トランザクションタイムアウト設定はjboss-ejb3.xmlにて設定可能であるが、EJBのメソッド単位の設定となる。
						WebLogicでは、&rdquo;trans-timeout-seconds&rdquo;にてトランザクションタイムアウト時間をミリ秒単位で指定していることに対し、JBossでは秒単位を指定している。そのため、移行を行う際には秒単位の数値に適宜置き換えること
						</p>
<div class="figure">
<a name="N164B2"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogicのweblogic-ejb-jar.xmlによるトランザクションタイムアウト設定.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;weblogic-ejb-jar  xmlns="http://www.bea.com/ns/weblogic/90" ...&gt;
  &lt;weblogic-enterprise-bean&gt;
    &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
     ...
    &lt;transaction-descriptor&gt;
      &lt;trans-timeout-seconds&gt;◇◇◇&lt;/trans-timeout-seconds&gt;
    &lt;/transaction-descriptor&gt;
    ...

							</pre>
</div>
</div>
<p>
<br class="figure-break">

						
</p>
<div class="figure">
<a name="N164BD"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;JBossのjboss-ejb3.xmlによるトランザクションタイムアウト設定.</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
   xmlns="http://java.sun.com/xml/ns/javaee"
   xmlns:tx="urn:trans-timeout"
   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
         http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd
         urn:trans-timeout http://www.jboss.org/j2ee/schema/trans-timeout-1_0.xsd"
   version="3.1"
   impl-version="2.0"&gt;
    &lt;enterprise-beans&gt;
        &lt;session&gt;
            &lt;ejb-name&gt;TestBean&lt;/ejb-name&gt;
            &lt;ejb-class&gt;org...TestBean&lt;/ejb-class&gt;
            &lt;session-type&gt;Stateless&lt;/session-type&gt;
        &lt;/session&gt;
    &lt;/enterprise-beans&gt;
    &lt;assembly-descriptor&gt;
        &lt;container-transaction&gt;
            &lt;!-- Note: care must be taken to properly override the right annotation --&gt;
            &lt;method&gt;
                &lt;ejb-name&gt;TestBean&lt;/ejb-name&gt;
                &lt;method-name&gt;*&lt;/method-name&gt;
            &lt;/method&gt;
            &lt;tx:trans-timeout&gt;
                &lt;tx:timeout&gt;60&lt;/tx:timeout&gt;
                &lt;tx:unit&gt;Seconds&lt;/tx:unit&gt;
            &lt;/tx:trans-timeout&gt;
        &lt;/container-transaction&gt;
    &lt;/assembly-descriptor&gt;
&lt;/jboss:ejb-jar&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
<li class="listitem">
<p>トランザクション アイソレーション設定</p>
<p>
						WebLogicではtransaction-isolationを設定することで、EJBのメソッド単位でトランザクション
						アイソレーション設定が可能である。JBossではデプロイメントディスクリプタに同等な設定方法はなく、ejb-jar.xml
						を利用しデータソース単位でトランザクション アイソレーションレベルの設定を行う必要がある。
						</p>
<div class="figure">
<a name="N164CD"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;WebLogicのトランザクション アイソレーション設定(weblogic-ejb-jar.xml).
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;weblogic-ejb-jar  xmlns="http://www.bea.com/ns/weblogic/90" ...&gt;
...
  &lt;transaction-isolation&gt;
    &lt;isolation-level&gt;△△△&lt;/isolation-level&gt;
    &lt;method&gt;
      &lt;description&gt;●●●&lt;/description&gt;
      &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
      &lt;method-intf&gt;■■■&lt;/method-intf&gt;
      &lt;method-name&gt;□□□&lt;/method-name&gt;
    &lt;/method&gt;
   &lt;/transaction-isolation&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
						
</p>
<div class="figure">
<a name="N164D8"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;ejb-jar.xmlの設定</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;weblogic-ejb-jar&gt;
...
  &lt;transaction-isolation&gt;
	&lt;isolation-level&gt;△△△&lt;/isolation-level&gt;
	&lt;method&gt;
	  &lt;description&gt;●●●&lt;/description&gt;
	  &lt;ejb-name&gt;○○○&lt;/ejb-name&gt;
	  &lt;method-intf&gt;■■■&lt;/method-intf&gt;
	  &lt;method-name&gt;□□□&lt;/method-name&gt;
	&lt;/method&gt;
   &lt;/transaction-isolation&gt;
...
&lt;/weblogic-ejb-jar&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
						
</p>
<div class="figure">
<a name="N164E3"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;JBossデータソースのトランザクション アイソレーション設定</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
#xa-data-sourceコマンドを利用して、トランザクション アイソレーションレベルにTRANSACTION_READ_UNCOMMITTEDを設定する
[standalone@localhost:9999 /] xa-data-source --name=postgresDS --transaction-islation=TRANSACTION_READ_UNCOMMITTED

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.5.1.6."></a>
<h3 class="title">1.5.1.6.参照渡し及び値渡し設定</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではweblogic-ejb-jar.xmlのenable-call-by-referenceでEJBの参照渡し、値渡しの宣言を行う。
			</p>
<div class="table">
<a name="N164FB"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;weblogic-ejb-jar.xml設定項目</b>
</p>
<div class="table-contents">
<table summary="weblogic-ejb-jar.xml設定項目" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>設定項目</th><th>WebLogic</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>参照渡し、値渡しの宣言</td><td>
								
<p>enable-call-by-reference</p>
								False（デフォルト）：値渡し(パラメータがシリアライズ可能でない場合は、参照渡しとなる)
								<p>True：参照渡し</p>
							
</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
		
</p>
<p>
			JBossでの参照渡し、値渡しの設定方法について以下に示す。Remote EJBを利用する場合、Remoete	EJBのメソッド引数で指定するパラメータを参照渡し、値渡しにするか設定する必要がある。JBoss EAP6のデフォルトでは、値渡しが設定される。値渡しが有効であると、分散GCアルゴリズムにより、定期的に分散GCが行われるため、要件に応じて適切にパラメータ（参照渡し/値渡し）を設定する必要がある。
			</p>
<div class="figure">
<a name="N16519"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;管理CLIによるRemoteEJBの参照渡し設定.
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
[standalone@localhost:9999/] /subsystem=ejb3:write-attribute(name=in-vm-remote-iterface-invocation-pass-by-value,value=false)

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_1.6."></a>
<h3 class="title">1.6.Webサービスのサーバ移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogic9のWeb サービスは、ステートレス セッションBean、Java クラス、JMSなどの複数のバックエンド
			コンポーネントを組み込んで実装することができる。JBossのWebサービスコンポーネントであるJBossWSの基本仕様はJAX-WSであるが、WebLogic9の仕様はJAX-RPCとなっている。JBossへ移植するためには、以下の２つの方法がある。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBossEAP6が提供するwsprovideやwsconsumeを利用してJAX-WS仕様に基づいて移行する。
					</p>
</li>
<li class="listitem">
<p>JBossEAP5が提供するwstoolを利用してJAX-RPC仕様に基づいて移行する </p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>JBoss EAP6では、JAX-RPCのWebサービスに必要なJ2EE Web サービス
							プロイメント記述子ファイルであるwebservices.xml、jaxrpc-mapping.xml及びWSDLファイルをエンドポイントクラスより作成する機能がないため、JAX-RPCのWebサービスを作成する場合は、JBossEAP5が提供するwstoolを利用する必要がある。推奨はJAX-WSである
							</p>
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
<p>
            
        
</p>
<p>

		オペレーション（サービスメソッドの）の呼び出し方法を「オペレーションスタイル」と呼び、「RPC」と「ドキュメント」の2種類がある。また、XMLデータ相互変換方式を「エンコードスタイル」と呼び、「エンコーデット」と「リテラル」の2種類が存在する。

			</p>
<div class="table">
<a name="N155FC"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;オペレーションスタイルの動作の違い</b>
</p>
<div class="table-contents">
<table summary="オペレーションスタイルの動作の違い" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>-</th><th>RPC</th><th>ドキュメント</th>
</tr>
</thead>
<tbody>
<tr>
<td>オペレーションスタイル</td><td>SOAP メッセージにパラメータと戻り値が格納される</td><td>SOAP メッセージに XML ドキュメントが格納される</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
			
			
</p>
<div class="table">
<a name="N15612"></a>
<p class="title">
<b>Table&nbsp;2.&nbsp;XMLデータ相互変換方式の違い</b>
</p>
<div class="table-contents">
<table summary="XMLデータ相互変換方式の違い" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>-</th><th>エンコーデット</th><th>リテラル</th>
</tr>
</thead>
<tbody>
<tr>
<td>エンコードスタイル</td><td>SOAP独自エンコーディング</td><td>wsdlに定義されたXMLスキーマのデータ型にしたがって、XMLデータの相互変換を行なう</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
			「エンコーデット」については、SOAP-1.1で定義されているが、修正できない固有の相互運用性問題があり、JBossのWebサービスコンポーネントであるJBoss-WSはrpc/encodedをサポートとしていない。以下のようにWSDLファイルでrpc/encodedが利用されている場合、エンコードスタイルをリテラルに変更しrpc/literalか、document/literal を採用する。
		</p>
</div>
<br>
<br>
<a name="tubame_1.6.1."></a>
<h3 class="title">1.6.1.WebLogicのWebサービス特徴</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogic9よりJWS Metadata
			アノテーション(javax.jws.*)が可能になっており、エンドポイントクラスにJWSMetadataアノテーションを付与してWebサービスの実装を行うようになった。以下はWebLogic9のWebサービス開発方法である。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JWS Metadata
						アノテーション(javax.jws.*)を付与したエンドポイントクラスよりjwscコマンドを利用してWebサービスを作成するボトムダウン開発が可能
					</p>
</li>
<li class="listitem">
<p>wsdlファイルよりwsdlcコマンドを利用したトップダウン開発が可能</p>
</li>
<li class="listitem">
<p>jwsc Antタスクにより、JWS
						Metadataアノテーション及び、WebLogic固有のJWSアノテーションを含むJWSファイルを入力に、WebLogic Web
						サービスの作成に必要なアーティファクトをすべて生成します。</p>
<div class="figure">
<a name="N1563E"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;jwsc Antタスク
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
...
  &lt;target name="server"&gt;
    &lt;mkdir dir="${ear.dir}"/&gt;
    &lt;jwsc
      srcdir="${basedir}"
      destdir="${ear.dir}"
      classpath="${java.class.path}"
      fork="true"
      keepGenerated="true"
      deprecation="${deprecation}"
      debug="${debug}"
      verbose="false"&gt;
        &lt;jws file="${ws.file}.java" explode="true"/&gt;
    &lt;/jwsc&gt;
  &lt;/target&gt;
...
						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>


			
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>
					weblogicのWebサービスの特徴としてJWS
					Metadataノテーションに加えて以下のようなWebLogoc独自アノテーションであるWLHttpTransportアノテーションを利用したWebサービスの実装が多い。
					</p>
<div class="figure">
<a name="N1564C"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;WebLogic9のWebサービス実装
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
import javax.jws.WebMethod;
import javax.jws.WebService;
import javax.jws.soap.SOAPBinding;

// Import the WebLogic-specific JWS annotation interfaces

import weblogic.jws.WLHttpTransport;

// Standard JWS annotation that specifies that the name of the Web Service is
// "Example" and the targetNamespace used in the generated WSDL is
// "http://example.org"
@WebService(name="Example", targetNamespace="http://example.org")

// Standard JWS annotation that specifies the mapping of the service onto the
// SOAP message protocol.
@SOAPBinding(style=SOAPBinding.Style.DOCUMENT,
             use=SOAPBinding.Use.LITERAL,
             parameterStyle=SOAPBinding.ParameterStyle.WRAPPED)

// WebLogic-specific JWS annotation that specifies the context path and
// service URI used to build the URI of the Web Service is "jws_basic_Example/ExampleService"
@WLHttpTransport(contextPath="jws_basic_example", serviceUri="ExampleService")

						</pre>
</div>
</div>
<p>
<br class="figure-break">
				
</p>
</td>
</tr>
</table>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.6.2."></a>
<h3 class="title">1.6.2.JAVA実装のWebサービス（JAX-RPC仕様）への移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JAX-RPCのWebサービスをJBossに移行する場合、JBossEAP6では、JAX-RPCのデプロイメントで必要な定義ファイルを作成するための機能(JBossEAP5のwstools相当機能)が存在しないため、JBossEAP5のwstoolsを利用して、エンドポイントクラスよりボトムアップでWebサービスを修正する必要がある。
		</p>
<p>
			この際、WebLogic9ではJWSアノテーションを利用したエンドポイントクラスが想定されるが、wstoolはJWSアノテーションが付与されたエンドポイントクラスを入力とすることができないため、、JWSアノテーションを依存を削除し、Webサービス実装を以下のように修正する必要がある。
			</p>
<div class="figure">
<a name="N15666"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogic9のWebサービス実装
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
package examples.webservices.basic.javaclass;

import javax.jws.WebService;
import javax.jws.soap.SOAPBinding;
import weblogic.jws.WLHttpTransport;

@WebService(name = "HelloWorldWebService", targetNamespace = "http://examples.com/servers/jboss/samples/examples/webservices/basic/javaclass", serviceName = "HelloWorldService")
@SOAPBinding(style = SOAPBinding.Style.DOCUMENT, use = SOAPBinding.Use.LITERAL, parameterStyle = SOAPBinding.ParameterStyle.WRAPPED)
@WLHttpTransport(contextPath="example", serviceUri="helloWorld")
public class HelloWorld {

	public String sayHello(int num, String s) {
		System.out.println("sayHello in the HelloWorldJSE has "
				+ "been invoked with arguments " + s + " and " + num);

		String returnValue = "This message brought to you by the " + "letter "
				+ s + " and the number " + num;

		return returnValue;
	}

}

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			
</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>JWSアノテーションを依存をなくし、あらたにサービスエンドポイント用のインタフェースクラスを作成する。
					</p>
<div class="figure">
<a name="N15675"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;JBossのサービスエンドポイント用のインタフェースクラス(SEI)
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
public interface HelloWorld extends Remote{
 
String sayHello(int num, String s)
    throws RemoteException;
}

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>サービスエンドポイントインタフェース(SEI)の実装</p>
<div class="figure">
<a name="N15682"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;JBossのサービスエンドポイント用のインタフェースクラス(SEI)の実装
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
public class HelloWorldJSE implements HelloWorld {
 
    ...
	public String sayHello(int num, String s) {
		System.out.println("sayHello in the HelloWorldJSE has "
				+ "been invoked with arguments " + s + " and " + num);

		String returnValue = "This message brought to you by the " + "letter "
				+ s + " and the number " + num;

		return returnValue;
	}

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>wstoolを実行する上で必要なwstools-config.xmlファイルを作成 </p>
<div class="figure">
<a name="N1568F"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;wstools-config.xml
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration xmlns="http://www.jboss.org/jbossws-tools"&gt;
&lt;java-wsdl&gt;
    &lt;service name="HelloWorldService"
   style="rpc"
     endpoint="examples.webservices.basic.javaclass.HelloWorld"/&gt;
 &lt;namespaces
      target-namespace="http://examples.com/webservices/basic/javaclass/"
      type-namespace="http://examples.com/webservices/basic/javaclass/types"/&gt;
    &lt;mapping file="jaxrpc-mapping.xml"/&gt;
    &lt;webservices servlet-link="HelloWorldServletLink"/&gt;
  &lt;/java-wsdl&gt;
&lt;/configuration&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>wstoolを実行し、J2EE Web サービス
						デプロイメント記述子ファイルであるwebservices.xml、jaxrpc-mapping.xml及びWSDLファイルを作成
					</p>
<div class="figure">
<a name="N1569C"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;JBossEAP5のwstools実行例
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
※$JBOSS_HOMEは、JBossEAP6でなくJBossEAP5のホームパスです
# cd $SRC_DIR
# javac &#19; d $BUILD_DIR  -cp $JBOSS_HOME/lib/jboss-j2ee.jar \
 examples/webservices/basic/javaclass/HelloWorldJSE.java
# cd $BUILD_DIR
# $JBOSS_HOME/bin/wstools &#19; -cp HelloWorldJSE  -config wstools-config.xml -dest generated
genereted配下に以下のファイルが作成される
 |-- genereted
          |-- wsdl/*.wsdl
          |-- jaxrpc-mapping.xml
          |-- webservices.xml
...

						</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N156A6"></a>
<p class="title">
<b>Figure&nbsp;6.&nbsp;wstoolsのant例(build.xml)
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="execute_wstools" default="execute_wstools_jboss51" basedir="."&gt;
...
&lt;path id="wstools.classpath.jboss51"&gt;
	&lt;fileset dir="${jboss.home}/client" /&gt;
	&lt;fileset dir="${jboss.home}/common/lib" /&gt;
	&lt;fileset dir="${jboss.home}/lib" /&gt;
&lt;/path&gt;
 
&lt;target name="execute_wstools_jboss51" depends="compile"&gt;
	&lt;taskdef name="wstools" classname="org.jboss.ws.tools.ant.wstools"&gt;
	    &lt;classpath refid="wstools.classpath.jboss51" /&gt;
	    &lt;classpath&gt;
	         &lt;pathelement location="${basedir}/target/classes" /&gt;
	    &lt;/classpath&gt;
	&lt;/taskdef&gt;
 
	&lt;wstools dest="${basedir}/src/main/resources/META-INF"
	    config="${basedir}/wstools-config.xml" /&gt;
&lt;/target&gt;
 
&lt;target name="compile" &gt;
	&lt;javac srcdir="${basedir}/src/main/java"
	   destdir="${basedir}/target/classes" debug="on"&gt;
	        &lt;classpath refid="wstools.classpath.jboss51" /&gt;
	&lt;/javac&gt;
&lt;/target&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>web.xmlの作成</p>
<p>JSR-109 java
						サービスエンドポイント(JSE)は、WEBアプリケーションとしてデプロイする必要があるので、web.xmlファイルを作成servlet及びservlet-mapping設定を行う。本設定で指定するservlet-nameはwstools-config.xmlファイルで設定したwebservicesタグのservlet-link属性の値と同じように設定し、servlet-classは、WebServiceアノテーションを付与したサービスエンドポイントとなるクラスを指定する。
					</p>
<div class="figure">
<a name="N156B5"></a>
<p class="title">
<b>Figure&nbsp;7.&nbsp;web.xml例
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app
 xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance
 xmlns="http://java.sun.com/xml/ns/javaee"
 xmlns:web=http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd
 xsi:schemaLocation="http://java.sun.com/xml/ns/javaee
 http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
 id="WebApp_ID" version="2.5"&gt;
  &lt;display-name&gt;hello-webservice-pojo-an&lt;/display-name&gt;
    &lt;servlet&gt;
      &lt;servlet-name&gt;HelloWorldServletLink&lt;/servlet-name&gt;
      &lt;servlet-class&gt;examples.webservices.basic.javaclass.HelloWorldJSE&lt;/servlet-class&gt;
    &lt;/servlet&gt;
    &lt;servlet-mapping&gt;
      &lt;servlet-name&gt;HelloWorldServletLink&lt;/servlet-name&gt;
      &lt;url-pattern&gt;/HelloWorld&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;
&lt;/web-app&gt;

						</pre>
</div>
</div>
<br class="figure-break">
<p>なお、url-patternは任意の設定が可能でこの値がターゲットエンドポイントとなる。上記の場合は、url-patternに&rdquo;/HelloWorld&rdquo;が設定されており、WSDLを取得する際のURLは「http://ホスト:8080/コンテキストパス/
						HelloWorld?wsdl」以下になる
					</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>WebLogicのWLHttpTransportアノテーションでcontextPathの設定が可能だが、JBossではMETA-INF配下にcontext.xmlを作成して、Path設定を行うことで、コンテキストパスを変更することができる
						</p>
<div class="figure">
<a name="N156C4"></a>
<p class="title">
<b>Figure&nbsp;8.&nbsp;context-xml例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;Context path="chage-context"/&gt;

							</pre>
</div>
</div>
<br class="figure-break">
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>warファイルの作成</p>
<p>
						wstoolで作成されたJ2EE Web サービス
						デプロイメント記述子ファイル、WSDLファイル、クラス群及びweb.xmlを含め、warファイルにパッケージングする。
						</p>
<div class="figure">
<a name="N156D3"></a>
<p class="title">
<b>Figure&nbsp;9.&nbsp;warファイルにパッケージするXMLについて
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
 |-- webapp(src/main/webapp)
          |-- META-INF
                | -- context.xml
          |-- WEB-INF
                |-- wsdl
                     |-- jaxrpc-mapping.xml
                |--jaxrpc-mapping.xml
                |--web.xml
                |--webservices.xml

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
</ol>
</div>
<p>



		
</p>
</div>
<br>
<br>
<a name="tubame_1.6.3."></a>
<h3 class="title">1.6.3.JAVA実装のWebサービス（JAX-WS仕様）への移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JAX-RPCのWebサービスをJBossのJAX-WSに移行する場合、エンドポイントクラスよりwsprovideを利用して、スキーマ、WSDL、ラッパークラスを生成し、ボトムアップ開発でWebサービスを修正する必要がある。
		</p>
<p>
			Webサービス実装を以下のように修正する。

			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>WebLogic独自のWLHttpTransportアノテーションの削除</p>
<div class="figure">
<a name="N156F1"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;エンドポイントクラスに設定されたWLHttpTransportアノテーションをコメントする
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
//import weblogic.jws.WLHttpTransport;

//WebLogic-specific JWS annotation that specifies the context path and
//service URI used to build the URI of the Web Service is "jws_basic_simple/SimpleService"
//@WLHttpTransport(contextPath="jws_basic_simple", serviceUri="SimpleService")

						</pre>
</div>
</div>
<br class="figure-break">
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>エンドポイントクラスのメソッドに@WebParamでname属性を指定しない場合、WebLogicの場合、メソッド名の型の変数名(以下の例ではMyHelloMessage）を利用したWSDLが生成されるが、
							JBossではarg0などの名称が設定されるので、WebLogic同様にメソッド名の型の変数名を利用する場合は、WebParamでname属性を明示的に指定する必要がある。
						</p>
<div class="figure">
<a name="N156FE"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;@WebParamでname属性を指定なしの実装(WebLogic)</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
  @WebMethod()
  public String sayHello(String MyHelloMessage) throws RemoteException {
    System.out.println("sayHello '" + MyHelloMessage + "' to you too!");
    return "'" + MyHelloMessage + "' to you too!";
  }

							</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N15708"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;WebLogicのjwscコマンドを利用して生成されたWSDL
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
  &lt;xs:element name="sayHello"&gt;
        &lt;xs:complexType&gt;
          &lt;xs:sequence&gt;
            &lt;xs:element name="MyHelloMessage" type="xs:string"/&gt;
          &lt;/xs:sequence&gt;
        &lt;/xs:complexType&gt;
  &lt;/xs:element&gt;

							</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N15712"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;@WebParamでname属性の指定なし、JBossのwsprovideコマンドを利用して生成されたWSDL例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
  &lt;xs:complexType name="sayHello"&gt;
		&lt;xs:sequence&gt;
		&lt;xs:element minOccurs="0" name="arg0" type="xs:string"/&gt;
		&lt;/xs:sequence&gt;	
  &lt;/xs:complexType&gt;

							</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N1571C"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;@WebParamでname属性の指定した場合あり、JBossのwsprovideコマンドを利用して生成されたWSDL例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;xs:complexType name="sayHello"&gt;
    &lt;xs:sequence&gt;
      &lt;xs:element minOccurs="0" name="MyHelloMessage" type="xs:string"/&gt;
    &lt;/xs:sequence&gt;
  &lt;/xs:complexType&gt;

							</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N15726"></a>
<p class="title">
<b>Figure&nbsp;6.&nbsp;@WebParamでname属性を指定した場合の実装例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								 
  @WebMethod()
  public String sayHello(@WebParam(name="MyHelloMessage") String MyHelloMessage) throws RemoteException {
    System.out.println("sayHello '" + MyHelloMessage + "' to you too!");
    return "'" + MyHelloMessage + "' to you too!";
  }

							</pre>
</div>
</div>
<br class="figure-break">
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>wsprovideの実行</p>
<p>wsprovideを実行することにより、WSDLファイル及びクラス群の生成を行う。</p>
<div class="figure">
<a name="N15735"></a>
<p class="title">
<b>Figure&nbsp;7.&nbsp;wsprovie実行例(build/gen配下に出力)
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
wsprovide  --classpath=./target/classes -o build/gen -w examples.webservices.jws_basic.complex.SimpleImpl
(build/gen配下に以下のファイルが作成される)
 |-- gen
          |-- *.wsdl
          |-- *.xsd
          |-- **/jaxws/*.java or class

							</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>web.xmlの作成</p>
<p>エンドポイントに関連するメタデータは、JSR-181 アノテーションによって既定される。JSR-181 Javaサービスエンドポイントは、WEBアプリケーションとしてデプロイする必要があるので、web.xmlファイルを作成しservlet及びservlet-mapping設定を行う。本設定で指定するservlet-nameはエンドポイントクラスに設定したWebServiceアノテーションのname属性の値を設定し、servlet-classはサービスエンドポイントとなるクラスを指定する。
                     </p>
<div class="figure">
<a name="N15744"></a>
<p class="title">
<b>Figure&nbsp;8.&nbsp;web.xml例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;web-app xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns="http://java.sun.com/xml/ns/javaee" xmlns:web="http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"
	id="WebApp_ID" version="2.5"&gt;
	&lt;servlet&gt;
		&lt;servlet-name&gt;SimpleWebService&lt;/servlet-name&gt;
		&lt;servlet-class&gt;examples.webservices.jws_basic.complex.SimpleImpl&lt;/servlet-class&gt;
	&lt;/servlet&gt;

	&lt;servlet-mapping&gt;
		&lt;servlet-name&gt;SimpleWebService&lt;/servlet-name&gt;
		&lt;url-pattern&gt;/SimpleWebService&lt;/url-pattern&gt;
	&lt;/servlet-mapping&gt;
&lt;/web-app&gt;
							</pre>
</div>
</div>
<p>
<br class="figure-break">
                        なお、url-patternは任意の設定が可能でこの値がターゲットエンドポイントとなる。上記の場合は、url-patternに&rdquo;/SimpleWebService&rdquo;が設定されており、WSDLを取得する際のURLは「http://ホスト:8080/コンテキストパス/SimpleWebService?wsdl」のようになる。
                    </p>
</li>
<li class="listitem">
<p>warファイルの作成</p>
<p>wsprovideで生成されたWSDLファイル、XSDスキーマファイル、クラス群及びweb.xmlを含め、warファイルにパッケージングする。 
                     </p>
<div class="figure">
<a name="N15754"></a>
<p class="title">
<b>Figure&nbsp;9.&nbsp;warファイルにパッケージするXMLについて 							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
 |-- webapp(src/main/webapp)
          |-- META-INF
                | -- 
          |-- WEB-INF
                |-- *.wsdl 
                |-- *.xsd
                |--web.xml
                |--webservices.xml

							</pre>
</div>
</div>
<p>
<br class="figure-break">
                    
</p>
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.6.4."></a>
<h3 class="title">1.6.4.EJB実装のWebサービス（JAX-RPC仕様）への移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicでは、エンドポイントクラスにJWS
			metadataアノテーション及びweblogic.ejbgen.Sessionアノテーションを設定して、EJBエンドポイント実装（JAX-RPC
			仕様）のWebサービスを実装することができる。
		</p>
<p>
			なお、エンドポイントクラスには、weblogic.ejbgen.Sessionに加えて、以下のいづれかのアノテーションが明示的に定義されている必要がある。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>weblogic.jws.Transactional</p>
</li>
<li class="listitem">
<p>weblogic.jws.security.SecurityRoles</p>
</li>
<li class="listitem">
<p>weblogic.jws.security.SecurityIdentity</p>
</li>
</ul>
</div>
<p>
			
</p>
<div class="figure">
<a name="N15779"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogic9のEJBのWebサービス実装
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
import javax.ejb.SessionBean;
import javax.ejb.SessionContext;
import javax.jws.WebMethod;
import javax.jws.WebService;
import weblogic.jws.WLHttpTransport;
import weblogic.jws.Transactional;
import weblogic.ejbgen.Session;
@Session(ejbName="ExampleEJB")
@WebService(name="ExamplePortType", serviceName="ExampleService",
            targetNamespace="http://example.org")

@WLHttpTransport(contextPath="Examples", serviceUri="ExampleService",
                 portName="ExamplePort")

public class ExampleBean implements SessionBean {
  @WebMethod()
  @Transactional(value=true)
  public String sayHello(String message) {
    System.out.println("sayChao:" + message);
    return "Here is the chao message: '" + message + "'";
  }

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			JBossEAP6ではJWS metadataアノテーション及びjavax.ejb.*
			アノテーションを利用して、JAX-RPC仕様のEJB実装のWebサービスを実装する機能はない。JBossEAP6では、JAX-WSを強く推奨しているが、JAX-RPCをそのままJBossEAP6に置き換える場合は、JWS
			metadataアノテーションをすべて削除し、EJB2系のEJB実装に修正し、JBossEAP5のwstoolsを
			利用して、EJB実装のWebサービスの作成を行う必要がある。以下にWebサービス作成方法を示す。
			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>JWSアノテーション及びweblogic.ejbgen.Sessionアノテーションを削除し、POJOのサービスエンドポイント用のインタフェースクラスを作成する。
					</p>
<div class="figure">
<a name="N15788"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;JBossのサービスエンドポイント用のインタフェースクラス
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
public interface ExampleEndPoint extends Remote{
   String sayHello(String message)  throws RemoteException;
}

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>EJBの実装</p>
<div class="figure">
<a name="N15795"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;JBossのサービスエンドポイント用のインタフェースクラスで定義したメソッドを実装するEJB実装
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
public class ExampleBean implements SessionBean {
    ...
	public String sayHello(String message) {
	
	    String returnValue = "Chao: "+message;

	    return returnValue;
	 }

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>ejb-jar.xmlを作成 </p>
<div class="figure">
<a name="N157A2"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;ejb-jar.xml
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;ejb-jar xmlns="http://java.sun.com/xml/ns/j2ee" version="2.1"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee
http://java.sun.com/xml/ns/j2ee/ejb-jar_2_1.xsd"&gt;

	&lt;enterprise-beans&gt;
		&lt;session&gt;
			&lt;ejb-name&gt;Example&lt;/ejb-name&gt;
			&lt;service-endpoint&gt;examples.webservices.basic.statelessSession.ExampleEndPoint&lt;/service-endpoint&gt;
			&lt;ejb-class&gt;examples.webservices.basic.statelessSession.ExampleBean&lt;/ejb-class&gt;
			&lt;session-type&gt;Stateless&lt;/session-type&gt;
			&lt;transaction-type&gt;Container&lt;/transaction-type&gt;
		&lt;/session&gt;
	&lt;/enterprise-beans&gt;

						</pre>
</div>
</div>
<br class="figure-break">
<p>なお、wstools-config.xmlに設定したwebservicesタグのejb-link属性はejb-jar.xmlのejb-nameと一致する必要がある。
						上記の場合は、ejb-link属性に&rdquo;Example&rdquo;が設定されており、WSDLを取得する際のURLは以下のようになる。
					</p>
</li>
<li class="listitem">
<p>wstoolを実行する上で必要なwstools-config.xmlファイルを作成 </p>
<div class="figure">
<a name="N157B1"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;wstools-config.xml
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration xmlns="http://www.jboss.org/jbossws-tools"&gt;
&lt;java-wsdl&gt;
  &lt;service name="ExampleService"
      style="rpc"
      endpoint="examples.webservices.basic.statelessSession.ExampleEndPoint"/&gt;
    &lt;namespaces
      target-namespace=
"http://examples.com/webservices/basic/statelessSession/"
      type-namespace=
        "http://examples.com/webservices/basic/statelessSession/types"/&gt;
    &lt;mapping file="jaxrpc-mapping.xml"/&gt;
    &lt;webservices ejb-link="Example"/&gt;
  &lt;/java-wsdl&gt;
&lt;/configuration&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>wstoolを実行し、J2EE Web サービス
						デプロイメント記述子ファイルであるwebservices.xml、jaxrpc-mapping.xml及びWSDLファイルを作成
					</p>
<div class="figure">
<a name="N157BE"></a>
<p class="title">
<b>Figure&nbsp;6.&nbsp;JBossEAP5のwstools実行例
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
※$JBOSS_HOMEは、JBossEAP6でなくJBossEAP5のホームパスです
# cd $SRC_DIR
# javac -d $BUILD_DIR  -cp $JBOSS_HOME/lib/jboss-j2ee.jar \
 examples/webservices/basic/statelessSession/ExampleEndPoint
# cd $BUILD_DIR
# $JBOSS_HOME/bin/wstools &#19; -cp ExampleEndPoint  -config wstools-config.xml -dest generated
genereted配下に以下のファイルが作成される
 |-- genereted
          |-- wsdl/*.wsdl
          |-- jaxrpc-mapping.xml
          |-- webservices.xml
...

						</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N157C8"></a>
<p class="title">
<b>Figure&nbsp;7.&nbsp;wstoolsのant例(build.xml)
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project name="execute_wstools" default="execute_wstools_jboss51" basedir="."&gt;
...
&lt;path id="wstools.classpath.jboss51"&gt;
	&lt;fileset dir="${jboss.home}/client" /&gt;
	&lt;fileset dir="${jboss.home}/common/lib" /&gt;
	&lt;fileset dir="${jboss.home}/lib" /&gt;
&lt;/path&gt;
 
&lt;target name="execute_wstools_jboss51" depends="compile"&gt;
	&lt;taskdef name="wstools" classname="org.jboss.ws.tools.ant.wstools"&gt;
	    &lt;classpath refid="wstools.classpath.jboss51" /&gt;
	    &lt;classpath&gt;
	         &lt;pathelement location="${basedir}/target/classes" /&gt;
	    &lt;/classpath&gt;
	&lt;/taskdef&gt;
 
	&lt;wstools dest="${basedir}/src/main/resources/META-INF"
	    config="${basedir}/wstools-config.xml" /&gt;
&lt;/target&gt;
 
&lt;target name="compile" &gt;
	&lt;javac srcdir="${basedir}/src/main/java"
	   destdir="${basedir}/target/classes" debug="on"&gt;
	        &lt;classpath refid="wstools.classpath.jboss51" /&gt;
	&lt;/javac&gt;
&lt;/target&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>jarファイルの作成</p>
<p>
						wstoolで作成されたJ2EE Web サービス
						デプロイメント記述子ファイル、WSDLファイル、クラス群及びweb.xmlを含め、warファイルにパッケージングする。
						</p>
<div class="figure">
<a name="N157D7"></a>
<p class="title">
<b>Figure&nbsp;8.&nbsp;jarファイルにパッケージするXMLについて
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								 
 |-- resources(src/main/resources)
          |-- META-INF
                |-- wsdl
                     |-- *.wsdl
                |--jaxrpc-mapping.xml
                |--ejb-jar.xml
                |--webservices.xml

							</pre>
</div>
</div>
<p>
<br class="figure-break">
						wstoolで作成されたJ2EE Web サービス
						デプロイメント記述子ファイルであるwebservices.xml、jaxrpc-mapping.xml及びWSDLファイルをMETA-INFフォルダ配下に含め、jarファイルにパッケージングする。デプロイ後はロケーションURLに「?wsdl」を付与したアドレスよりWSDLファイルの内容がブラウザより正常に表示されることを確認する。
						ex)http://localhost:8080/hello-webservice-jsr109-ejb/Example?wsdl
					</p>
</li>
</ol>
</div>
<p>



		
</p>
</div>
<br>
<br>
<a name="tubame_1.6.5."></a>
<h3 class="title">1.6.5.EJB実装のWebサービス（JAX-WS仕様）への移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JAX-RPCのWebサービスをJBossのJAX-WSに移行する場合、エンドポイントクラスよりwsprovideを利用して、スキーマ、WSDL、ラッパークラスを生成し、ボトムアップ開発でWebサービスを修正する必要がある。
		</p>
<p>
			なお、WebLogicのEJBエンドポイントクラスには、weblogic.ejbgen.Sessionに加えて、以下のいづれかのアノテーションが明示的に定義されている。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>weblogic.jws.Transactional</p>
</li>
<li class="listitem">
<p>weblogic.jws.security.SecurityRoles</p>
</li>
<li class="listitem">
<p>weblogic.jws.security.SecurityIdentity</p>
</li>
</ul>
</div>
<p>
			
</p>
<div class="figure">
<a name="N157FC"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogic9のEJBのWebサービス実装
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
import javax.ejb.SessionBean;
import javax.ejb.SessionContext;
import javax.jws.WebMethod;
import javax.jws.WebService;
import weblogic.jws.WLHttpTransport;
import weblogic.jws.Transactional;
import weblogic.ejbgen.Session;
@Session(ejbName="ExampleEJB")
@WebService(name="ExamplePortType", serviceName="ExampleService",
            targetNamespace="http://example.org")

@WLHttpTransport(contextPath="Examples", serviceUri="ExampleService",
                 portName="ExamplePort")

public class ExampleBean implements SessionBean {
  @WebMethod()
  @Transactional(value=true)
  public String sayHello(String message) {
    System.out.println("sayChao:" + message);
    return "Here is the chao message: '" + message + "'";
  }

				</pre>
</div>
</div>
<p>
<br class="figure-break">
	        以下にWebサービス実装の修正方法について示す。
			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>WebLogic独自の「weblogic.jws.*」アノテーション及び「weblogic.ejbgen.*」アノテーションの削除	</p>
<div class="figure">
<a name="N1580B"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;「weblogic.jws.*」実装例アノテーション及び「weblogic.ejbgen.*」アノテーションの削除
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							import javax.ejb.SessionBean;
import javax.ejb.SessionContext;
import javax.jws.WebMethod;
import javax.jws.WebService;
//import weblogic.jws.WLHttpTransport;
//import weblogic.jws.Transactional;
import weblogic.ejbgen.Session;
@Session(ejbName="ExampleEJB")
@WebService(name="ExamplePortType", serviceName="ExampleService",
            targetNamespace="http://example.org")

//@WLHttpTransport(contextPath="Examples", serviceUri="ExampleService",
                 portName="ExamplePort")

public class ExampleBean implements SessionBean {
  @WebMethod()
  @Transactional(value=true)
  public String sayHello(String message) {
    System.out.println("sayChao:" + message);
    return "Here is the chao message: '" + message + "'";

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>Java標準のjavax.ejb.Statelessアノテーションを設定</p>
<div class="figure">
<a name="N15818"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;javax.ejb.Statelessアノテーションを設定例
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
import javax.ejb.SessionBean;
import javax.ejb.SessionContext;
import javax.jws.WebMethod;
import javax.jws.WebService;
//import weblogic.jws.WLHttpTransport;
//import weblogic.jws.Transactional;
//import weblogic.ejbgen.Session;

/* new define */
import javax.ejb.Stateless

@Stateless(name="ExampleEJB")
@WebService(name="ExamplePortType", serviceName="ExampleService",
            targetNamespace="http://example.org")

//@WLHttpTransport(contextPath="Examples", serviceUri="ExampleService",
                 portName="ExamplePort")

public class ExampleBean implements SessionBean {
  @WebMethod()
  //@Transactional(value=true)
  public String sayHello(String message) {
    System.out.println("sayChao:" + message);
    return "Here is the chao message: '" + message + "'";


						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>wsprovideの実行 </p>
<div class="figure">
<a name="N15825"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;wsprovideの実行例
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							wsprovide  --classpath=./target/classes -o build/gen -w examples.webservices.jws_basic.complex.ExampleBean
(build/gen配下に以下のファイルが作成される)
 |-- gen
          |-- *.wsdl
          |-- *.xsd
          |-- **/jaxws/*.java or class

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>jarファイルの作成</p>
<p>
						wsprovideで生成されたWSDLファイル、XSDスキーマファイル、クラス群及びweb.xmlを含め、jarファイルにパッケージングする。
						</p>
<div class="figure">
<a name="N15834"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;jarファイルにパッケージするXMLについて
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								 |-- webapp(src\main\resources)
          |-- META-INF
                | -- *.xsd
                | -- *.wsdl
							</pre>
</div>
</div>
<p>
<br class="figure-break">
						上記の例ではWSDLを取得する際のURLは以下のようになる。
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>http://localhost:8080/webserivce-jws-ejb/ExampleService/ExamplePortType?wsdl</p>
<p>EJBのjarアーカイブの名称でコンテキスト名(webserivce-jws-ejb)が設定され、続いて javax.jws.WebServiceアノテーションのserviceName属性の値(SimpleService)が設定され、
javax.jws.WebServiceアノテーションのname属性の値が(SimplePortType)設定される。</p>
</li>
</ul>
</div>
<p>
					
</p>
</li>
</ol>
</div>
<p>



		
</p>
</div>
<br>
<br>
<a name="tubame_1.7."></a>
<h3 class="title">1.7.Webサービスのクライアント移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicのWebサービスクライアントの作成は、clientgen Antタスクより、WSDLからRPC用のスタブを作成してWebサービスクライアントの実装を行う。ここでは、JBossEAP6のwsconsumeを利用したWebサービスクライアントの移植方法について示す。

			</p>
<div class="figure">
<a name="N15853"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;clientgen Antタスク
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
...
  &lt;target name="client"&gt;
    &lt;mkdir dir="${client.dir}"/&gt;
    &lt;clientgen  wsdl="${ear.dir}/${ws.file}/WEB-INF/HelloService.wsdl"
      destDir="${client.dir}"
      classpath="${java.class.path}"
      packageName="examples.webservices.hello.client"/&gt;
    &lt;/target&gt;
...

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			
</p>
<div class="figure">
<a name="N1585E"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;WebLogic9のWebサービスクライアント実装
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
public class Client {
 
public static void main(String[] args) throws Exception {
    //WSDL　Location Address
    URL url = new URL("http://localhost:7001/context-name/SimpleService");
    SimpleService　simpleService = new SimpleService_Impl(url);
    SimplePortType　port = simpleService.getSimplePortTypeSoapPort();
    port.sayHello("Hi there!");
  }
}

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>
			以下にWebサービス実装の修正方法について示す。
			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>wsconsumeの実行</p>
<p>wsconsumeを実行し、スタブを生成する
					</p>
<div class="figure">
<a name="N15871"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;wsconsumeの実行
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
wsconsume -k  -o build/gen/classes -s build/gen/src -b ./build/input/SimpleService_schema1.xsd -b  ./build/input/SimpleService_schema2.xsd ./build/input/SimpleService.wsdl

wsconsumeを実行すると以下のような構成でファイルが作成される。
[カレントディレクトリ]
          |--  build/gen/classes/**.class
          |--  build/gen/src/**.java

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>クライアント実装</p>
<p>wsconsumeで生成されたスタブを利用して、Webサービスクライアントを実装する。WebLogicのWebサービスのクライアント実装とほとんど変わりはなく、サービスクラスをインスタンス化して、サービスクラスよりポートタイプクラスを取得して、メソッドの呼び出しを行う。
					</p>
<div class="figure">
<a name="N15880"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;クライアント実装
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
public static void main(String[] args) throws Exception {

    URL url = new URL("context-name/SimpleService?wsdl");
    SimpleService simpleService = new SimpleService(url);
    SimplePortType port = simpleService.getSimplePortTypePort();
    System.out.println(echoStruct);
    port.sayHello("Hi there!");
}

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>クライアント実行</p>
<div class="figure">
<a name="N1588D"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;クライアント実行</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
java -jar $JBOSS_HOME/jboss-modules.jar -mp $JBOSS_HOME/boss-eap-6.1/modules -dep org.jboss.ws.cxf.jbossws-cxf-client -cp classes org.example.Client

						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.8."></a>
<h3 class="title">1.8.RMI-IIOP実装の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogic Server での RMI-IIOP 実装の機能は以下のとおりである。本書では、WebLogic ServerのIIOP対応のEJBをJBossに移植する方法について示す。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>IIOP プロトコルを使用して Java RMI クライアントを WebLogic Serverに接続できる</p>
</li>
<li class="listitem">
<p>CORBA/IDL クライアント (C++ で記述されたものを含む) を WebLogic Server に接続できる</p>
</li>
<li class="listitem">
<p>WebLogic Server と Tuxedo クライアントの間で相互運用できる</p>
</li>
<li class="listitem">
<p>WebLogic ServerのEJBとIIOP プロトコルを使用してWebLogic Server に接続できる</p>
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.8.1."></a>
<h3 class="title">1.8.1.EJBサーバ実装の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicでは、通常のEJBのデプロイメントに対して、wlaapc　Antタスクを発行することで、IIOP通信するためのスタブを生成しIIOP対応のEJBが作成可能である。
			</p>
<div class="figure">
<a name="N15B0D"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogic9のwlappc Antタスク
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;target name="appc"&gt;
   &lt;wlappc iiop="true" source = "iiopejb.jar" /&gt;
&lt;/target&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">

		
</p>
<p>
			JBossの移植する際は、通常のWebLogicのEJBと同じで、weblogic-ejb-jar.xmlが存在するので、XXXを参考に、jboss-ejb3.xmlに移行すること。ここではEJBをIIOP対応させるために必要なJBossのデプロイメントディスクリプタの設定のみ記載する

			</p>
<div class="figure">
<a name="N15B1A"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jboss-ejb3.xmlにiiopタグを設定し、ejb-nameを設定する
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
 xmlns="http://java.sun.com/xml/ns/javaee"
 xmlns:iiop="urn:iiop"
 xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
 http://java.sun.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-spec-2_0.xsd 
 urn:iiop jboss-ejb-iiop_1_0.xsd" version="3.1"impl-version="2.0"&gt;
  &lt;assembly-descriptor&gt;
    &lt;iiop:iiop&gt;
      &lt;ejb-name&gt;Hello&lt;/ejb-name&gt;
    &lt;/iiop:iiop&gt;
  &lt;/assembly-descriptor&gt;
&lt;/jboss:ejb-jar&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_1.8.2."></a>
<h3 class="title">1.8.2.EJBクライアント実装の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossにデプロイされたIIOP対応のEJBに対して、IIOP通信にて、リモートEJBを実行する方法について示す。
			</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>IIOP対応のEJBクライアントを移行する際は以下の注意点がある</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>IIOP通信で必要なCorbaまわりの実装について、Javaに同梱された実装を利用するか
							JBossに同梱されたjacorb利用するか選定する(本書では、jacorbを利用することを前提とする)
						</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<p>
		
</p>
<p>
			
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JNDI設定の移行</p>
<p>
						InitialContext作成の際のContext.PROVIDER_URL,Context.INITIAL_CONTEXT_FACTORY,
						Context.URL_PKG_PREFIXESに設定する値をJBoss用に修正する。
						</p>
<div class="figure">
<a name="N15B41"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;jndi.properties例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
java.naming.factory.initial=com.sun.jndi.cosnaming.CNCtxFactory
java.naming.provider.url=corbaloc:iiop:localhost:3528/JBoss/Naming/root
java.naming.factory.url.pkgs=com.sun.jndi.cosnaming

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
<li class="listitem">
<p>ホームクラスルックアップ時のJNDI名の移行</p>
<p>
						jboss-ejb3.xmlに設定したejb-nameをJNDI名として指定する

						</p>
<div class="figure">
<a name="N15B51"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;ホームクラスルックアップ例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
	private static HelloHome lookupHelloHome() throws NamingException {
		Context ctx = getInitialContext();
		try {
			Object home =  ctx.lookup("Hello");
			return (HelloHome) PortableRemoteObject.narrow(home,
					HelloHome.class);
		} catch (NamingException ne) {
			throw ne;
		}
		
	}

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
<li class="listitem">
<p>CORBA設定</p>
<p>
						CORBA用の設定をシステムプロパティに定義する。
						</p>
<div class="figure">
<a name="N15B61"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;システムプロパティ定義例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
System.setProperty("com.sun.CORBA.ORBUseDynamicStub", "true");
System.setProperty("org.omg.CORBA.ORBClass", "org.jacorb.orb.ORB");
System.setProperty("org.omg.CORBA.ORBSingletonClass", "org.jacorb.orb.ORBSingleton");

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
<li class="listitem">
<p>セキュリティマネージャ設定</p>
<p>
						
</p>
<div class="figure">
<a name="N15B71"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;セキュリティマネージャ設定
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
  if ( System.getSecurityManager() == null )
            System.setSecurityManager(new RMISecurityManager());

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
<li class="listitem">
<p>Java セキュリティポリシー</p>
<p>
						
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>
									スタンドアロンクライアントアクセスを許可するために、システムプロパティに Java
									セキュリティポリシーを指定する必要があります。
									</p>
<div class="figure">
<a name="N15B85"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;システムプロパティで Java セキュリティポリシーを指定する
										</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
											
-Djava.security.policy=security.policy

										</pre>
</div>
</div>
<p>
<br class="figure-break">
								
</p>
</li>
<li class="listitem">
<p>セキュリティポリシーファイルの例</p>
<div class="figure">
<a name="N15B93"></a>
<p class="title">
<b>Figure&nbsp;6.&nbsp;すべてのアクセス権を付与する例(security.policy)
									</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
										
grant {
        // Allow everything for now
        permission java.security.AllPermission;
};

									</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>
					
</p>
</li>
<li class="listitem">
<p>クライアントライブラリ実装例</p>
<p>
						
</p>
<div class="figure">
<a name="N15BA3"></a>
<p class="title">
<b>Figure&nbsp;7.&nbsp;クライアントライブラリ実装例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
package org.jboss.as.quickstarts.ejb.remote.client;

import java.rmi.RMISecurityManager;

import javax.naming.Context;
import javax.naming.InitialContext;
import javax.naming.NamingException;
import javax.rmi.PortableRemoteObject;

import example.Hello;
import example.HelloHome;


public class RemoteEJBClient {

    private static final String homeJNDIName = "Hello";
    
    public static void main(String[] args) throws Exception {
    	
    	if ( System.getSecurityManager() == null ){
    		System.setSecurityManager(new RMISecurityManager());
    	}
    	// system property must be used by remote clients to dynamically generate the stubs
        System.setProperty("com.sun.CORBA.ORBUseDynamicStub", "true");
        System.setProperty("org.omg.CORBA.ORBClass", "org.jacorb.orb.ORB");
        System.setProperty("org.omg.CORBA.ORBSingletonClass", "org.jacorb.orb.ORBSingleton");
        HelloHome helloHome = lookupHelloHome();
    	System.out.println("HelloHome:"+helloHome);
		Hello hello = helloHome.create();
		String message = hello.sayHello();
		System.out.println("message  return = "+message); 
    	
    }

   
	private static HelloHome lookupHelloHome() throws NamingException {
		Context ctx = getInitialContext();
		try {
			Object home =  ctx.lookup(homeJNDIName);
			return (HelloHome) PortableRemoteObject.narrow(home,
					HelloHome.class);
		} catch (NamingException ne) {
			throw ne;
		}
		
	}

    private static InitialContext getInitialContext()
    	      throws NamingException
    	    {
    	    	InitialContext context = null;
    			try {
    	  			context = new InitialContext();
    	  		} catch (NamingException e) {
    	  			throw e;
    	  		}
    	  		return context;
    	    }
 
}

							</pre>
</div>
</div>
<p>
<br class="figure-break">

					
</p>
</li>
<li class="listitem">
<p>クライアントライブラリについて</p>
<p>
						IIOP対応のEJBクライアントを実行する際のmavenで必要な依存関係を示す。ライブラリの取得は、mvn
						dependency:copy-dependencies
						コマンドを実行するとJARファイル取得できるため、クライアント環境に配置して利用する
						</p>
<div class="figure">
<a name="N15BB3"></a>
<p class="title">
<b>Figure&nbsp;8.&nbsp;mavenのdependencies設定
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								   
   ...
   &lt;dependencyManagement&gt;
		&lt;dependencies&gt;
			&lt;!-- Define the version of JBoss' Java EE 6 APIs we want to use --&gt;
			&lt;!-- JBoss distributes a complete set of Java EE 6 APIs including a Bill 
				of Materials (BOM). A BOM specifies the versions of a "stack" (or a collection) 
				of artifacts. We use this here so that we always get the correct versions 
				of artifacts. Here we use the jboss-javaee-6.0 stack (you can read this as 
				the JBoss stack of the Java EE 6 APIs). You can actually use this stack with 
				any version of JBoss AS that implements Java EE 6, not just JBoss AS 7! --&gt;
			&lt;dependency&gt;
				&lt;groupId&gt;org.jboss.spec&lt;/groupId&gt;
				&lt;artifactId&gt;jboss-javaee-6.0&lt;/artifactId&gt;
				&lt;version&gt;${version.org.jboss.spec.jboss.javaee.6.0}&lt;/version&gt;
				&lt;type&gt;pom&lt;/type&gt;
				&lt;scope&gt;import&lt;/scope&gt;
			&lt;/dependency&gt;

			&lt;dependency&gt;
				&lt;groupId&gt;org.jboss.as&lt;/groupId&gt;
				&lt;artifactId&gt;jboss-as-ejb-client-bom&lt;/artifactId&gt;
				&lt;version&gt;${version.org.jboss.as}&lt;/version&gt;
				&lt;type&gt;pom&lt;/type&gt;
				&lt;scope&gt;import&lt;/scope&gt;
			&lt;/dependency&gt;
		&lt;/dependencies&gt;
	&lt;/dependencyManagement&gt;
	&lt;dependencies&gt;

		&lt;!-- Import the EJB 3.1 API, we use runtime scope because we aren't using 
			any direct reference to EJB spec API in our client code --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.jboss.spec.javax.ejb&lt;/groupId&gt;
			&lt;artifactId&gt;jboss-ejb-api_3.1_spec&lt;/artifactId&gt;
		&lt;/dependency&gt;

		&lt;!-- We depend on the EJB remote business interfaces of this application --&gt;
		&lt;dependency&gt;
			&lt;groupId&gt;org.jboss.as.quickstarts&lt;/groupId&gt;
			&lt;artifactId&gt;hello-ejb21-iiop&lt;/artifactId&gt;
			&lt;type&gt;ejb-client&lt;/type&gt;
			&lt;version&gt;${project.version}&lt;/version&gt;
		&lt;/dependency&gt;

		&lt;!-- JBoss EJB client API jar. We use runtime scope because the EJB client 
			API isn't directly used in this example. We just need it in our runtime classpath --&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.jboss&lt;/groupId&gt;
			&lt;artifactId&gt;jboss-ejb-client&lt;/artifactId&gt;
			&lt;scope&gt;runtime&lt;/scope&gt;
		&lt;/dependency&gt;

		&lt;dependency&gt;
			&lt;groupId&gt;org.jacorb&lt;/groupId&gt;
			&lt;artifactId&gt;jacorb&lt;/artifactId&gt;
			&lt;scope&gt;runtime&lt;/scope&gt;
		&lt;/dependency&gt;
		
		&lt;dependency&gt;
			&lt;groupId&gt;org.slf4j&lt;/groupId&gt;
			&lt;artifactId&gt;slf4j-api&lt;/artifactId&gt;
			&lt;scope&gt;runtime&lt;/scope&gt;
		&lt;/dependency&gt;
	&lt;/dependencies&gt;
	...
							</pre>
</div>
</div>
<p>
<br class="figure-break">

					
</p>
</li>
</ul>
</div>
<p>

			
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>
					IIOP から EJB を公開し、JBoss EAP 6 で呼び出す方法は以下サイトにナレッジがある
				</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>https://access.redhat.com/site/ja/solutions/428213</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.9."></a>
<h3 class="title">1.9.APサーバ固有機能の移行</h3>
<br>
<br>
<a name="tubame_1.9.1."></a>
<h3 class="title">1.9.1.WebLogicの起動・停止クラス</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogic9よりWebLogicの起動・停止クラスであるT3StartupDef、T3ShutdownDefクラスは非推奨になり、ApplicationLifecycleListenerが推奨となっている。このリスナクラスの作成は、このApplicationLifecycleListenerを継承する方法とweblogic-application.xml
			デプロイメント記述子で宣言された場合は、継承は必要なく、POJOクラスからWebLogicのライフサイクルイベントにアタッチが可能となっている


		</p>
<p>
			WebLogic9非推奨クラス
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>weblogic.common.T3StartupDef</p>
</li>
<li class="listitem">
<p>weblogic.common.T3ShutdownDef</p>
</li>
</ul>
</div>
<p>
			推奨クラス
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>weblogic.application.ApplicationLifecycleListener</p>
</li>
</ul>
</div>
<p>
		
</p>
<div class="figure">
<a name="N158B3"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;ApplicationLifecycleListener実装例
			</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
				
import weblogic.application.ApplicationLifecycleListener;
 import weblogic.application.ApplicationLifecycleEvent;
 public class MyListener extends ApplicationLifecycleListener {
   public void preStart(ApplicationLifecycleEvent evt) {
      System.out.println
      ("MyListener(preStart) -- we should always see you..");
    } // preStart
   public void postStart(ApplicationLifecycleEvent evt) {
      System.out.println
      ("MyListener(postStart) -- we should always see you..");
    } // postStart
   public void preStop(ApplicationLifecycleEvent evt) {
      System.out.println
      ("MyListener(preStop) -- we should always see you..");
    } // preStop
   public void postStop(ApplicationLifecycleEvent evt) {
      System.out.println
      ("MyListener(postStart) -- we should always see you..");
    } // postStop
    public static void main (String[] args) {
      System.out.println
      ("MyListener(main): in main .. we should never see you..");
    } // main
 }

			</pre>
</div>
</div>
<br class="figure-break">
<p>
			JBossへ移行する場合、JAVAEE APIとして以下の代替手段があげられる
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>
						ServletContextListenerを利用してリスナークラスを設定し、Webアプリケーションの起動・停止時に登録されたリスナクラスが呼ばれる
						</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>ServletContextListenerを実装したリスナークラスの作成</p>
<div class="figure">
<a name="N158C7"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;ApplicationLifecycleListener実装例
									</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
										
package sample;
 
import javax.servlet.ServletContextListener;
import javax.servlet.ServletContextEvent;
import javax.servlet.ServletContext;
 
public class SampleAppListener implements ServletContextListener {
private ServletContext context = null;
 
public void contextInitialized(ServletContextEvent event) {
context = event.getServletContext();
System.out.println("Webアプリケーション起動時に呼び出し");
}
 
public void contextDestroyed(ServletContextEvent event) {
context = event.getServletContext();
System.out.println("Webアプリケーション停止時に呼び出し");
}
}

									</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>ServletContextListenerのweb.xmlへの登録</p>
<div class="figure">
<a name="N158D4"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;ServletContextListenerのweb.xmlへの登録
									</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
										
&lt;web-app&gt;
・・・
&lt;listener&gt;
&lt;listener-class&gt;sample.SampleAppListener&lt;/listener-class&gt;
&lt;/listener&gt;
  ・・・
&lt;/web-app&gt;

									</pre>
</div>
</div>
<br class="figure-break">
</li>
</ol>
</div>
<p>
					
</p>
</li>
<li class="listitem">
<p>JavaEE6より実装可能となったシングルトンBeanにStartupアノテーションを付与し、アプリケーション起動、停止時にPostConstructPreDestroyアノテーションメドッドが呼び出せれる。
					</p>
<div class="figure">
<a name="N158E2"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;シングルトンBean実装例
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
@Singleton
@Startup
public class HelloSingleton {

	private static Logger logger = Logger.getLogger(HelloSingleton.class);

	@PostConstruct
	protected void startup() {
		logger.info("HelloSingleton will be initialized!");
	}


	@PreDestroy
	protected void destroy() {
		logger.info("HelloSingleton will be removed!");
	}

}

						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.9.2."></a>
<h3 class="title">1.9.2.WebLogic独自のJMXを使用した実装</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogic上のMBeanアクセスするためにヘルパー API(weblogic.management.Helper API)より、WebLogic上のMBeanにアクセスが可能になっている。
また、weblogic.management.MBeanHomeのJMX アクセスのためのインタフェースは、非推奨になっており、javax.management.MBeanServerConnectionの利用が推奨されている。</p>
<p>WebLogic提供のMBeanを扱うようなプログラミングを行っている場合、JBossではJMXのAPIを利用するように移植する必要がある。
 </p>
<div class="figure">
<a name="N158FB"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;JMX実装例
			</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
				
import javax.management.MBeanServerConnection;
import javax.management.ObjectName;
import javax.management.openmbean.CompositeData;
import javax.management.remote.JMXConnector;
import javax.management.remote.JMXConnectorFactory;
import javax.management.remote.JMXServiceURL;

public class JmxUtil {
	
	public enum JMXPROPS {

	
		EAP6("eap600","service:jmx:remoting-jmx://localhost:9900","jboss.as:management-root=server", "productVersion");

		private final String value;
		private String jmxServerUrl;
		private String serverObjectName;
		private String versionAttribute;

		JMXPROPS(String value, String jmxServerUrl, String serverObjectName,
				String versionAttribute) {
			this.value = value;
			this.jmxServerUrl = jmxServerUrl;
			this.serverObjectName = serverObjectName;
			this.versionAttribute = versionAttribute;
		}

		public String getValue() {
			return value;
		}

		public String getJmxServerUrl() {
			return jmxServerUrl;
		}

		public String getServerObjectName() {
			return serverObjectName;
		}

		public String getVersionAttribute() {
			return versionAttribute;
		}

		public String toString() {
			return value;
		}

	}
	

	private static void invoke(JMXPROPS jmxProps) throws Exception {
		JMXServiceURL address = new JMXServiceURL(jmxProps.getJmxServerUrl());

		JMXConnector connector = JMXConnectorFactory.connect(address, null);
		MBeanServerConnection connection = connector.getMBeanServerConnection();


		String verison = (String) connection
				.getAttribute(new ObjectName(jmxProps.getServerObjectName()),
						jmxProps.getVersionAttribute());
		System.out.println("jboss version:" + verison);

		ObjectName memoryMXBean = new ObjectName("java.lang:type=Memory");
		connection.invoke(memoryMXBean, "gc", null, null);
		System.out.println("Garbage Collection Done Successfully");
		System.out.println("Sleep 5 seconds...");
		Thread.sleep(5000);

		CompositeData compositeData = (CompositeData) connection.getAttribute(
				memoryMXBean, "HeapMemoryUsage");
		Long max = (Long) compositeData.get("max");
		System.out.println("mem usage, max=" + max);
		Long used = (Long) compositeData.get("used");
		System.out.println("mem usage, used=" + used);
		connector.close();

	}
	
	public static void main(String[] args) throws Exception {
        invoke(JMXPROPS.EAP6);

	}

}

			</pre>
</div>
</div>
<p>
<br class="figure-break">

</p>
</div>
<br>
<br>
<a name="tubame_1.9.3."></a>
<h3 class="title">1.9.3.WebLogic Time APIを使用した実装</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogic9では、BEA Systems と IBM が共同作成した仕様でTimer and Work Manager API
			とよばれるものがあり、このAPIの一部にTimer API(commonj.timer.*が含まれる)。
			</p>
<div class="figure">
<a name="N15912"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogic9のタイマー実装(commonj.timer.TimerManager,commonj.timer.TimerListener)
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
import commonj.timers.*;

...

public void exampleTimer(){



	TimerManager timerManager = (TimerManager)ic.lookup
	        ("java:comp/env/tm/default");

	//10秒間隔で処理を行う
	timerManager.schedule(new ExampleTimerListener(), 0, 10*1000);


 }

private static class ExampleTimerListener implements TimerListener {
    public void timerExpired(Timer timer) {
      System.out.println("timer expired called on " + timer);
      ...
      //timer.cancel();
    }
}

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>
			JBossへ移行する場合、JAVAEE6標準のEJBのTimerAPIを利用する。EJBのTimerではScheduleアノテーションに設定された情報からコンテナがデプロイ時にタイマを自動的に作成する機能と、
			TimerAPIより任意のタイミングでタイマーを作成する機能がある。
			</p>
<div class="figure">
<a name="N1591F"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;Scheduleアノテーションを利用し、アプリケーション起動後、10秒間隔で処理を行うスケジュール実装
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
@Singleton
@Startup
public class HelloSingleton {

	private static Logger logger = Logger.getLogger(HelloSingleton.class);

    @PostConstruct
	protected void startup() {
		logger.info("HelloSingleton will be initialized!");
	}

	@Schedule(second="0,10,20,30,40,50",minute="*",hour="*")
	public void mySchedule(){
		logger.info("mySchedule called!");
	}
	
	@PreDestroy
	protected void destroy() {
		logger.info("HelloSingleton will be removed!");
	}
}

				</pre>
</div>
</div>
<p>
<br class="figure-break">

			
</p>
<div class="figure">
<a name="N1592A"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;任意のタイミングでタイマーを生成する実装(javax.ejb.TimerServiceのAPIを利用して、タイマーを登録する。サンプルでは、アプリケーション起動後、1時間後にTimeoutアノテーションが設定されたメソッドが起動される。)
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
import javax.ejb.Timeout;
import javax.ejb.Timer;
import javax.ejb.TimerConfig;
import javax.ejb.TimerService;

@Singleton
@Startup
public class HelloSingleton {
	
	private static Logger logger = Logger.getLogger(HelloSingleton.class);
	
	@Resource
    TimerService timerService;
	
	@PostConstruct
	protected void startup() {
		logger.info("HelloSingleton will be initialized!");
		
		Calendar calendar = Calendar.getInstance();
		calendar.add(Calendar.HOUR,1);
		Date time = calendar.getTime();
		timerService.createSingleActionTimer(time,new TimerConfig("test",true));
	}
	
	
	
	@PreDestroy
	protected void destroy() {
		logger.info("HelloSingleton will be removed!");
	}
	
	 @Timeout
	 public void timeout(Timer timer) {
		    logger.info("timer executed");
		    String test = (String) timer.getInfo();
		    ...
		    
	    }

}

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_1.9.4."></a>
<h3 class="title">1.9.4.WebLogic独自のXercesを使用した実装</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicにはWebLogic独自の「Xerces」(weblogic.apache.xerces.*)
			が存在する。この機能はWebLogic9で非推奨になっており、JDKに含まれるパーサを利用することが推奨されている。
		</p>
<p>
			Weblogcのxercesパッケージ名をアプリケーションが直接利用している場合は、以下のようにパッケージを変更する必要がある。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBossに含まれるxercesを利用する場合は、weblogic.apache.xerces.*から(org.apache.xerces.*)に変更する。
					</p>
</li>
<li class="listitem">
<p>JDKの実装を利用する際は、weblogic.apache.xerces.*からcom.sun.org.apache.xerces.*	に変更する。
					</p>
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.9.5."></a>
<h3 class="title">1.9.5.WebLogic独自のXMLBeansを使用した実装</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>XMLBean 実装は内部 BEA ライブラリ (com.bea.xml) から Apache オープン ソース
			プロジェクト (org.apache.xmlbeans) に移動されている。
			JBossでは、このライブラリは同梱されていないため
			、コミュニティよりダウンロードして利用する際は、JBoss EAPのサブクリプションの範囲ではサポートされない。
		</p>
<p>
			org.apache.xmlbeansを利用した移植例(参考)
			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>http://xmlbeans.apache.org/よりXMLBeansをダウンロードし、JBossのクラスパスに設定する。
					</p>
</li>
<li class="listitem">
<p>アプリケーションのソースコードを検索し、パッケージ名com.bea.xmlのXMLBeansを使っている箇所をorg.apache.xmlbeans
						に変更する</p>
</li>
<li class="listitem">
<p>
						XMLBeanスキーマを再コンパイルして、スキーマメタデータファイル(.xsb) と生成されているコードを更新する

						</p>
<div class="figure">
<a name="N15963"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;スキーマメタデータファイル生成の実行例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
scomp -out aaaBean.jar ./aaa.xsd

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
</ol>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_1.9.6."></a>
<h3 class="title">1.9.6.WebLogic独自のEnviromentクラスを使用した実装</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			weblogic.jndi.Environmentは、InitialContextを作成するためのプロパティを内部的に保持するための、WebLogic独自クラスである。
			</p>
<div class="figure">
<a name="N1597B"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic.jndi.Environment利用例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
Environment env = new Environment();
env.setProviderUrl("t3://weblogicServer:7001");
env.setSecurityPrincipal("fred");
env.setSecurityCredentials("seafood");
Context ctx = env.getInitialContext();

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>
			JBossでは、JAVAEE標準のjavax.naming.*を利用する。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>
						コンテナ内からの呼び出しであれば、プロパティの設定は必要ない。
						</p>
<div class="figure">
<a name="N1598C"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;InitialContext利用例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
InitialContext initialContext = new InitialContext();

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
<li class="listitem">
<p>ejbクライアントなどのコンテナ外からの呼び出しでは、InitialContextを作成するためのプロパティを設定する必要がある。
						InitialContextを作成するためのプロパティ設定については以下の２つの方法が存在する
					</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>
								InitialContextのコンストラクタに明示的にプロパティを設定するする方法
								</p>
<div class="figure">
<a name="N1599E"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;InitialContext利用例</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
										
props = new Properties();
props.put(InitialContext.INITIAL_CONTEXT_FACTORY,"org.jboss.naming.remote.client.InitialContextFactory");
props.put(InitialContext.PROVIDER_URL, "remote://localhost:4447");
props.put(InitialContext.URL_PKG_PREFIXES, "org.jboss.ejb.client.naming");
props.put(InitialContext.SECURITY_PRINCIPAL, "username");
props.put(InitialContext.SECURITY_CREDENTIALS, "userpass");
InitialContext initialContext = new InitialContext(props)

									</pre>
</div>
</div>
<p>
<br class="figure-break">

							
</p>
</li>
<li class="listitem">
<p>必要なプロパティをjndi.propertiesに設定し、クラスパス上に配置して、InitialContextのコンストラクタには、プロパティを設定しない方法
							
							</p>
<div class="figure">
<a name="N159AC"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;jndi.properties</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
										
java.naming.factory.initial=org.jboss.naming.remote.client.InitialContextFactory
java.naming.provider.url=remote://localhost:4447
java.naming.factory.url.pkgs=org.jboss.ejb.client.naming
java.naming.security.principal=username
java.naming.security.credentials=userpass

									</pre>
</div>
</div>
<p>
<br class="figure-break">
							
</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_1.9.7."></a>
<h3 class="title">1.9.7.WebLogic独自のweblogic.utils.wrapper.Wrapperクラスを使用した実装</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>weblogic.utils.wrapper.WrapperはWebLogic独自のラッパーインタフェースであり、PreparedStatement#toString()をラッパーし、ステートメントの文字列（SQL文）をログに出力している
WebLogicのWrapperクラスと同じ機能はJBossではない。RDBMSのトレースログにより代換する。なお、JPAを利用する場合は、 persistence.xmlのshowSqlプロパティをtrueに設定して、SQL文をログに出力するようなことは可能である。</p>
</div>
<br>
<br>
<a name="tubame_1.9.8."></a>
<h3 class="title">1.9.8.WebLogic独自のロギイング実装</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicでは、ロギングで以下のクラスが利用可能である
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>weblogic.commmon.LogServicesDef(非推奨)</p>
</li>
<li class="listitem">
<p>weblogic.logging.NonCatalogLogger</p>
</li>
<li class="listitem">
<p>weblogic.logging.log4j.Log4jLoggingHelper</p>
</li>
<li class="listitem">
<p>commons-logging</p>
</li>
</ul>
</div>
<p>
		
</p>
<p>
			JBossに移植する場合、weblogicパッケージを利用している場合は、jboss.loggingを利用するように修正する。commons-loggingやlog4jについても、JBossのモジュールとして組み込まれているため、
			JBossでも利用できる。

			</p>
<div class="figure">
<a name="N159E0"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;jboss.logging利用例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
import javax.inject.Inject;

import org.jboss.logging.Logger;

...
public class HelloService {


	private static Logger logger = Logger.getLogger(HelloService.class);

	@Inject
	HelloSession helloSession;

	String createHelloMessage(String name) throws Exception {
		logger.debug("debug");
		return helloSession.say(name);
	}

}

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>jboss.logging、commons-loggingやlog4jを利用する場合は、アーカイブ内にライブラリを配置する必要はありません。またlog4jをアーカイブ内に含み、かつConsoleAppenderを通してコンソールにログを出力させた場合、
					ログが二重にフォーマットされた形で出力される事象を確認しているので、ご注意ください。
				</p>
</td>
</tr>
</table>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.9.9."></a>
<h3 class="title">1.9.9.WebLogic独自のサーバセッションプール機能を利用したJMSコンシューマの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではWebLogic独自のサーバセッションプール機能を利用して、メッセージサービス(JMS)を利用することができた。しかし、このサーバセッションプールを用いたメッセージサービスは、J2EE
			仕様の必須の部分ではなく、またJTA ユーザ トランザクションもサポートしていない。WebLogic9では非推奨になっている。
			JBossへ移行するにはメッセージ駆動型 Bean (MDB)に移植する必要がある。メッセージ駆動型 Bean
			(MDB)を導入することにより、コンテナによるJTAユーザトランザクションをサポートとすることも可能である。


			</p>
<div class="figure">
<a name="N159FB"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic.jms.ServerSessionPoolの利用例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
import weblogic.jms.ServerSessionPoolFactory;
 
public class PoolReceive
  implements T3StartupDef
{
   ～
  /**
   * コンシューマを作成します。
   * @param name 名前
   * @param args ハッシュテーブル
   * @exception Exception 問題が発生した場合
   */
  public String startup(String name, Hashtable args)
      throws Exception
  {
    String connectionFactory = (String)args.get("connectionFactory");
    String topicName = (String)args.get("topic");
 
    if (connectionFactory == null || topicName == null) {
        throw new IllegalArgumentException("connectionFactory="
+connectionFactory+", topicName="+topicName);
    }
 
    Context ctx = new InitialContext();
    tconFactory = (TopicConnectionFactory) ctx.lookup(connectionFactory);
    tcon = tconFactory.createTopicConnection();
    tsession = tcon.createTopicSession(false, Session.AUTO_ACKNOWLEDGE);
    topic = (Topic) ctx.lookup(topicName);
    tcon.start();
    sessionPoolFactory = (ServerSessionPoolFactory)
      ctx.lookup(SESSION_POOL_FACTORY);
    sessionPool = sessionPoolFactory.
        getServerSessionPool(tcon, 5, false,Session.AUTO_ACKNOWLEDGE,
            ★"examples.jms.startup.MsgListener");
    consumer = tcon.createConnectionConsumer(topic, "TRUE", sessionPool, 10);
 
    return "Ready To Receive Messages";
  }

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>
			本例では、JMSコンシューマに該当するexamples.jms.startup.MsgListenerクラスをメッセージ駆動型
			Bean(MDB)に移植する方法を示す
			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>MsgListener実装クラスをメッセージ駆動型 Bean(MDB)に移植する</p>
<div class="figure">
<a name="N15A0C"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;WebLogicのプログラムコードの例
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
public class MsgListener implements MessageListener {
・・・
/**
   * @see MessageListener#onMessage(Message)
   */
  public void onMessage(Message message) {
　  ・・・
  }
}

						</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N15A16"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;JBossのプログラムコードの例
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
// MessageDrivenBeanインタフェース追加
public class MsgListener implements MessageListener, MessageDrivenBean {
・・・
  //メソッド追加
/**
   * @see MessageDrivenBean#setMessageDrivenContext(MessageDrivenContext)
   */
  public void setMessageDrivenContext(MessageDrivenContext arg0) {
　  ・・・
  }
 
//メソッド追加
/**
   * @see MessageDrivenBean#ejbRemove()
   */
  public void ejbRemove() {
　  ・・・
  }
  
/**
   * @see MessageListener#onMessage(Message)
   */
  public void onMessage(Message message) {
　  ・・・
  }
}

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>EJB用のXMLデプロイメント・ディスクリプタの作成</p>
<p>
						メッセージ駆動型 Bean(MDB)はEJBになりますので、EJB用のXMLデプロイメント・ディスクリプタであるejb-jar.xmlファイル及びjboss-ejb3.xmlファイルを作成する。各XMLデプロイメント・ディスクリプタの例を以下に示す。
						</p>
<div class="figure">
<a name="N15A25"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;ejb-jar.xmlの例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;ejb-jar
xmlns=http://java.sun.com/xml/ns/j2ee
xmlns:xsi=http://www.w3.org/2001/XMLSchema-instance
xsi:schemaLocation="http://java.sun.com/xml/ns/j2ee
http://java.sun.com/xml/ns/j2ee/ejb-jar_2_1.xsd"
version="2.1"&gt;
  &lt;enterprise-beans&gt;
    &lt;message-driven&gt;
      &lt;ejb-name&gt;HelloMDB&lt;/ejb-name&gt;
      &lt;ejb-class&gt;examples.jms.startup.MsgListener&lt;/ejb-class&gt;
      &lt;transaction-type&gt;Container&lt;/transaction-type&gt;
      &lt;activation-config&gt;
          &lt;activation-config-property&gt;
              &lt;activation-config-property-name&gt;destinationType&lt;/activation-config-property-name&gt;
              &lt;activation-config-property-value&gt;javax.jms.Queue&lt;/activation-config-property-value&gt;
          &lt;/activation-config-property&gt;
          &lt;activation-config-property&gt;
              &lt;activation-config-property-name&gt;destination&lt;/activation-config-property-name&gt;
              &lt;activation-config-property-value&gt;java:jboss/queue/exampleQueue&lt;/activation-config-property-value&gt;
          &lt;/activation-config-property&gt;
      &lt;/activation-config&gt;
    &lt;/message-driven&gt;
  &lt;/enterprise-beans&gt;
&lt;/ejb-jar&gt;


							</pre>
</div>
</div>
<p>
<br class="figure-break">
						
</p>
<div class="figure">
<a name="N15A30"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;jboss-ejb3.xmlの例
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
	xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
                     http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"
	version="3.1" impl-version="2.0"&gt;

	&lt;jboss:enterprise-beans&gt;
		&lt;message-driven&gt;
			&lt;ejb-name&gt;HelloMDB&lt;/ejb-name&gt;
		&lt;/message-driven&gt;
	&lt;/jboss:enterprise-beans&gt;
&lt;/jboss:ejb-jar&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
</li>
</ol>
</div>
<p>

		
</p>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_1.9.10."></a>
<h3 class="title">1.9.10.WebLogic独自のJDBC 接続プールを用いたデータベース接続の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではweblogic.jdbc.pool.Driverパッケージを利用して、コネクションプールを利用できる。このAPIはWebLogic9で非推奨になっており、DataSourceを利用することが推奨されている。

			</p>
<div class="figure">
<a name="N15A4A"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogicのJDBC接続プールを利用したデータベース接続例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
Driver myDriver = (Driver)
Class.forName("weblogic.jdbc.pool.Driver").newInstance();
...
Properties props = new Properties();
props.put("connectionPoolID", "myConnectionPool");
Connection conn =
myDriver.connect("jdbc:weblogic:pool", props);

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>
			JBossでは以下のように、DataSource オブジェクトを用いたデータベースへの接続を取得する
			</p>
<div class="figure">
<a name="N15A57"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;JBossのDataSource オブジェクトを用いたデータベース接続例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
InitialContext ic = new InitialContext();
DataSource ds = (DataSource)ic.lookup("java:jboss/datasources/ExampleDS");
Connection con = ds.getConnection();

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>JBossのデータソースのJNDI名は、「java:jboss/任意の値」で設定可能である。JNDI名は、デプロイメントディスクリプタ定義（jboss-ejb3.xmlやweb.xmlで）のリソースリファレンス設定を行うことで、カスタム可能である。
				</p>
<div class="figure">
<a name="N15A65"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;EJBのリソースリファレンス設定(jboss-ejb3.xml）
					</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
&lt;?xml version="1.0"?&gt;
&lt;jboss:ejb-jar xmlns:jboss="http://www.jboss.com/xml/ns/javaee"
 xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
 xsi:schemaLocation="http://www.jboss.com/xml/ns/javaee http://www.jboss.org/j2ee/schema/jboss-ejb3-2_0.xsd
 http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/ejb-jar_3_1.xsd"
 version="3.1" impl-version="2.0"&gt;
  &lt;enterprise-beans&gt;
    &lt;session&gt;
	  &lt;ejb-name&gt;receiveInTx&lt;/ejb-name&gt;
	  &lt;resource-ref&gt;
		&lt;res-ref-name&gt;demoXADataSource&lt;/res-ref-name&gt;
		&lt;jndi-name&gt;java:jboss/datasources/examples-dataSource-demoXAPool&lt;/jndi-name&gt;
	  &lt;/resource-ref&gt;
	&lt;/session&gt;
  &lt;/enterprise-beans&gt;
&lt;/jboss:ejb-jar&gt;

					</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N15A6F"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;JNDIルックアップ例
					</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
...
Context ic    = new InitialContext();
Context env = (Context) ic.lookup("java:comp/env");
DataSource xads = (DataSource) env.lookup("demoXADataSource");
...

					</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N15A79"></a>
<p class="title">
<b>Figure&nbsp;5.&nbsp;WEBのリソースリファレンス設定(web.xml）
					</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
&lt;web-app xmlns:j2ee="http://java.sun.com/xml/ns/j2ee"&gt;
     &lt;resource-ref&gt;
		&lt;res-ref-name&gt;jdbc/ExampleDS&lt;/res-ref-name&gt;
		&lt;res-type&gt;javax.sql.DataSource&lt;/res-type&gt;
		&lt;res-auth&gt;Container&lt;/res-auth&gt;
		&lt;lookup-name&gt;java:jboss/datasources/ExampleDS&lt;/lookup-name&gt;
	&lt;/resource-ref&gt;                                
&lt;/web-app&gt;

					</pre>
</div>
</div>
<br class="figure-break">
<div class="figure">
<a name="N15A83"></a>
<p class="title">
<b>Figure&nbsp;6.&nbsp;JNDIルックアップ例
					</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
SampleFoo sample = null;
Connection connection = null;
try {
	Context ic = new InitialContext();
	Context env = (Context) ic.lookup("java:comp/env");		
	DataSource lookup = (DataSource) env.lookup("jdbc/ExampleDS");
...

					</pre>
</div>
</div>
<br class="figure-break">
</td>
</tr>
</table>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_1.9.11."></a>
<h3 class="title">1.9.11.WebLogic Workshopについて</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicでは開発環境であるWebLogic WorkShopを利用したアプリケーション開発ができる。 WebLogic
			WorkShopを利用した場合、WebLogicが提供する独自機能（WebLogic独自のMVCフレームワーク等）を利用することになり、WebLogicの依存性は非常に高く、JBossへ移植するにはJBossに合わせた再開発になる。
			

			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>WebLogic Javaページフロー</p>
<p>WebLogic Workshopでは、Strutsを拡張したJavaページフローと呼ばれるMVCフレームワークがある。Javaページフローは拡張子が「.jpf」となるファイルで、Workshopのデザインビューよりページフローを定義でき、JSPとアクションをつなぎ合わせるだけで、Strutsのアクションコンフィグレーション(jsf-struts-config.xml)・アクションクラス・アクションフォームBeanを作成する機能である。</p>
</li>
<li class="listitem">
<p>WebLogic 組み込みコントロール</p>
<p>WebLogicバックエンドコンポーネントであるEJB、Webサービス、DAOをコーディングせずに生成できる EJB、Webサービス、DAOの組み込みコントロールがある。組み込みコントロールは拡張子が「.jcx」となるファイルで定義されている。EJBの場合はEJBを実装する上で必要な枠組みを自動で実装する（EJBのHomeクラスやBeanインタフェースの作成）。</p>
</li>
<li class="listitem">
<p>WebLogicカスタムJavaコントロール</p>
<p>作成した複数の組み込みコントロールを利用することができ、かつビジネスロジックのクラスを生成し、ロジックを実装することができる(EJBの場合、ユーザに公開するメソッドを設定し、Bean実装クラスの作成が可能になる）。カスタムJavaコントロールは拡張子が「.jcs」となるファイルで定義されている。</p>
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.9.12."></a>
<h3 class="title">1.9.12.WebLogic独自のweblogic.jms.extensions.WLSessionの実装</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicのweblogic.jms.extensions.WLSessionはjavax.jms.Sessionを実装し、拡張したクラスで、標準のJMSのAPIでは提供しない機能を提供している。このWLSession#setExceptionListenerを利用して、例外発生時の処理をリスナーとして登録できる。

			</p>
<div class="figure">
<a name="N15AB7"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogicのweblogic.jms.extensions.WLSessionを利用したプログラムコードの例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
qcon = qcf.createQueueConnection();
qsession = qcon.createQueueSession(false, Session.AUTO_ACKNOWLEDGE);
//weblogic.jms.extensions.WLSessionを利用している
if (qsession instanceof WLSession) {
	WLSession session = (WLSession)qsession
    session.setExceptionListener(new ExceptionListener() {

        public void onException(JMSException e) {
            //例外時の処理を記載
            ...
        }

    });
}


				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>
			JBossEAPの場合、javax.jms.Sessionの実装したクラスにsetExceptionListenerメソッドはないため、javax.jms.Connection#setExecptionListenerで代替可能である。以下にjavax.jms.Connection#setExecptionListenerを利用した例を示す。

			</p>
<div class="figure">
<a name="N15AC4"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;JMS標準のjavax.jms.Connection#setExecptionListenerを利用したプログラムコードの例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
qcon = qcf.createQueueConnection();
// javax.jms.Connection#setExecptionListenerを利用.
qcon.setExceptionListener(new ExceptionListener() {
    public void onException(JMSException e) {
         //例外時の処理を記載
         ...
        }
     });
  }
qsession = qcon.createQueueSession(false, Session.AUTO_ACKNOWLEDGE);

				</pre>
</div>
</div>
<p>
<br class="figure-break">

		
</p>
</div>
<br>
<br>
<a name="tubame_1.9.13."></a>
<h3 class="title">1.9.13.WebLogic独自weblogic.utilsの実装</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogic独自weblogic.utilsとして以下のクラスが存在する。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>weblogic.utils.FileUtils</p>
<p>WebLogicのweblogic.utils.FileUtilsはファイル関連の操作を行うユーティリティクラスが存在する。
						JBossEAPの場合、ApacheのCommons
						IOにファイル関連の操作を行うユーティリティクラスorg.apache.commons.io.FileUtilsが存在する。JBossEAPでは、モジュールとしてCommons
						IO(commons-io-xxx-jar)が組み込まれているため、これらのAPIを利用してプログラムコードを適宜置き換える
					</p>
</li>
<li class="listitem">
<p>weblogic.utils.ArrayUtils</p>
<p>WebLogicのweblogic.utils.ArrayUtilsはコレクションに要素の追加や削除等を行うユーティリティクラスが存在する。JBossEAPの場合、ApacheのCommons
						Langは、コレクション関連の操作を行うユーティリティクラスorg.apache.commons.lang.ArrayUtilsが存在する。JBossEAPでは、モジュールとしてCommons
						Lang(commons-lang-xxx.jar)が組み込まれているため、これらのAPIを利用してプログラムコードを適宜置き換える
					</p>
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.10."></a>
<h3 class="title">1.10.アプリケーションロギング</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>移行元のアプリケーションでweblogic.loggingパッケージを利用した場合は、JBossのログイング実装を利用するように移植する必要があるが、ログ出力でLog4j、commons-loggingライブラリを利用しているアプリケーションを移行する場合、JBoss EAPでもこれらのフレームワークを利用したロギングが利用可能である。以下にLog4jの設定について示す</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>基本的に、JBossEAPに含まれるライブラリの利用が前提になる。コミュニティよりダウンロードしたものはサポート対象外となるので、注意すること。</p>
</td>
</tr>
</table>
</div>
</div>
<br>
<br>
<a name="tubame_1.10.1."></a>
<h3 class="title">1.10.1.Log4jの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			Log4j設定としては、以下の2つが存在する。
			</p>
<div class="orderedlist">
<ol class="orderedlist" type="1">
<li class="listitem">
<p>Log4jの設定をアプリケーション内で完結させる方法</p>
</li>
<li class="listitem">
<p>Log4jの設定をJBossのログ出力設定にマージする方法</p>
</li>
</ol>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_1.10.1.1."></a>
<h3 class="title">1.10.1.1.Log4jの設定をアプリケーション内で完結させる方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			jboss-deployment-structure.xmｌを利用し,
			暗黙的依存性の解除設定(org.apache.log4j）を行い、アプリケーションサーバが提供するモジュールlog4jと干渉しないようにする

			</p>
<div class="figure">
<a name="N16412"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;サンプルEAR構成
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
hoge-ear.ear
     |-- hoge-web.war
     |-- hoge-ejb.jar
     |-- lib
         |-- util.jar
         |-- log4.j.jar
      |--logging/log4j.xml
     |-- META-INF
         |-- application.xml
         |-- jboss-deployment-structure.xml
         

				</pre>
</div>
</div>
<p>
<br class="figure-break">

			上記の構成の場合は、jboss-deployment-structure.xmlにwar及びejbのサブデプロイメントが参照しているlog4jの暗黙的依存性の解除設定を行い、
			earデプロイメント内のlog4jをモジュールとして定義して、依存性を明示的に設定する必要がある。
			
			
			</p>
<div class="figure">
<a name="N1641D"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jboss-deployment-structure.xml設定例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;jboss-deployment-structure xmlns="urn:jboss:deployment-structure:1.0"&gt;
    &lt;deployment&gt;
        &lt;!-- log4j 除外設定--&gt;
		&lt;exclusions&gt;
			&lt;module name="org.apache.log4j" /&gt;
		&lt;/exclusions&gt;
	&lt;/deployment&gt;

	&lt;module name="deployment.hoge-ear.ear.util"&gt;
		&lt;resources&gt;
			&lt;resource-root path="libs/util.jar"/&gt;
		&lt;/resources&gt;
	&lt;/module&gt;

	&lt;!--  ear/libsにあるlog4jをモジュールとして定義 --&gt;
	&lt;module name="deployment.hoge-ear.ear.log4j"&gt;
		&lt;resources&gt;
			&lt;resource-root path="libs/log4j-1.2.16.jar"/&gt;
			&lt;resource-root path="logging"/&gt;
		&lt;/resources&gt;
	&lt;/module&gt;

	&lt;sub-deployment name="hoge-web.war"&gt;
        &lt;exclusions&gt;
			&lt;module name="org.apache.log4j" /&gt;
		&lt;/exclusions&gt;
		&lt;dependencies&gt;
			&lt;module
				name="deployment.hoge-ear.ear.util" /&gt;
			&lt;!-- warが参照するlog4jの依存性設定--&gt;
			&lt;module
			　　name="deployment.hoge-ear.ear.log4j" /&gt;
		&lt;/dependencies&gt;
	&lt;/sub-deployment&gt;

	&lt;sub-deployment name="hoge-ejb.jar"&gt;
	    &lt;!-- log4j 除外設定--&gt;
		&lt;exclusions&gt;
			&lt;module name="org.apache.log4j" /&gt;
		&lt;/exclusions&gt;
		&lt;dependencies&gt;
		    &lt;!-- ejbが参照するlog4jの依存性設定--&gt;
			&lt;module name="deployment.hoge-ear.ear.log4j" /&gt;
		&lt;/dependencies&gt;
	&lt;/sub-deployment&gt;

&lt;/jboss-deployment-structure&gt;


				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_1.10.1.2."></a>
<h3 class="title">1.10.1.2.Log4jの設定をJBossのログ出力設定にマージする方法</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			Log4jの設定をJBossのログ出力設定にマージする場合、アプリケーション内にはLog4jのライブラリは同梱せず、アプリケーションサーバlog4jと干渉しないため、jboss-deployment-structure.xmlによるlog4jの暗黙的依存性の解除設定は必要ない。

			</p>
<div class="figure">
<a name="N16434"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;サンプルEAR構成
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
hoge-ear.ear
     |-- hoge-web.war
     |-- hoge-ejb.jar
     |-- lib
         |-- util.jar

     |-- META-INF
         |-- application.xml

        
				</pre>
</div>
</div>
<p>
<br class="figure-break">

			アプリケーション用のlogger設定を制御する際は、管理CLIにより実施する。

			</p>
<div class="figure">
<a name="N1643F"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;管理CLIによりアプリケーション用(jp.co.ntt.ossc.webg.as7.migration)のログレベルTRACEで登録する。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
/subsystem=logging/logger=jp.co.ntt.ossc.webg.as7.migration:add(level=TRACE)

				</pre>
</div>
</div>
<p>
<br class="figure-break">

			
</p>
<div class="figure">
<a name="N1644A"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;管理CLIにlogger設定後のstandalone-full-ha.xmlの抜粋(参考)</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
...
&lt;logger category="jp.co.ntt.ossc.webg.as7.migration"&gt;
  &lt;level name="TRACE"/&gt;
&lt;/logger&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_1.11."></a>
<h3 class="title">1.11.パッケージング</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			すべてのアプリケーションの修正が完了後、パッケージング作業を行う。アプリケーションの構成が移行元の環境と同じ場合は、WebLogicのconfig.xmlのApplication要素に指定されたデプロイメントに対してパッケージングを行う
			</p>
<div class="figure">
<a name="N16461"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;app-deployment&gt;
    &lt;name&gt;sample&lt;/name&gt;
    &lt;target&gt;targetServer&lt;/target&gt;
    &lt;module-type&gt;war&lt;/module-type&gt;
    &lt;source-path&gt;/opt/sample/sample.war&lt;/source-path&gt;
    &lt;security-dd-model&gt;DDOnly&lt;/security-dd-model&gt;
    &lt;staging-mode&gt;nostage&lt;/staging-mode&gt;
&lt;/app-deployment&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">

		
</p>
<p>
			WebLogic固有のデプロイメントディスクリプタについては、JavaEE標準のデプロイメントディスクリプタまたは、JBoss固有のデプロイメントディスクリプタに移植する。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<div class="figure">
<a name="N16470"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;EAR構成
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
  [xxx].ear

|-- META-INF/

|   |-- MANIFEST.MF
|   |-- weblogic-application.xml ★ JavaEE標準のapplication.xmlかJBoss固有のjboss-app.xmlに移植する


						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<div class="figure">
<a name="N1647B"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;WAR構成
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
[xxx].war

|-- META-INF/

|   |-- MANIFEST.MF

|-- WEB-INF/

|   |-- weblogic.xml   ★ JavaEE標準のweb.xml及びJBoss固有のjboss-web.xmlに移植する

|   |-- web.xml

|   |-- classes/

|   |-- lib/


						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<div class="figure">
<a name="N16486"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;EJB構成(JAR)
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
  [xxx].jar(EJB)

|-- META-INF/

|   |-- MANIFEST.MF

|   |-- ejb-jar.xml

|   |-- weblogic-ejb-jar.xml★ JBoss固有のjboss-ejb3.xmlに移植する

						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>


		
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>WebLogic提供のライブラリなどがパッケージングされないよう、注意すること。</p>
</td>
</tr>
</table>
</div>
</div>
<br>
<br>
<a name="tubame_1.12."></a>
<h3 class="title">1.12.Tuxedoクライアントの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicでは、「Oracle
			Tuxedo」と呼ばれる製品と連携するために、コネクター機能を標準で準備し、WebLogicとTuxedoのサービス間の相互運用性を提供している。以下では、JBossEAPから「Oracle
			Tuxedo」へ移植可能な範囲を示し、詳細の移植方法については後述する。
			Tuxedoサーバ接続方法には以下のように4パターンある。
		</p>
<div class="table">
<a name="N1665B"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;Tuxedoサーバへの接続方法
			</b>
</p>
<div class="table-contents">
<table summary="Tuxedoサーバへの接続方法
			" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>パターン</th><th>Tuxedoサーバへの接続方法</th><th>Tuxedoプログラム</th><th>移植可否</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>WTC</td><td>CORBA</td><td>移植可</td>
</tr>
<tr>
<td>2</td><td>WLEC</td><td>CORBA</td><td>移植可</td>
</tr>
<tr>
<td>3</td><td>WTC</td><td>ATMI</td><td>移植不可</td>
</tr>
<tr>
<td>4</td><td>JOLT</td><td>ATMI</td><td>移植不可</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>WebLogicが提供するコネクタ(WTC,WLEC)の機能(トランザクション伝播、セキュリティ伝播、フェイルオーバ、コネクションプール等)は、JBossEAPで利用することができないため、現行のシステムでこれらの機能を利用している場合で、かつ移植後の環境でも同様な機能が必須の場合はJBossに移植できないため、注意が必要である。</p>
</td>
</tr>
</table>
</div>
</div>
<br>
<br>
<a name="tubame_1.12.1."></a>
<h3 class="title">1.12.1.WebLogic既存環境の確認</h3>
<br>
<br>
<a name="tubame_1.12.1.1."></a>
<h3 class="title">1.12.1.1.WTCを利用したTuxedoのCORBAサーバとの接続確認</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WTCを利用している場合は、WebLogicではconfig.xmlにwtc-serverタグ等が設定される。</p>
</div>
<br>
<br>
<a name="tubame_1.12.1.2."></a>
<h3 class="title">1.12.1.2.WLECを利用したTuxedoのCORBAサーバとの接続確認</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WLECを利用している場合は、WebLogicではconfig.xmlに以下のようなwlec-connection-poolタグが設定されている。
        プログラムでは、com.beasys.BootstrapFactory.getClientContextにプール名を指定して、CORBAオブジェクトのリファレンスを取得する。
        </p>
</div>
<br>
<br>
<a name="tubame_1.12.1.3."></a>
<h3 class="title">1.12.1.3.WTCを利用したTuxedoのATMIサービスとの接続確認</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>ATMIのJavaAPIであるJATMIを利用してTuxedoConnectionFactoryからTuxedoConnectionを作成し、TuxedoConnectionでtpcallなどのリクエストをTuxedo ATMIサービスに送信している場合は、WebLogicとTuxedoのATMIサービスとの接続が行なわれる。</p>
</div>
<br>
<br>
<a name="tubame_1.12.1.4."></a>
<h3 class="title">1.12.1.4.JOLTを利用したTuxedoのATMIサービスとの接続確認</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicは、JOLT接続プールを利用してTuxedo のATMI サービスを呼び出す。
以下のようにconfig.xmlにJOLT接続プール（jolt-connection-pool）が設定され、サーブレットなどのアプリケーションからJOLT接続プールが利用されている場合は、WebLogicからJOLTを利用して、TuxedoのATMIサービスと接続している。</p>
</div>
<br>
<br>
<a name="tubame_2."></a>
<h2 class="title">2.サーバ設定の移行</h2>
<br>
<a name="tubame_2.1."></a>
<h3 class="title">2.1.JDBCドライバの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>JBoss
			EAP4ではJDBCドライバは$jboss.home/server/{profile}/lib配下に配置するだけでJBossがロードできたが、JBoss
			EAP6の場合、JDBCドライバをモジュールとして登録するか、
			デプロイメントとして登録する必要がある。JBoss
			EAP6にPostgesSQLのJDBCドライバをモジュールとして登録する方法を示す。
		</p>
<p></p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JDBCドライバモジュール定義ファイル(module.xml)を作成する</p>
<div class="figure">
<a name="N14471"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;PostgresSQLのJDBCドライバ用module.xml</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;module xmlns="urn:jboss:module:1.0" name="org.postgres"&gt;
  &lt;resources&gt;
    &lt;resource-root path="postgresql-9.1-902.jdbc4.jar"/&gt;
  &lt;/resources&gt;
  &lt;dependencies&gt;
    &lt;module name="javax.api"/&gt;
    &lt;module name="javax.transaction.api"/&gt;
  &lt;/dependencies&gt;
&lt;/module&gt;

					</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>JDBCドライバモジュールの登録に必要なファイルを配置する</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>JBossのモジュールディレクトリ配下に$jboss.modules.dir/org/postgresqlフォルダを作成
						</p>
</li>
<li class="listitem">
<p>module.xmlを$jboss.modules.dir/org/postgresql配下にコピー
						</p>
</li>
<li class="listitem">
<p>JDBCドライバ(jdbc4*.jar)を$jboss.modules.dir/org/postgresql配下にコピーする
						</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>管理CLIよりJDBCドライバモジュールの登録を行う</p>
<div class="figure">
<a name="N1448B"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;JBoss EAP6の管理CLIよりJDBCドライバモジュールの登録を行う。ドライバー名は任意で、{driver-name}と表記する。</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
/subsystem=datasources/jdbc-driver=postgres9-driver:add(driver-name=postgres9-driver,driver-module-name=org.postgres)


					</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_2.2."></a>
<h3 class="title">2.2.データソースの移行</h3>
<br>
<br>
<a name="tubame_2.2.1."></a>
<h3 class="title">2.2.1.データソース設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			移行元のデータソース設定情報を確認し、各データソース設定情報を管理CLIより設定する必要がある。
			JBossEAP6では管理CLIのデータソース作成コマンド(data-sourceまたはxa-data-source)を利用するため、WebLogic9のデータソース定義ファイルの属性と管理CLIのデータソース作成コマンドのパラメータの対応表を示す。WebLogic9のデータソース設定は大きく以下の4つに分類できるため、
			以下の4つの分類で対応表を示す。
			なお、Weblogic9よりconfig.xmlで定義されていたデータソース設定は別の設定ファイルに定義されるようになっている。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JDBCドライバーのパラメータ設定(jdbc-driver-params)	</p>
</li>
<li class="listitem">
<p>コネクションプールのパラメータ設定(jdbc-connection-pool-params)</p>
</li>
<li class="listitem">
<p>データソースのパラメータ設定(jdbc-data-source-params)</p>
</li>
<li class="listitem">
<p>XAデータソースのパラメータ設定(jdbc-data-source-params)</p>
</li>
</ul>
</div>
<p>
		
</p>
<p>
			
</p>
<div class="figure">
<a name="N14510"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogic9のデータソース定義ファイル
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;jdbc-data-source xmlns="http://www.bea.com/ns/weblogic/90" xmlns:sec="http://www.bea.com/ns/weblogic/90/security" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:wls="http://www.bea.com/ns/weblogic/90/security/wls" xsi:schemaLocation="http://www.bea.com/ns/weblogic/920 http://www.bea.com/ns/weblogic/920.xsd"&gt;
  &lt;name&gt;ExampleDataSource&lt;/name&gt;
  &lt;jdbc-driver-params&gt;
    &lt;url&gt;jdbc:oracle:thin:@xxx.xxx.xxx.xxx:1521:dbname&lt;/url&gt;
    &lt;driver-name&gt;oracle.jdbc.OracleDriver&lt;/driver-name&gt;
    &lt;properties&gt;
      &lt;property&gt;
        &lt;name&gt;user&lt;/name&gt;
        &lt;value&gt;userid&lt;/value&gt;
      &lt;/property&gt;
    &lt;/properties&gt;
    &lt;password-encrypted&gt;xxx&lt;/password-encrypted&gt;
  &lt;/jdbc-driver-params&gt;
  &lt;jdbc-connection-pool-params&gt;
    &lt;initial-capacity&gt;20&lt;/initial-capacity&gt;
    &lt;max-capacity&gt;256&lt;/max-capacity&gt;
    &lt;connection-creation-retry-frequency-seconds&gt;30&lt;/connection-creation-retry-frequency-seconds&gt;
    &lt;test-connections-on-reserve&gt;true&lt;/test-connections-on-reserve&gt;
    &lt;test-table-name&gt;dual&lt;/test-table-name&gt;
  &lt;/jdbc-connection-pool-params&gt;
  &lt;jdbc-data-source-params&gt;
    &lt;jndi-name&gt;ExampleDataSource&lt;/jndi-name&gt;
    &lt;global-transactions-protocol&gt;OnePhaseCommit&lt;/global-transactions-protocol&gt;
  &lt;/jdbc-data-source-params&gt;
&lt;/jdbc-data-source&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>サンプルとして上記の設定を参考に、以下設定より管理CLIでデータソースを設定する方法を示す</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>
					JDBCドライバーのパラメータを中心とした基本情報のみを利用してデータソースを追加する
					</p>
<div class="table">
<a name="N14521"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;JDBCドライバーのパラメータを中心として基本情報。この例ではPostgresSQLの利用を前提とする
						</b>
</p>
<div class="table-contents">
<table summary="JDBCドライバーのパラメータを中心として基本情報。この例ではPostgresSQLの利用を前提とする
						" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>項目</th><th>説明</th><th>JBossのパラメータ設定</th><th>WebLogicとの対比</th><th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>リソースを一意に識別するためのID</td><td>リソースを一意に識別するために、JBossでデータソースを作成する際に必要となる情報
									</td><td>name</td><td>なし</td>
</tr>
<tr>
<td>2</td><td>ドライバー名</td><td>JBossでは事前にモジュールとして登録したJDBCドライバーのドライバ名を指定する必要があるため、ドライバ名を指定する
									</td><td>driver-name</td><td>なし</td>
</tr>
<tr>
<td>3</td><td>JNDI名</td><td>JNDI名。Bossではjboss/resources/jdbc/データソース名の形式でJNDI名を指定する必要がある
									</td><td>jndi-name</td><td>jndi-name</td>
</tr>
<tr>
<td>4</td><td>データソースの定義クラス名</td><td>データソースの定義クラス名。非XAデータソース作成する際に指定する必要がある。</td><td>driver-class</td><td>driver-name</td>
</tr>
<tr>
<td>4</td><td>javax.sql.XADataSource実装の完全修飾名</td><td>JBossでXAデータソースを作成する際に必要となる</td><td>xa-datasource-class</td><td>driver-name</td>
</tr>
<tr>
<td>5</td><td>url</td><td>DBMSに接続するためのJDBC URL</td><td>connection-url</td><td>url</td>
</tr>
<tr>
<td>6</td><td>user</td><td>DBMSに接続するためのDBユーザ名</td><td>user-name</td><td>user</td>
</tr>
<tr>
<td>7</td><td>password</td><td>DBMSに接続するためのDBユーザのパスワード。設定内容は暗号化されている</td><td>password</td><td>password-encrypted</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
					
</p>
<div class="figure">
<a name="N1458E"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;上記のJDBCドライバーのパラメータを中心とした基本情報を非XAデータソースとして追加する例を示す。
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
data-source add --name=sample-ds --jndi-name=java:jboss/resources/jdbc/SampleDS --driver-name=sample-driver --driver-class=org.postgresql.Driver --connection-url=jdbc:postgresql://localhost:5432/testdb --user-name=postgres --password=postgres

						</pre>
</div>
</div>
<p>
<br class="figure-break">
					
</p>
<div class="figure">
<a name="N14599"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;上記のJDBCドライバーのパラメータを中心とした基本情報XAデータソースとして追加する例を示す。XAデータソースの場合、connection-urlで設定する内容は、xa-datasource-propertiesとして、ServerName、PortNumber、DatabaseName、User、Passwordを設定する。
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
#XAデータソースの作成
xa-data-source add --name=sample-xa-ds --jndi-name=java:jboss/resources/jdbc/SampleXADS --driver-name=sample-driver --xa-datasource-class=org.postgresql.xa.PGXADataSource

#通常のオペレーションでxa-datasource-propertiesにServerName、PortNumber、DatabaseName、User、Passwordを追加する
/subsystem=datasources/xa-data-source=appDS/xa-datasource-properties=ServerName:add(value="localhost")
/subsystem=datasources/xa-data-source=appDS/xa-datasource-properties=PortNumber:add(value="5432")
/subsystem=datasources/xa-data-source=appDS/xa-datasource-properties=DatabaseName:add(value="testdb")
/subsystem=datasources/xa-data-source=appDS/xa-datasource-properties=User:add(value="postgres")
/subsystem=datasources/xa-data-source=appDS/xa-datasource-properties=Password:add(value="postgres")

						</pre>
</div>
</div>
<p>
<br class="figure-break">
				
</p>
</li>
<li class="listitem">
<p>
					コネクションプールのパラメータ設定を管理CLIで設定する
					</p>
<div class="table">
<a name="N145A7"></a>
<p class="title">
<b>Table&nbsp;2.&nbsp;コネクションプールのパラメータ設定の基本情報。この例ではPostgresSQLの利用を前提とする
						</b>
</p>
<div class="table-contents">
<table summary="コネクションプールのパラメータ設定の基本情報。この例ではPostgresSQLの利用を前提とする
						" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>項目</th><th>説明</th><th>JBossのパラメータ設定</th><th>WebLogicとの対比</th><th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>コネクションプールサイズのminサイズ</td><td>&nbsp;</td><td>min-pool-size</td><td>initial-capacity</td>
</tr>
<tr>
<td>2</td><td>コネクションプールサイズのmaxサイズ</td><td>&nbsp;</td><td>max-capacity</td><td>max-pool-size</td>
</tr>
<tr>
<td>3</td><td>コネクション取得時チェック</td><td>接続プールから取得した DB 接続が有効である事を確認。</td><td>check-valid-connection-sql</td><td>test-connections-on-reserve.Trueの際に、コネクションの事前チェックが行われる.JBossではcheck-valid-connection-sqlにSQLコマンドが設定され、validate-on-matchがtrueの際に、コネクションの事前チェックが行われる
									</td>
</tr>
<tr>
<td>4</td><td>未使用のコネクションチェック間隔</td><td>一度作成されたコネクションで、アイドル状態のコネクションをクローズする。
									</td><td>idle-timeout-minutes.確認するタイミングは、idle-timeout-minutesに設定されている半分の時間間隔で行う。
									</td><td>test-frequency-seconds</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
					
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>#3の備考に記載しているvalidate-on-matchについて</p>
<p>JBossEAP6.0.Xではvalidate-on-matheの設定が反映されないバグが存在しており、常にtrueの設定が利用される。https://issues.jboss.org/browse/AS7-6368
						</p>
<p>なお、JBossEAP6.1.X
							では上記のバグは修正されているが、validate-on-matheはデフォルトでfalseが設定されるため、JBossEAP6.1.Xの場合は、明示的に設定を変更する必要がある。
						</p>
</td>
</tr>
</table>
</div>
<p>
					
</p>
<div class="figure">
<a name="N145EE"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;コネクションプールーのパラメータ設定を管理CLIより行う例を示す。
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
data-source --name=sample-ds --min-pool-size=20 --max-pool-size=256 --validate-on-match=true --check-valid-connection-sql="select 1" --idle-timeout-minutes=30

						</pre>
</div>
</div>
<p>
<br class="figure-break">
				
</p>
</li>
<li class="listitem">
<p>
					データソースのパラメータ設定
					</p>
<div class="table">
<a name="N145FC"></a>
<p class="title">
<b>Table&nbsp;3.&nbsp;グローバルトランザクション設定
						</b>
</p>
<div class="table-contents">
<table summary="グローバルトランザクション設定
						" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>No</th><th>項目</th><th>説明</th><th>JBossのパラメータ設定</th><th>WebLogicとの対比</th><th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>グローバルトランザクション設定</td><td>&nbsp;</td><td>複数のリソースをグローバルトランザクションに参加させるためにはxa-data-sourceコマンドによりデータソースを作成する。
									</td><td>global-transactions-protocol</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
					xa-data-sourceコマンドを利用したデータソース作成方法はすでに記載しているため、手順について省略する
				</p>
</li>
</ul>
</div>
</div>
<br>
<br>
<a name="tubame_2.2.1.1."></a>
<h3 class="title">2.2.1.1.JDBCドライバーのパラメータ設定(jdbc-driver-params)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<div class="table">
<a name="N14625"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;JDBCドライバーのパラメータ設定(jdbc-driver-params)で設定可能な属性とdata-source及びxa-data-sourceコマンドで指定するパラメータの対応表
			</b>
</p>
<div class="table-contents">
<table summary="JDBCドライバーのパラメータ設定(jdbc-driver-params)で設定可能な属性とdata-source及びxa-data-sourceコマンドで指定するパラメータの対応表
			" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>データソース定義ファイルの属性値</th><th>属性値説明</th><th>管理CLIのデータソース作成コマンドで指定するパラメータ</th><th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td><td>DBMSに接続するためのJDBC URL</td><td>
							
<p>非XAデータソースの場合は、--connection-urlで設定を行う。</p>
							
<p>XAデータソースの場合は、URLで指定しているサーバ名(ServerName),ポート名(PortNumber),ユーザ名(User),パスワード(Password)をxa-data-sourceコマンドでなく、通常の管理CLIオペレーションで設定する。詳細はpropertiesの備考を参照
							</p>
						
</td><td>&nbsp;</td>
</tr>
<tr>
<td>driver-name</td><td>JDBCのデータソースの定義クラス名</td><td>--driver-name</td><td>&nbsp;</td>
</tr>
<tr>
<td>properties</td><td>JDBC
							ドライバに渡されるプロパティ。propertiesタグ配下にはpropertyタグを指定し、propertyタグにnameタグとvalueタグに設定するキーと値を指定する
						</td><td>&nbsp;</td><td>
							
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>非XAの場合は/subsystem=datasources/data-source=ExampleDS/connection-properties=propertyName:add(value=;propertyValue)
									</p>
</li>
<li class="listitem">
<p>XAの場合は/subsystem=datasources/xa-data-source={リソース名}/xa-datasource-properties=propertyName:add(value="propertyValue")
									</p>
</li>
</ul>
</div>
						
</td>
</tr>
<tr>
<td>password-encrypted</td><td>暗号化されたデータベースパスワード。</td><td>&nbsp;</td><td>「アプリケーションサーバにおけるWebアプリケーション設定」の「DataSource認証モジュール(SecureIdentity)」を参照</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
</div>
<br>
<br>
<a name="tubame_2.2.1.2."></a>
<h3 class="title">2.2.1.2.コネクションプールのパラメータ設定(jdbc-connection-pool-params)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p></p>
<div class="table">
<a name="N1466E"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;コネクションプールのパラメータ設定(jdbc-connection-pool-params)で設定可能な属性とdata-source及びxa-data-sourceコマンドで指定するパラメータの対応表
			</b>
</p>
<div class="table-contents">
<table summary="コネクションプールのパラメータ設定(jdbc-connection-pool-params)で設定可能な属性とdata-source及びxa-data-sourceコマンドで指定するパラメータの対応表
			" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>データソース定義ファイルの属性値</th><th>属性値説明</th><th>xa-data-sourceコマンドで指定するパラメータ</th><th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td>capacity-increment</td><td>接続プール容量の拡張単位となる増加量を返す。サービス要求に提供するための利用可能な物理接続が他にないとき、接続プールはこの数の物理データベース接続を追加作成して、それらを接続プールに追加する。接続プールはMaxCapacity で設定された物理接続の最大数以上にはならない。
						</td><td>該当設定なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>connection-creation-retry-frequency-seconds</td><td>データベースとの接続を確立する試行の秒間隔。0 (デフォルト) に設定すると、接続は再試行されない。
                        						</td><td>allocation-retry-wait-millis</td><td>allocation-retry-wait-millisはデフォルトで5秒である。なおデフォルトではallocation-retryの設定が0になっており、デフォルトでは試行しない。</td>
</tr>
<tr>
<td>connection-reserve-timeout-seconds</td><td>接続プールの接続を予約する呼び出しがタイムアウトになるまでの秒数。0	に設定すると、呼び出しはタイムアウトにならない。-1 に設定すると、呼び出しは直ちにタイムアウトになる</td><td>blocking-timeout-millis</td><td>&nbsp;</td>
</tr>
<tr>
<td>highest-num-waiters</td><td>プールの接続の予約を待っている状態で、同時にブロックできる接続要求の最大数。</td><td>該当設定なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>ignore-in-use-connections-enabled</td><td>接続が使用中であってもプールのシャットダウンを可能にする</td><td>該当設定なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>inactive-connection-timeout-seconds</td><td>予約された接続が強制的に接続プールに戻されるまでの、活動のない状態の秒数。
							0 (デフォルト) に設定した状態では、この機能は無効である。
						</td><td>該当設定なし。</td><td>&nbsp;</td>
</tr>
<tr>
<td>init-sql</td><td>物理的なデータベース接続を開始 (準備) するために実行する SQL 文。InitSQL	が「SQL」で始まる場合、「SQL」より後の文字列は、接続を開始するリテラルの SQL
							文として扱われる。それ以外の場合、InitSQL はテーブルの名前として扱われ、その後に続く SQL文は接続を開始するために使用される。select count(*) from InitSQL"テーブル InitSQL が存在し、接続を使用するデータベース ユーザからアクセスできる必要がある。ほとんどのデータベース
							サーバでは、この SQL を最適化してテーブル スキャンを回避する。それでも、InitSQL を、行が少ない (または、全くない)テーブルの名前に設定することは有益である。
						</td><td>new-connection-sql</td><td>&nbsp;</td>
</tr>
<tr>
<td>initial-capacity</td><td>接続プールの作成時に作成する物理データベース接続の数を返す。</td><td>min-pool-size</td><td>&nbsp;</td>
</tr>
<tr>
<td>login-delay-seconds</td><td>各物理データベース接続を作成するまでにかかる遅延時間 (秒数) を返す。この遅延は、最初にプールが作成されるときにも、プールの生存期間中に物理データベース接続が作成されるときにも発生する。
						</td><td>該当設定なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>max-capacity</td><td>当該接続プールが保有できる物理データベース接続の最大数を返す。JDBC ドライバおよびデータベースサーバによっては、可能な物理的接続の数が制限されている場合もある。</td><td>max-pool-size</td><td>&nbsp;</td>
</tr>
<tr>
<td>remove-infected-connections</td><td>アプリケーションが基底のベンダ接続オブジェクトを要求したときに接続が接続プールから削除されるかどうかを制御する。この属性を有効にすると、接続のプールが本質的に無効になる (接続がプールから削除され、新しい接続で置き換えられる)	のでパフォーマンスに影響がある。
						</td><td>該当設定なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>seconds-to-trust-an-idle-pool-connection</td><td>プールされた接続に限り、その有効性を信頼して接続テストを省略する秒数。接続がテストされたか、または正常に使用されて接続プールに返されたときから、指定された時間が経過するまでの間にアプリケーションから接続が要求される場合、接続をアプリケーションに渡す前の接続テストが省略される
							(TestConnectionsOnReserve が有効な場合)。正常に使用されて接続プールに返された接続については、指定された時間内の自動更新接続テストも省略される (TestFrequency
							Seconds が指定されている場合)。(特に大量のトラフィック発生時の) データベース接続テストによる遅延を最小限に抑えることにより、アプリケーションのパフォーマンスを向上できるチューニング機能。
							ただし、値を高く設定し過ぎると、接続テストの有効性が低くなることがある。適切な値は、使用する環境と接続の切断が発生しやすいかどうかによって決まる。
						</td><td>該当設定なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>shrink-frequency-seconds</td><td>接続プールが需要に見合うよう増加された後、初期のサイズに戻すまでの秒数を返す。接続プールを縮小するには、ShrinkingEnabled がtrueに設定されている必要がある。
						</td><td>該当設定なし。</td><td>&nbsp;</td>
</tr>
<tr>
<td>statement-cache-size</td><td>再利用を目的としてキャッシュに格納された prepared statement および callable	statement の数。WebLogic Serverでは、再ロードせずにキャッシュ内の文を再利用できるため、サーバのパフォーマンスが向上する。Statement キャッシュ サイズを0 に設定すると、キャッシュがオフになる。プール内の各接続には、それ専用の Statement キャッシュがある。						</td><td>prepared-statement-cache-size</td><td>&nbsp;</td>
</tr>
<tr>
<td>statement-cache-type</td><td>Statement キャッシュの管理に使用するアルゴリム (LRU または FIXED) を設定する。
							窶骭&#128; LRU
							statementCacheSize に達した後に新しい文が使用されると、最後に使用された時期が最も古い文がキャッシュから削除される。
							窶骭&#128; Fixed
							最初の statementCacheSize
							の文の数が固定されたままキャッシュに格納される。キャッシュが手作業でクリアされない限り、新しい文はキャッシュされない。
							必須 : いいえ
							デフォルト値 : LRU
						</td><td>該当設定なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>statement-timeout</td><td>現在実行されている文がタイムアウトになるまでの時間を指定する。デフォルト値に設定すると、この機能は無効になる。
							この機能の効果は、基底の JDBC ドライバ サポートに依存する。デフォルト値 : -1
						</td><td>query-timeout</td><td>&nbsp;</td>
</tr>
<tr>
<td>test-connections-on-reserve</td><td>プールされているコネクションをクライアントに渡す前に接続テストを実施するかどうかを設定する</td><td>&nbsp;</td><td>&nbsp;</td>
</tr>
<tr>
<td>test-frequency-seconds</td><td>データベース接続テストの周期の秒数を返す。
							TestFrequencySeconds の間隔が過ぎるたびに、TestTableName を使って未使用の接続がテストされる。
							テストに合格しない接続は閉じられ、有効な物理データベース接続を再確立するために再び開かれる。
							TestTableName が設定されていない場合、テストは実行されない。
							0 (デフォルト) に設定された状態では、周期的なテストは無効である。
							単位 : 秒
							デフォルト値 : 0
						</td><td>background-validation-minutes</td><td>&nbsp;</td>
</tr>
<tr>
<td>test-table-name</td><td>物理データベース接続のテスト時に使われるテーブルの名前を返す。
							接続をテストする際に使用されるデフォルト SQL コードは、次の通り。
							"select count(*) from TestTableName"
							TestTableName が存在し、接続を使用するデータベース ユーザがアクセスできる必要がある。
							ほとんどのデータベースサーバはこの SQL を最適化して、テーブルスキャンを回避する。
							それでも、TestTableName を、行が少ない (または全くない) テーブルの名前に設定することは有益である。
							TestTableName が「SQL」で始まる場合、「SQL」より後の文字列は、接続をテストするリテラルの SQL 文として扱われる。
							必須 : いいえ
						</td><td>new-connection-sql</td><td>&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
</div>
<br>
<br>
<a name="tubame_2.2.1.3."></a>
<h3 class="title">2.2.1.3.データソースのパラメータ設定(jdbc-data-source-params)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<div class="table">
<a name="N14720"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;データソースのパラメータ設定(jdbc-data-source-params)で設定可能な属性とdata-source及びxa-data-sourceコマンドで指定するパラメータの対応表
			</b>
</p>
<div class="table-contents">
<table summary="データソースのパラメータ設定(jdbc-data-source-params)で設定可能な属性とdata-source及びxa-data-sourceコマンドで指定するパラメータの対応表
			" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>データソース定義ファイルの属性値</th><th>属性値説明</th><th>xa-data-sourceコマンドで指定するパラメータ</th><th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td>jndi-name</td><td>当該データ ソースのバインド先の JNDI パス。JNDIパスをルックアップするアプリケーションは、このデータ ソースに対応する javax.sql.DataSourceインスタンスを取得する。	</td><td>jndi-name</td><td>&nbsp;</td>
</tr>
<tr>
<td>
							global-transactions-protocol
							<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>OnePhaseCommit :1 フェーズ コミット トランザクション処理を使用して非 XA JDBC 接続が 分散トランザクションに参加できるようにする。このオプションを 有効化すると、他のリソースはグローバル トランザクションに 参加できません。</p>
</li>
<li class="listitem">
<p>TwoPhaseCommit :データ ソースからの非 XA 接続がグローバル トランザクションに参加できるようにする</p>
</li>
<li class="listitem">
<p>LoggingLastResource　:ロギング ラスト リソース (LLR) トランザクションの最適化を使用して 非 XA JDBC 接続分散トランザクションに参加できるようにする</p>
</li>
<li class="listitem">
<p>EmulateTwoPhaseCommit　:JTA を使用して非 XA JDBC 接続が分散トランザクションへの参加を エミュレートできるようする</p>
</li>
</ul>
</div>
						
</td><td>グローバルトランザクションプロトコルを指定する</td><td>&nbsp;</td><td>&nbsp;</td>
</tr>
<tr>
<td>algorithm-type</td><td>データソースのアルゴリズム</td><td>
                        
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>Load-Balancing：マルチプールは接続要求をそのメンバープールに均等に分散する。また、このアルゴリズムは高可用性アルゴリズムと同じフェイルオーバ機能を実行する。</p>
</li>
<li class="listitem">
<p>Failover:接続リクエストはリストの最初にある利用可能なプールで処理されます。データ ソースが切断された場合、接続リクエストはリスト内の次のデータ ソースで処理されます</p>
</li>
</ul>
</div>
                        
</td><td>&nbsp;</td>
</tr>
<tr>
<td>data-source-list</td><td>マルチ データ ソースの使用</td><td>url-delimiterで指定区切りを文字を複数コネクションURLで指定することにより可能。ただしXAデータソースの場合、マルチデータソースの使用はできない</td><td>&nbsp;</td>
</tr>
<tr>
<td>connection-pool-failover-callback-handler</td><td>マルチプールがリスト内の次の接続プールにフェイルオーバする前に、WebLogic Server が指定のコールバック アプリケーションを呼び出して戻り値を待機する。コールバック アプリケーションから返された値に応じて、マルチプールが同じ接続プールを試行するか、次の接続プールにフェイルオーバするか、失敗して例外を送出するかが決まる</td><td>該当機能なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>failover-request-if-busy</td><td>true：現在の接続プールにあるすべての接続が使用中の場合に、マルチプール内の代替可能な接続プールにアプリケーションの接続リクエストがルーティングされる。
False(デフォルト): 接続リクエストはフェイルオーバしない。
※  この設定は、高可用性アルゴリズムで実行されている場合にのみ有効。</td><td>該当機能なし</td><td>&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
</div>
<br>
<br>
<a name="tubame_2.2.1.4."></a>
<h3 class="title">2.2.1.4.XAデータソースのパラメータ設定(jdbc-xa-params)の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p></p>
<div class="table">
<a name="N14780"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;データソースのパラメータ設定(jdbc-data-source-params)で設定可能な属性とdata-source及びxa-data-sourceコマンドで指定するパラメータの対応表
			</b>
</p>
<div class="table-contents">
<table summary="データソースのパラメータ設定(jdbc-data-source-params)で設定可能な属性とdata-source及びxa-data-sourceコマンドで指定するパラメータの対応表
			" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>データソース定義ファイルの属性値</th><th>属性値説明</th><th>xa-data-sourceコマンドで指定するパラメータ</th><th>備考</th>
</tr>
</thead>
<tbody>
<tr>
<td>resource-health-monitoring</td><td>この XA 接続プールにおいて、JTA リソースの状態モニタが有効になっているかどうかを返す。このプロパティは XA 接続プールにだけ適用され、XA 以外のドライバを使用する接続プールでは無視される。デフォルト値 : true</td><td>該当設定なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>keep-logical-conn-open-on-release</td><td>物理 XA 接続が XA 接続プールに戻されるときに論理 JDBC 接続が開かれたまま維持される場合は trueを返す。このプロパティは XA 接続プールにだけ適用され、XA 以外のドライバの場合は無視される。その意図は、サード パーティ ベンダ製 XA ドライバの特定の問題を解決することにある。</td><td>該当設定なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>keep-xa-conn-till-tx-complete</td><td>XA 接続プールがトランザクションの完了まで同じ XA 接続を分散トランザクションに関連付ける場合に trueを返す。このプロパティは XA 接続プールにだけ適用され、XA 以外のドライバの場合は無視される。その意図は、サード パーティ ベンダ製 XA ドライバの特定の問題を解決することにある。</td><td>該当設定なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>need-tx-ctx-on-close</td><td>さまざまな JDBC オブジェクト (結果セット、文、接続など) を閉じるときに XA ドライバで分散トランザクション コンテキストが必要な場合に true を返す。true に設定されていると、JDBC オブジェクトを閉じるときに送出される SQL 例外のうち、トランザクションコンテキストでないものは無条件で受信される。このプロパティは XA 接続プールにだけ適用され、XA 以外のドライバの場合は無視される。その意図は、サード パーティ ベンダ製 XA ドライバの特定の問題を解決することにある。</td><td>該当設定なし</td><td>&nbsp;</td>
</tr>
<tr>
<td>new-xa-conn-for-commit</td><td>特定の分散トランザクションのコミットまたはロールバック処理で専用の XA 接続が使用される場合に true を返す。このプロパティは XA 接続プールにだけ適用され、XA 以外のドライバの場合は無視される。その意図は、サード パーティ ベンダ製 XA ドライバの特定の問題を解決することにある。</td><td>該当設定なし。</td><td>&nbsp;</td>
</tr>
<tr>
<td>rollback-local-tx-upon-conn-close</td><td>true に設定すると、WLS 接続プールは接続をプールに戻す前に、その接続に対して rollback() を呼び出す。ロールバックの呼び出しにはデータベースサーバとの通信が必要であるため、この属性を有効にすると、パフォーマンスに影響が生じる。</td><td>該当設定なし。</td><td>&nbsp;</td>
</tr>
<tr>
<td>xa-end-only-once</td><td>保留中の各 XAResource.start() に対して XAResource.end() が一度だけ呼び出される場合に true を返す。つまり、XA ドライバは XAResource.end(TMSUSPEND)、XAResource.end(TMSUCCESS) で連続的に呼び出されることはない。このプロパティは XA 接続プールにだけ適用され、XA 以外のドライバの場合は無視される。その意図は、サードパーティベンダ製XA ドライバの特定の問題を解決することにある。デフォルト値 : false</td><td>該当設定なし。</td><td>&nbsp;</td>
</tr>
<tr>
<td>xa-set-transaction-timeout</td><td>true に設定すると、WebLogic Server トランザクション マネージャは XAResource.start の前に XAResource.setTransaction　Timeout() を呼び出して、XATransactionTimeout またはグローバルトランザクションのタイムアウト (秒単位) を渡す。false に設定すると、setTransactionTimeout() は呼び出されない。このプロパティは XA 接続プールにだけ適用され、XA 以外のドライバを使用する接続プールでは無視される。デフォルト値 : false</td><td>set-tx-query-timeout</td><td>&nbsp;</td>
</tr>
</tbody>
</table>
</div>
</div>
<br class="table-break">
</div>
<br>
<br>
<a name="tubame_2.3."></a>
<h3 class="title">2.3.アプリケーションサーバにおけるサーバ設定</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicでは、APサーバに関する設定は主にconfig.xmlで行っている。本章では、config.xmlで行っている設定をJBossで実施する方法について記載する。

			</p>
<div class="figure">
<a name="N15C2D"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlの構成イメージを以下に示す。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
-security-configuration(セキュリティ設定)

-server(サーバログ設定)
  log
  web-server-log

-embedded-ldap(組み込みLDAP設定)

-jdbc-system-resource(JDBCリソース設定)

-jms-server(JMSサーバ）

-app-deployment(デプロイメント設定)

-self-tuning(チューニング設定)
  max-threads-constraint
  work-manager

				</pre>
</div>
</div>
<p>
<br class="figure-break">

			本書では上記の構成に従い、以下の項目についてJBossEAP6での設定方法について記載する。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>security-configuration(セキュリティ設定)</p>
</li>
<li class="listitem">
<p>server(ログ設定)</p>
</li>
<li class="listitem">
<p>embedded-ldap(組み込みldap設定)</p>
</li>
<li class="listitem">
<p>JTA(JTA設定）</p>
</li>
<li class="listitem">
<p>jdbc-system-resouce(JDBCリソース設定）</p>
</li>
<li class="listitem">
<p>jms-server（JMSリソース設定)</p>
</li>
<li class="listitem">
<p>app-deployment（デプロイメント設定)</p>
</li>
<li class="listitem">
<p>自動チューニング設定(self-tuning)</p>
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.1."></a>
<h3 class="title">2.3.1.セキュリティ設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicでは、セキュリティレルムを適用することで、セキュリティ設定を行っている。このセキュリティ設定では、認証、認可、裁決、ロール
			マッピング、資格マッピング、証明書パス、キーストごとにプロバイダの設定が可能である。

			</p>
<div class="figure">
<a name="N15C5E"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlのセキュリティ設定例。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;security-configuration&gt;
 &lt;name&gt;wl_server&lt;/name&gt;
 &lt;realm&gt;
  &lt;sec:authentication-provider xsi:type="wls:default-identity-asserterType"&gt;
   &lt;sec:active-type&gt;AuthenticatedUser&lt;/sec:active-type&gt;
   &lt;/sec:authentication-provider&gt;
   &lt;sec:role-mapper xmlns:xac="http://www.bea.com/ns/weblogic/90/security/xacml"
    xsi:type="xac:xacml-role-mapperType"&gt;&lt;/sec:role-mapper&gt;
   &lt;sec:authorizer xmlns:xac="http://www.bea.com/ns/weblogic/90/security/xacml"
    xsi:type="xac:xacml-authorizerType"&gt;&lt;/sec:authorizer&gt;
   &lt;sec:adjudicator xsi:type="wls:default-adjudicatorType"&gt;&lt;/sec:adjudicator&gt;
   &lt;sec:credential-mapper xsi:type="wls:default-credential-mapperType"&gt;&lt;/sec:credential-mapper&gt;
   &lt;sec:cert-path-provider xsi:type="wls:web-logic-cert-path-providerType"&gt;&lt;/sec:cert-path-provider&gt;
   &lt;sec:cert-path-builder&gt;WebLogicCertPathProvider&lt;/sec:cert-path-builder&gt;
   &lt;sec:name&gt;myrealm&lt;/sec:name&gt;
 &lt;/realm&gt;
 &lt;default-realm&gt;myrealm&lt;/default-realm&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			以下はWebLogicの認証、認可のプロバイダで設定可能なプロバイダ一覧である。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>認証</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>ActivedirectoryAuthenticator</p>
</li>
<li class="listitem">
<p>CustomDBMSAuthenticator</p>
</li>
<li class="listitem">
<p>DefaultAuthenticator</p>
</li>
<li class="listitem">
<p>iPlanetAuthenticator</p>
</li>
<li class="listitem">
<p>LDAPAuthenticator</p>
</li>
<li class="listitem">
<p>NovellAuthenticator</p>
</li>
<li class="listitem">
<p>OpenLDAPAuthenticator</p>
</li>
<li class="listitem">
<p>ReadOnlySQLAuthenticator</p>
</li>
<li class="listitem">
<p>SQLAuthenticator</p>
</li>
<li class="listitem">
<p>SAMLAuthenticator</p>
</li>
<li class="listitem">
<p>WindowsNTAuthenticator</p>
</li>
<li class="listitem">
<p>DefaultIdentityAsserter</p>
</li>
<li class="listitem">
<p>LDAPX509IdentityAsserter</p>
</li>
<li class="listitem">
<p>NegotiateIdentityAsserter</p>
</li>
<li class="listitem">
<p>SAMLIdentityAsserterV2</p>
</li>
<li class="listitem">
<p>SAMLIdentityAsserter</p>
</li>
<li class="listitem">
<p>WSRPIdentityAsserter</p>
</li>
</ul>
</div>
</li>
<li class="listitem">
<p>認可</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>DefaulAuthorizer</p>
</li>
<li class="listitem">
<p>XACMLAuthorizer</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<p>
		
</p>
<p>
			JBossの場合もWebLogicと同様で、セキュリティレルムを利用してセキュリティ設定を行う。アプリケーションのセキュリティを確保するために、WebLogicの各種セキュリティプロバイダを利用して、認証と認可等のセキュリティを実現している場合は、
			移行元のアプリケーションのセキュリティ仕様を確認し、JBossでセキュリティ仕様を満たせることを確認し、JBossへの移行可能かを検討する必要がある。セキュリティ設定はWebLogicとJBossと異なっており、移行する際、セキュリティの設定を1対1の対応で移行することが困難であるため、以下ではJBossのセキュリティ概念について説明する。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBossのセキュリティ概念</p>
<p>
						JBossの場合は、複数のセキュリティドメインが定義可能で、ひとつのセキュリティドメインに対してひとつの認証機構(ログインモジュール）を設定できる。
						</p>
<div class="figure">
<a name="N15CB4"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;セキュリティドメイン設定
							</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
								
&lt;subsystem xmlns="urn:jboss:domain:security:1.2"&gt;
 &lt;security-domains&gt;
  &lt;security-domain name="other" cache-type="default"&gt;
    &lt;authentication&gt;
     &lt;login-module code="Remoting" flag="optional"&gt;
      &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
     &lt;/login-module&gt;
     &lt;login-module code="RealmDirect" flag="required"&gt;
      &lt;module-option name="password-stacking" value="useFirstPass"/&gt;
     &lt;/login-module&gt;
   &lt;/authentication&gt;
  &lt;/security-domain&gt;
  &lt;security-domain name="jboss-web-policy" cache-type="default"&gt;
   &lt;authorization&gt;
    &lt;policy-module code="Delegating" flag="required"/&gt;
   &lt;/authorization&gt;
   &lt;/security-domain&gt;
  &lt;security-domain name="jboss-ejb-policy" cache-type="default"&gt;
   &lt;authorization&gt;
    &lt;policy-module code="Delegating" flag="required"/&gt;
   &lt;/authorization&gt;
  &lt;/security-domain&gt;

							</pre>
</div>
</div>
<p>
<br class="figure-break">
						login-moduleのcode属性により認証機能が決定する。以下に指定可能なcodo属性の一部について示す。
						</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>Client(ClientLoginModule)</p>
</li>
<li class="listitem">
<p>Certificate(BaseCertLoginModule)</p>
</li>
<li class="listitem">
<p>CertificateRoles(CertRolesLoginModule)</p>
</li>
<li class="listitem">
<p>DatabaseCertificate(DatabaseCertLoginModule)
								</p>
</li>
<li class="listitem">
<p>Identity(IdentityLoginModule)</p>
</li>
<li class="listitem">
<p>Ldap(LdapLoginModule)</p>
</li>
<li class="listitem">
<p>LdapExtended(LdapExtLoginModule)</p>
</li>
<li class="listitem">
<p>RoleMapping(RoleMappingLoginModule)</p>
</li>
<li class="listitem">
<p>Simple(SimpleServerLoginModule)</p>
</li>
<li class="listitem">
<p>UsersRoles(UsersRolesLoginModule)</p>
</li>
<li class="listitem">
<p>RealmUsersRoles(RealmUsersRolesLoginModule)</p>
</li>
<li class="listitem">
<p>RealmDirect(RealmDirectLoginModule)</p>
</li>
<li class="listitem">
<p>Disabled(DisabledLoginModule)</p>
</li>
<li class="listitem">
<p>Anon(AnonLoginModule)</p>
</li>
</ul>
</div>
<p>
						
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>
								その他のcode属性で指定可能な値については以下のクラスを参照
								</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>org.jboss.as.security.ModulesMap</p>
</li>
</ul>
</div>
<p>
							
</p>
</td>
</tr>
</table>
</div>
<p>

						本書ではDatabase(DatabaseServerLoginModule)、RealmDirect(RealmDirectLoginModule及び、データソースの認証機能として利用可能なSecureIdentityを利用する例を示す。
					</p>
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.1.1."></a>
<h3 class="title">2.3.1.1.Database認証モジュール(DatabaseServerLoginModule)</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			以下にDatabase認証モジュール(DatabaseServerLoginModule)を利用する場合の設定について示す。なお、クイックスタート(servlet_security)にサンプルがあるので詳細についてはそちらを確認してください

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>セキュリティドメインをあらたに作成する</p>
<div class="figure">
<a name="N15D05"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;セキュリティドメインservlet-security-quickstartの作成例(管理CLI)
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
/subsystem=security/security-domain=servlet-security-quickstart/:add(cache-type=default)
/subsystem=security/security-domain=servlet-security-quickstart/authentication=classic:add(login-modules=[{"code"=&gt;"Database", "flag"=&gt;"required", "module-options"=&gt;[("dsJndiName"=&gt;"java:jboss/datasources/ServletSecurityDS"),("principalsQuery"=&gt;"SELECT PASSWORD FROM USERS WHERE USERNAME = ?"), ("rolesQuery"=&gt;"SELECT R.NAME, 'Roles' FROM USERS_ROLES UR INNER JOIN ROLES R ON R.ID = UR.ROLE_ID INNER JOIN USERS U ON U.ID = UR.USER_ID WHERE U.USERNAME = ?")]}])
/:reload

						</pre>
</div>
</div>
<br class="figure-break">
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>ログインモジュールを利用する際は、それぞれのログインモジュールの仕様に応じた設定が必要なため、適宜設定が必要である。</p>
<p>
							Database認証モジュール(DatabaseServerLoginModule)では、ユーザIDに対応するパスワードを特定するためのクエリをprincipalsQueryで指定する。また、ユーザのロール情報としてロール名と、ロール名を特定するためのクエリをrolesQueryで指定する
							</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: circle; ">
<li class="listitem">
<p>principalsQuery(クエリ例):select Password from Principals
										where PrincipalID=?
									</p>
</li>
<li class="listitem">
<p>rolesQuery(クエリ例):select Role, RoleGroup from Roles
										where PrincipalID=?
									</p>
</li>
</ul>
</div>
<p>
						
</p>
</td>
</tr>
</table>
</div>
</li>
<li class="listitem">
<p>web.xmlにBASIC認証設定を行う</p>
<div class="figure">
<a name="N15D1F"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;web.xmlのBASIC認証設定
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
   version="3.0"&gt;
   &lt;!-- Configure login to be HTTP Basic --&gt;
   &lt;login-config&gt;
      &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
      &lt;realm-name&gt;RealmUsersRoles&lt;/realm-name&gt;
   &lt;/login-config&gt;
&lt;/web-app&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>jboss-web.xmlにてセキュリティドメインservlet-security-domainを適用することを宣言する。
					</p>
<div class="figure">
<a name="N15D2C"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;jboss-web.xmlのセキュリティドメイン設定
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jboss-web&gt;
   &lt;security-domain&gt;servlet-security-quickstart&lt;/security-domain&gt;
   &lt;disable-audit&gt;true&lt;/disable-audit&gt;
&lt;/jboss-web&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>
			
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>サンプル実装ではquickstartsロールについてアクセスを許容するようにサンプルが実装されているため、データベースに適宜ユーザを追加して、quickstartsロールを設定する必要があります。
				</p>
<div class="figure">
<a name="N15D3A"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;サーブレットセキュリティのサンプル実装
					</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
...
import java.security.Principal;

import javax.servlet.ServletException;
import javax.servlet.annotation.HttpConstraint;
import javax.servlet.annotation.ServletSecurity;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

...

@SuppressWarnings("serial")
@WebServlet("/SecuredServlet")
@ServletSecurity(@HttpConstraint(rolesAllowed = { "quickstarts" }))
public class SecuredServlet extends HttpServlet {
...
}

					</pre>
</div>
</div>
<br class="figure-break">
</td>
</tr>
</table>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.1.2."></a>
<h3 class="title">2.3.1.2.File認証モジュール(UsersRolesLoginModule)</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			以下にFile認証モジュール(UsersRolesLoginModule)を利用する場合の設定について示します。この例ではデフォルトで登録されているセキュリティドメインotherを利用する。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>セキュリティドメインotherのlogin-moduleにRealmDirectが設定されていることを確認する</p>
<div class="figure">
<a name="N15D55"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;RealmDirectの設定確認例(管理CLI)
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
/subsystem=security/security-domain=other/authentication=classic/login-module=RealmDirect:read-resource(recursive=true)

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>web.xmlにBASIC認証設定を行う</p>
<div class="figure">
<a name="N15D62"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;web.xmlのBASIC認証設定
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;web-app xmlns="http://java.sun.com/xml/ns/javaee" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
   xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"
   version="3.0"&gt;
   &lt;!-- Configure login to be HTTP Basic --&gt;
   &lt;login-config&gt;
      &lt;auth-method&gt;BASIC&lt;/auth-method&gt;
      &lt;realm-name&gt;RealmUsersRoles&lt;/realm-name&gt;
   &lt;/login-config&gt;
&lt;/web-app&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>jboss-web.xmlにてセキュリティドメインotherを適用することを宣言する。</p>
<div class="figure">
<a name="N15D6F"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;jboss-web.xmlのセキュリティドメイン設定
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;jboss-web&gt;
   &lt;security-domain&gt;other&lt;/security-domain&gt;
   &lt;disable-audit&gt;true&lt;/disable-audit&gt;
&lt;/jboss-web&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>
            
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>サンプル実装ではguestロールについてアクセスを許容するようにサンプルが実装されているため、JBossEAP6に付属するadd-userコマンドで、ApplicationRealmにユーザを追加して、guestロールを設定する必要がある
				</p>
<div class="figure">
<a name="N15D7D"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;サーブレットセキュリティのサンプル実装
					</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
						
...
import java.security.Principal;

import javax.servlet.ServletException;
import javax.servlet.annotation.HttpConstraint;
import javax.servlet.annotation.ServletSecurity;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

...

@SuppressWarnings("serial")
@WebServlet("/SecuredServlet")
@ServletSecurity(@HttpConstraint(rolesAllowed = { "guest" }))
public class SecuredServlet extends HttpServlet {
...
}

					</pre>
</div>
</div>
<br class="figure-break">
</td>
</tr>
</table>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.1.3."></a>
<h3 class="title">2.3.1.3.DataSource認証モジュール(SecureIdentity)</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			データソース認証モジュールとして、ConfiguredIdentityとSecureIdentityが存在する。本書ではSecureIdentityを利用する方法について示す。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>ConfiguredIdentity</p>
<p>この機能は、コンフィグファイル(standalone-full-ha.xml)のデータソース設定に平文のid,passwordが設定されるが、これをコンフィグファイル(standalone-full-ha.xml)のデータソース設定から
						隠ぺいし、セキュリティドメイン設定に平文で登録して利用する。
						認証が成功するとコンテナが自動的に、コンテキストにプリシンパルや、クレンデンシャルが設定される。
					</p>
</li>
<li class="listitem">
<p>SecureIdentity</p>
<p>この機能は、ConfiguredIdentityが平文のid,passwordを利用するのに対して、パスワード部分を暗号化することが可能である。
					</p>
</li>
</ul>
</div>
<p>

			
</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>パスワードを暗号化する
					</p>
<div class="figure">
<a name="N15DA4"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;picketboxのライブラリを利用して、パスワードを暗号化する
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
java -cp picketbox-4.0.17.Final-redhat-1.jar org.picketbox.datasource.security.SecureIdentityLoginModule xxx &lt;- パスワード指定する
Encoded password: xxxxxxxxxxxxxxx

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>セキュリティドメインをあらたに作成する</p>
<div class="figure">
<a name="N15DB1"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;セキュリティドメインEncryptedDSDomainの作成例(管理CLI)
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
/subsystem=security/security-domain=EncryptedDSDomain:add(cache-type=default)
/subsystem=security/security-domain=EncryptedDSDomain/authentication=classic:add(login-modules=[{"code"=&gt;"SecureIdentity", "flag"=&gt;"required", "module-options"=&gt;[("username"=&gt;"someuserid"),("password"=&gt;"1d5bcec446b79907df8592078de921bc")]}])
/:reload

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>データソース設定にセキュリティドメインを設定する。</p>
<div class="figure">
<a name="N15DBE"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;データソースのセキュリティドメイン設定例(管理CLI)
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
xa-data-source --name=postgresDS --security-domain=EncryptedDSDomain

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>データソース設定に設置されたUserとPassowrdを削除する。</p>
<div class="figure">
<a name="N15DCB"></a>
<p class="title">
<b>Figure&nbsp;4.&nbsp;データソース設定のUserとPassowrd削除(管理CLI)
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
/subsystem=datasources/xa-data-source=postgresDS/xa-datasource-properties=User:remove()
/subsystem=datasources/xa-data-source=postgresDS/xa-datasource-properties=Password:remove()

						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.2."></a>
<h3 class="title">2.3.2.ログ設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではサーバログに重要度(TRACE、DEBUG、INFO、NOTICE、WARNING、ERROR、CRITICAL、ALERT、EMERGENCY)があらかじめ定義される。設定ファイルにはlogおよびweb-server-logタグが存在し、それぞれサーバログとWebサーバログ（以降WEBアクセスログ）の
			ログローテーション設定を行っている。

			</p>
<div class="figure">
<a name="N15DE2"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlのサーバログ設定例。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;server&gt;
 &lt;name&gt;testserver&lt;/name&gt;
 &lt;log&gt;
  &lt;file-name&gt;logs/server.log&lt;/file-name&gt;
  &lt;rotation-type&gt;byTime&lt;/rotation-type&gt;
  &lt;number-of-files-limited&gt;true&lt;/number-of-files-limited&gt;
  &lt;log-file-severity&gt;Debug&lt;/log-file-severity&gt;
  &lt;domain-log-broadcast-severity&gt;Off&lt;/domain-log-broadcast-severity&gt;
 &lt;/log&gt;
 &lt;web-server&gt;
  &lt;web-server-log&gt;
   &lt;rotation-type&gt;byTime&lt;/rotation-type&gt;
   &lt;number-of-files-limited&gt;true&lt;/number-of-files-limited&gt;
   &lt;elf-fields&gt;date time c-ip cs-method sc-status time-taken cs-uri&lt;/elf-fields&gt;
   &lt;log-file-format&gt;extended&lt;/log-file-format&gt;
  &lt;/web-server-log&gt;
 &lt;/web-server&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">

		
</p>
<p>
			JBossでは、JBoss Loggingのログレベルとして以下のログレベルが利用可能である。CRITICAL、ALERT、EMERGENCYは、WebLogicとログレベルが一致しないので、適宜修正すること。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBoss Loggingのログレベル:TRACE、DEBUG、INFO、 WARN、ERROR、FATAL</p>
</li>
</ul>
</div>
<p>
		
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>ログ出力にはJBoss Loggingのほかに、java、commons-logging、log4j、sl4jのログフレームワークに対応しているたため、これらのログフレームワークが対応するすべてのログレベルに対応している</p>
<p>なお、アプリケーションのログ出力に、これらのログフレームワークを利用する場合は、JBossが提供している上記のログフレームワークのライブラリを利用して、コンパイルすること。アーカイブ時には、コンテナがモジュールとしてクラスをロードしているため、ログフレームワークライブラリを同梱させる必要はありません。</p>
</td>
</tr>
</table>
</div>
</div>
<br>
<br>
<a name="tubame_2.3.2.1."></a>
<h3 class="title">2.3.2.1.サーバログのローテーション設定</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicで設定している項目を対象に、JBossのサーバログのローテーション設定について示す。
			</p>
<div class="table">
<a name="N15FFB"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;サーバログローテーション設定
				</b>
</p>
<div class="table-contents">
<table summary="サーバログローテーション設定
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>設定項目</th><th>WebLogic</th><th>JBoss</th>
</tr>
</thead>
<tbody>
<tr>
<td>ログファイル名</td><td>&nbsp;</td><td>server.log</td>
</tr>
<tr>
<td>ローテーション種別</td><td>WebLogicのローテーション種別(rotation-type)として、サイズまたは時間が指定可能である</td><td>JBossはローテーション種別として、サイズまたは時間が指定可能である。時間については、デフォルトで日単位設定となっている。</td>
</tr>
<tr>
<td>保存するファイル数の制限</td><td>WebLogicは、number-of-files-limitedで保存するファイル数を制限できる	</td><td>WebLogicのように保存するファイル数の制限させる機能はJBossにないため、cronなどを利用してログを定期的に削除する必要がある。</td>
</tr>
<tr>
<td>サーバのログ ファイルに送られるログ メッセージの最低の重大度</td><td>WebLogicは、サーバのログ ファイルに送られるログメッセージの最低の重大度をlog-file-severityで設定できる</td><td>JBoss該当機能なし</td>
</tr>
<tr>
<td>サーバログからドメインログに送られるログメッセージの最低の重大度</td><td>WebLogicは、サーバログからドメインログに送られるログメッセージの最低の重大度をdomain-log-broadcast-severityで設定できる
							</td><td>JBoss該当機能なし</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
            
            
</p>
<div class="figure">
<a name="N1602C"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;管理CLIによるサーバログ設定例（デフォルトで日単位によるローテーションからサイズに変更）
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
/subsystem=logging/periodic-rotating-file-handler=FILE:remove
/subsystem=logging/size-rotating-file-handler=FILE:add(file={"path"=&gt;"server.log", "relative-to"=&gt;"jboss.server.log.dir}, rotate-size="100m", max-backup-index=10)

				</pre>
</div>
</div>
<p>
<br class="figure-break">
            　　　　　上記の示す通り、ログファイルのファイルサイズ上限とバックアップファイル数を指定できます。指定はsize-rotating-file-handlerのパラメータで行い、ファイルサイズの上限はrotate-sizeパラメータ、バックアップファイル数はmax-backup-indexパラメータで指定します。なお、ファイルサイズは「M」と記述することで「メガバイト」単位を指定でき、同様に「K」、「G」も指定可能です。
            
		</p>
</div>
<br>
<br>
<a name="tubame_2.3.2.2."></a>
<h3 class="title">2.3.2.2.Webアクセスログのローテーション設定</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicで設定している項目を対象に、JBossのWEBアクセスログのローテーション設定について示す。
			
			</p>
<div class="table">
<a name="N16043"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;WEBアクセスログのローテーション設定
				</b>
</p>
<div class="table-contents">
<table summary="WEBアクセスログのローテーション設定
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>設定項目</th><th>WebLogic</th><th>JBoss</th>
</tr>
</thead>
<tbody>
<tr>
<td>ログファイル名</td><td>&nbsp;</td><td>localhost_access_log.YYYY-MM-DD</td>
</tr>
<tr>
<td>ローテーション種別</td><td>WebLogicのローテーション種別(rotation-type)として、サイズまたは時間が指定可能である</td><td>WEBアクセスログのローテーション種別として、日付のみが指定可能である。WEbアクセスログの設定については、管理CLIによる行う。</td>
</tr>
<tr>
<td>保存するファイル数の制限</td><td>WebLogicは、number-of-files-limitedで保存するファイル数を制限できる	</td><td>WebLogicのように保存するファイル数の制限させる機能はJBossにないため、cronなどを利用してログを定期的に削除する必要がある。</td>
</tr>
<tr>
<td>ログフォーマット</td><td>WebLogicは、W3C によって 定義されたディレクティブを使用して、ログのフォーマット情報をカスタマイズする場合にextendedを指定する</td><td>JBossはw3cで定義されたディスクリプタによるカスタマイズは、Webアクセスログのconfigurationのextendedをtrueにすることで、以下のフォーマット「time
								cs-method cs-uri sc-status sc(Referer)」で出力される</td>
</tr>
<tr>
<td>拡張ロギング フォーマット</td><td>WebLogicは、W3C によって 定義されたディレクティブを使用して、ログのフォーマット情報をカスタマイズできる</td><td>W3C によって定義されたディレクティブを個別に指定して、フォーマットをカスタマイズすることはJBossはできない。</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
            
</p>
<div class="figure">
<a name="N16074"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;管理CLIによるWebアクセスログ出力設定
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
/subsystem=web/virtual-server=default-host/access-log=configuration/:add(pattern="%t,%a,%U,%s,%D",resolve-hosts=false, prefix="localhost_access_log.", rotate=true) 
/subsystem=web/virtual-server=default-host/access-log=configuration/directory=configuration/:add(relative-to="jboss.server.log.dir",path=".")

				</pre>
</div>
</div>
<p>
<br class="figure-break">
            
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.3."></a>
<h3 class="title">2.3.3.組み込みLDAP設の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicでは、組み込みLDAP サーバが同梱されるが、JBossにはLDAPサーバは同梱されない。
システム要件上、LDAPサーバにてアカウント情報の管理が必須である場合、JBossはLDAPサーバを内包していないため、別途LDAPサーバの設置及び移行を検討する必要がある。

			</p>
<div class="figure">
<a name="N15E05"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlの組み込みLDAP設定。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
  &lt;embedded-ldap&gt;
    &lt;name&gt;wl_server&lt;/name&gt;
    &lt;credential-encrypted&gt;{3DES}HpRRsmGrKbmGEayjHAiY5ahUNW4cidxeuvn14Ot2gl8=&lt;/credential-encrypted&gt;
  &lt;/embedded-ldap&gt;
  
				</pre>
</div>
</div>
<p>
<br class="figure-break">

</p>
</div>
<br>
<br>
<a name="tubame_2.3.4."></a>
<h3 class="title">2.3.4.SNMPエージェント設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicには、SNMPエージェントを有効にすることで、「SNMPマネージャからのリクエストに対してレスポンスを返す」機能及び、
			「SNMPマネージャに対してトラップを送出する」機能をサポートしており、SNMPマネジャーとの連携がシームレスに実現できる。
		</p>
<div class="figure">
<a name="N15E1C"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlのSNMPエージェント設定.(デフォルトはfalse)
			</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
				
  &lt;snmp-agent&gt;
    &lt;enabled&gt;true&lt;/enabled&gt;
  &lt;/snmp-agent&gt;

			</pre>
</div>
</div>
<br class="figure-break">
<p>JBossEAP6では、SNMPエージェント機能は存在しないため、SNMPアーキテクチャを利用した、SNMPマネージャとの連携はできない。</p>
</div>
<br>
<br>
<a name="tubame_2.3.5."></a>
<h3 class="title">2.3.5.JTA設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicでは、JTAに関する設定は主にconfig.xmlで行っている。
			</p>
<div class="figure">
<a name="N15E34"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlにおけるJTA設定。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
  &lt;jta&gt;
    &lt;name&gt;hoge&lt;/name&gt;
    &lt;timeout-seconds&gt;500&lt;/timeout-seconds&gt;
  &lt;/jta&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">

			
</p>
<div class="table">
<a name="N15E3F"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;config.xmlのjtaタグで定義されている設定とJBossの対応
				</b>
</p>
<div class="table-contents">
<table summary="config.xmlのjtaタグで定義されている設定とJBossの対応
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>#</th><th>WebLogicの設定項目</th><th>JBossのへの設定項目</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>
								timeout-seconds
								<p>トランザクション タイムアウトの秒数。この値 (begin() からカウント)
									を過ぎてもトランザクションが「アクティブ」の場合、自動的にロールバックされる。ただし、トランザクションが準備された状態になった場合、このタイムアウトパラメータは無効になる。トランザクションは、すべてのリソースがコミットされるまで再試行される。
								</p>
								デフォルト値：30
							</td><td>
								/subsystem=transactionsのdefault-timeout属性
								<p>トランザクションタイムアウト</p>
								デフォルト値：300秒
							</td>
</tr>
<tr>
<td>2</td><td>
								abandon-timeout-seconds
								<p>AbandonTimeoutSeconds 属性を使用すると、トランザクションの 2
									番目のフェーズでトランザクションマネージャがトランザクション完了まで処理を再試行する最長時間を設定できる。
									トランザクション破棄タイムアウトの時間を過ぎると、トランザクションを解決するための処理はこれ以上行われなくなる。
								</p>
								デフォルト値：86400
							</td><td>
								com.arjuna.ats.arjuna.recovery.expiryScanIntervalプロパティ
								<p>トランザクションのリカバリマネージャは、トランザクションの有効期限の時間が経過すると、トランザクションログが隔離されリカバリ対象から外す
								</p>
								expiryScanIntervalプロパティのデフォルト値は12となり、12時間となる
							</td>
</tr>
<tr>
<td>3</td><td>
								before-completion-iteration-limit
								<p>トランザクション マネージャがbeforeCompletion
									同期化コールバックを実行するサイクルの最大数。
								</p>
								デフォルト値：10
							</td><td>該当する設定なし。</td>
</tr>
<tr>
<td>4</td><td>
								max-transactions
								<p>サーバで許可される同時進行トランザクションの最大数</p>
								デフォルト値：10000
							</td><td>該当する設定なし。</td>
</tr>
<tr>
<td>5</td><td>
								max-unique-name-statistics
								<p>保持する統計の対象となるユニークなトランザクション名の最大数。</p>
								デフォルト値：1000
							</td><td>該当する設定なし。</td>
</tr>
<tr>
<td>6</td><td>
								checkpoint-interval-seconds
								<p>トランザクションマネージャが、新しいトランザクションログファイルを作成し、すべての古いトランザクションログファイルをチェックしてそれらを削除できるかどうかを確認する間隔。
								</p>
								デフォルト値：300
							</td><td>
								com.arjuna.ats.arjuna.recovery.periodicRecoveryPeriodプロパティ
								<p>トランザクションのリカバリ間隔</p>
								デフォルト値は、120で、120秒となる
							</td>
</tr>
<tr>
<td>7</td><td>
								forget-heuristics
								<p>ヒューリスティックの決定をレポートするすべてのリソースに対して、トランザクションマネージャが自動的にXA
									Resource forget()操作を実行するかどうかを指定する。
								</p>
								デフォルト値は true。
							</td><td>
								com.arjuna.ats.arjuna.coordinator.maintainHeuristicsプロパティ
								<p>注意が必要な点として、JBossはデフォルトがYES(つまりヒューリスティックなリソースを残す)。NOに設定した場合に常にヒューリスティックリソースをforget()するようになる。</p>
								デフォルトはtrue
							</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">

		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.6."></a>
<h3 class="title">2.3.6.JDBCリソース設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではデータソース設定をJDBCリソース設定として設定する。JDBCの設定自体はjdbc-system-resourceタグ内でdescriptor-file-nameで指定されたファイルで設定される
			</p>
<div class="figure">
<a name="N15EAC"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlにおけるJDBCリソース設定</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;jdbc-system-resource&gt;
    &lt;name&gt;ExampleDataSource&lt;/name&gt;
    &lt;target&gt;exampleServer&lt;/target&gt;
    &lt;descriptor-file-name&gt;jdbc/example-jdbc.xml&lt;/descriptor-file-name&gt;
&lt;/jdbc-system-resource&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			
			
</p>
<div class="figure">
<a name="N15EB7"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;descriptor-file-nameで指定されたJDBCリソースの設定を実際に行っているファイル</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;?xml version='1.0' encoding='UTF-8'?&gt;
&lt;jdbc-data-source xmlns="http://www.bea.com/ns/weblogic/90" xmlns:sec="http://www.bea.com/ns/weblogic/90/security" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:wls="http://www.bea.com/ns/weblogic/90/security/wls" xsi:schemaLocation="http://www.bea.com/ns/weblogic/920 http://www.bea.com/ns/weblogic/920.xsd"&gt;
  &lt;name&gt;BOGDataSource&lt;/name&gt;
  &lt;jdbc-driver-params&gt;
    &lt;url&gt;jdbc:oracle:thin:XXX.XXX.XXX.XXX:PORT:SID&lt;/url&gt;
    &lt;driver-name&gt;oracle.jdbc.OracleDriver&lt;/driver-name&gt;
    &lt;properties&gt;
      &lt;property&gt;
        &lt;name&gt;user&lt;/name&gt;
        &lt;value&gt;user&lt;/value&gt;
      &lt;/property&gt;
    &lt;/properties&gt;
    &lt;password-encrypted&gt;xxx&lt;/password-encrypted&gt;
  &lt;/jdbc-driver-params&gt;
  &lt;jdbc-connection-pool-params&gt;
    &lt;initial-capacity&gt;30&lt;/initial-capacity&gt;
    &lt;max-capacity&gt;30&lt;/max-capacity&gt;
    &lt;connection-creation-retry-frequency-seconds&gt;30&lt;/connection-creation-retry-frequency-seconds&gt;
    &lt;test-connections-on-reserve&gt;true&lt;/test-connections-on-reserve&gt;
    &lt;test-table-name&gt;SQL SELECT 1 FROM DUAL&lt;/test-table-name&gt;
  &lt;/jdbc-connection-pool-params&gt;
  &lt;jdbc-data-source-params&gt;
    &lt;jndi-name&gt;BOGDataSource&lt;/jndi-name&gt;
    &lt;global-transactions-protocol&gt;OnePhaseCommit&lt;/global-transactions-protocol&gt;
  &lt;/jdbc-data-source-params&gt;
&lt;/jdbc-data-source&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			
			JBossではdatasourceサブシステムにて、データソース設定を行う。詳細はデータ設定の移行を参照。
		</p>
</div>
<br>
<br>
<a name="tubame_2.3.7."></a>
<h3 class="title">2.3.7.JMS設定</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicのJMS設定は大きく以下のように別れる
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JMSサーバ設定(jms-server）</p>
<p>JMSサーバ設定としてJMSパーシステンス設定(persistent-store)について定義を行っている。</p>
<div class="figure">
<a name="N15ED4"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlの構成イメージを以下に示す。
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;jms-server&gt;
 &lt;name&gt;examplesJMSServer&lt;/name&gt;
 &lt;target&gt;examplesServer&lt;/target&gt;

 &lt;persistent-store&gt;exampleJDBCStore&lt;/persistent-store&gt;

 &lt;temporary-template-resource xsi:nil="true"&gt;&lt;/temporary-template-resource&gt;
 &lt;temporary-template-name xsi:nil="true"&gt;&lt;/temporary-template-name&gt;
 &lt;jms-message-log-file&gt;
  &lt;name&gt;examplesJMSServer&lt;/name&gt;
 &lt;/jms-message-log-file&gt;
&lt;/jms-server&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>JMSシステムリソース設定(jms-system-resource)</p>
<p>JMSシステムリソースとして、サブデプロイメント（sub-deployment）の定義を行っている。各デプロイメントの設定は、descriptor-file-nameで指定されたファイルで、コネクションファクトリ(connection-factory)、キュー(queue)、トピック(topic)の設定が行われる。
設定を行っている。</p>
<div class="figure">
<a name="N15EE3"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;config.xmlの構成イメージを以下に示す。
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;jms-system-resource&gt;
 &lt;name&gt;examples-jms&lt;/name&gt;
 &lt;target&gt;examplesServer&lt;/target&gt;
 &lt;sub-deployment&gt;
  &lt;name&gt;exampleQueue&lt;/name&gt;
  &lt;target&gt;examplesServer&lt;/target&gt;
 &lt;/sub-deployment&gt;
 &lt;sub-deployment&gt;
  &lt;name&gt;exampleTopic&lt;/name&gt;
  &lt;target&gt;examplesServer&lt;/target&gt;
 &lt;/sub-deployment&gt;
 &lt;descriptor-file-name&gt;jms/examples-jms.xml&lt;/descriptor-file-name&gt;
&lt;/jms-system-resource&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>
		
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.7.1."></a>
<h3 class="title">2.3.7.1.JMSパーシステンス設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではconfig.xmlのjms-serverタグ内のpersistent-store設定で、JMSの永続化ストアの設定行っている。WebLogicはファイル(file-store)及びデータベース(jdbc-store)をサポートしている
        </p>
<div class="figure">
<a name="N15EFA"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlの構成イメージを以下に示す。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;jms-server&gt;
 &lt;name&gt;examplesJMSServer&lt;/name&gt;
 &lt;target&gt;examplesServer&lt;/target&gt;

 &lt;persistent-store&gt;exampleJDBCStore&lt;/persistent-store&gt;

 &lt;temporary-template-resource xsi:nil="true"&gt;&lt;/temporary-template-resource&gt;
 &lt;temporary-template-name xsi:nil="true"&gt;&lt;/temporary-template-name&gt;
 &lt;jms-message-log-file&gt;
  &lt;name&gt;examplesJMSServer&lt;/name&gt;
 &lt;/jms-message-log-file&gt;
 &lt;/jms-server&gt;

&lt;file-store&gt;
 &lt;name&gt;WseeFileStore&lt;/name&gt;
 &lt;directory&gt;WseeFileStore&lt;/directory&gt;
 &lt;target&gt;examplesServer&lt;/target&gt;
 &lt;/file-store&gt;

&lt;jdbc-store&gt;
 &lt;name&gt;exampleJDBCStore&lt;/name&gt;
 &lt;prefix-name&gt;examples&lt;/prefix-name&gt;
 &lt;data-source&gt;examples-demo&lt;/data-source&gt;
 &lt;target&gt;examplesServer&lt;/target&gt;
&lt;/jdbc-store&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
            
        
</p>
<p>JBossEAP6のメッセージングシステムであるHornetQはパーシステンス（永続化）のために、リレーショナルデータベースや他のパーシステンスエンジンを使用せずに、ローカルトランザクションおよび XA トランザクション対応のメッセージング用に最適化されたジャーナル機能を使用している。
移行元の環境でJMSの永続化設定としてRDBMSによる永続化を行っている場合、JBossEAP6ではRDBMSを永続化として採用できないので注意すること。ジャーナルの設定方法については、JBoss EAP 6.1構築・運用ガイド（HornetQ編）を参照。</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>HornetQはデフォルトでジャーナルの読み書きにJavaのNIOを利用している。LinuxカーネルのAIOを利用してジャーナルへのアクセスを高速化するためのプラグインも利用することが可能である。</p>
</td>
</tr>
</table>
</div>
</div>
<br>
<br>
<a name="tubame_2.3.7.2."></a>
<h3 class="title">2.3.7.2.JMSシステムリソース設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではJMSシステムリソース(jms-system-resource)としてサブデプロイメント(sub-deployment)の定義を行い、コネクションファクトリ、キュー、トピックをサブデプロイメントとして登録する。コネクションファクトリ、キュー、トピックなどのサブデプロイメントの設定内容については、descriptor-file-nameで指定されたファイル(jms/examples-jms.xml)で定義されており、config.xml内のsub-deployment/nameで設定された値で
			紐づけが行われている。
			</p>
<div class="figure">
<a name="N15F16"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlの構成イメージを以下に示す。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;jms-system-resource&gt;
 &lt;name&gt;examples-jms&lt;/name&gt;
 &lt;target&gt;examplesServer&lt;/target&gt;
 &lt;sub-deployment&gt;
  &lt;name&gt;exampleQueue&lt;/name&gt;
  &lt;target&gt;examplesServer&lt;/target&gt;
 &lt;/sub-deployment&gt;
 &lt;sub-deployment&gt;
  &lt;name&gt;exampleTopic&lt;/name&gt;
  &lt;target&gt;examplesServer&lt;/target&gt;
 &lt;/sub-deployment&gt;
 &lt;descriptor-file-name&gt;jms/examples-jms.xml&lt;/descriptor-file-name&gt;
&lt;/jms-system-resource&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			
			
</p>
<div class="figure">
<a name="N15F21"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;jms/examples-jms.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;weblogic-jms xmlns="http://www.bea.com/ns/weblogic/90"&gt;
 &lt;connection-factory name="weblogic.examples.jms.QueueConnectionFactory"&gt;
  &lt;sub-deployment-name&gt;exampleQueue&lt;/sub-deployment-name&gt;
  &lt;jndi-name&gt;weblogic.examples.jms.QueueConnectionFactory&lt;/jndi-name&gt;
  &lt;transaction-params&gt;
   &lt;xa-connection-factory-enabled&gt;false&lt;/xa-connection-factory-enabled&gt;
  &lt;/transaction-params&gt;
 &lt;/connection-factory&gt;
 &lt;connection-factory name="exampleTopic"&gt;
  &lt;sub-deployment-name&gt;exampleTopic&lt;/sub-deployment-name&gt;
  &lt;jndi-name&gt;weblogic.examples.jms.TopicConnectionFactory&lt;/jndi-name&gt;
  &lt;transaction-params&gt;
   &lt;xa-connection-factory-enabled&gt;true&lt;/xa-connection-factory-enabled&gt;
  &lt;/transaction-params&gt;
 &lt;/connection-factory&gt;
 &lt;queue name="exampleQueue"&gt;
  &lt;sub-deployment-name&gt;examplesJMSServer&lt;/sub-deployment-name&gt;
  &lt;local-jndi-name&gt;weblogic.examples.jms.exampleQueue&lt;/local-jndi-name&gt;
 &lt;/queue&gt;
 &lt;topic name="exampleTopic"&gt;
  &lt;sub-deployment-name&gt;examplesJMSServer&lt;/sub-deployment-name&gt;
  &lt;local-jndi-name&gt;weblogic.examples.jms.exampleTopic&lt;/local-jndi-name&gt;
 &lt;/topic&gt;
&lt;/weblogic-jms&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.7.2.1."></a>
<h3 class="title">2.3.7.2.1.JMSコネクションファクトリの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicでは、キューや、トピックごとにコネクションファクトリを作成して利用するようになっているが、JBossではデフォルトで以下のコネクションファクトリがデフォルトで利用可能である。移行後の環境では、デフォルトでJNDIにバインドされている以下のコネクションファクトリを利用するようにプログラムを修正すること

			</p>
<div class="table">
<a name="N15F38"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;XA対応のコネクションファクトリ
				</b>
</p>
<div class="table-contents">
<table summary="XA対応のコネクションファクトリ
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>#</th><th>コネクションファクトリ名</th><th>JBossのJNDIにバンドされているJNDI名</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>hornetq-ra</td><td>java:/JmsXA</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
			
</p>
<div class="table">
<a name="N15F4E"></a>
<p class="title">
<b>Table&nbsp;2.&nbsp;非XAのコネクションファクトリ
				</b>
</p>
<div class="table-contents">
<table summary="非XAのコネクションファクトリ
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>#</th><th>コネクションファクトリ名</th><th>JBossのJNDIにバンドされているJNDI名</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>InVmConnectionFactory</td><td>java:/ConnectionFactory</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">

			以下にWebLogicのコネクションファクトリ設定でxa-connection-factory-enabledがtrueになっていることを想定し、XA対応のコネクションファクトリをルックアップする方法について示す。

			</p>
<div class="figure">
<a name="N15F64"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;WebLogic上でコネクションファクトリをルックアップ
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
  // Defines the JMS connection factory.
  public final static String JMS_FACTORY="weblogic.examples.jms.TopicConnectionFactory";
  ...
  
  public void sendTopicMessage()
       throws NamingException, JMSException
  {
     Context ctx = new InitialContext();
     tconFactory = (TopicConnectionFactory) ctx.lookup(JMS_FACTORY);
     ctx.lookup(JMS_FACTORY);
  }
  ...

				</pre>
</div>
</div>
<p>
<br class="figure-break">

			
</p>
<div class="figure">
<a name="N15F6F"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;WebLogic上でコネクションファクトリをルックアップ
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
  // Defines the JMS connection factory.
  public final static String JMS_FACTORY="java:/JmsXA";
  ...
  
  public void sendTopicMessage()
       throws NamingException, JMSException
  {
     Context ctx = new InitialContext();
     tconFactory = (TopicConnectionFactory) ctx.lookup(JMS_FACTORY);
     ctx.lookup(JMS_FACTORY);
  }
  ...
				</pre>
</div>
</div>
<p>
<br class="figure-break">

			
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>
					WebLogicでは、コネクションファクトリに単位に、ロード
					バランシングの有効化(load-balancing-enabled)およびサーバアフィニティ(server-affinity-enabled)の有効化が設定可能になっている。
					</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>サーバアフィニティを有効化</p>
<p>サーバ インスタンスで、分散送り先の複数のメンバー送り先にまたがってコンシューマまたはプロデューサのロード
								バランシングを実行するときに、同じサーバ インスタンス内で動作する他の物理送り先にまたがるロード
								バランシングを最初に試行するかどうかを指定します。
							</p>
</li>
<li class="listitem">
<p>ロード バランシングを有効化</p>
<p>有効化すると、関連付けられているメッセージ プロデューサは send() または publish()
								が発行されるたびにロード バランシングされます
							</p>
</li>
</ul>
</div>
<p>
					WebLogicではデフォルトでこの設定が有効になっているため、設定を無効化していないかぎり、以下のように設定ファイルに反映されることはない。

					</p>
<div class="figure">
<a name="N15F89"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;WebLogicのロードバランス設定
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;connection-factory name="weblogic.examples.jms.QueueConnectionFactory"&gt;
 &lt;sub-deployment-name&gt;exampleQueue&lt;/sub-deployment-name&gt;
 &lt;jndi-name&gt;weblogic.examples.jms.QueueConnectionFactory&lt;/jndi-name&gt;
 &lt;transaction-params&gt;
  &lt;xa-connection-factory-enabled&gt;false&lt;/xa-connection-factory-enabled&gt;
 &lt;/transaction-params&gt;
 &lt;load-balancing-params&gt;
  &lt;load-balancing-enabled&gt;false&lt;/load-balancing-enabled&gt;
  &lt;server-affinity-enabled&gt;false&lt;/server-affinity-enabled&gt;
 &lt;/load-balancing-params&gt;
&lt;/connection-factory&gt;

						</pre>
</div>
</div>
<p>
<br class="figure-break">
					移行後の環境で、JMSの負荷分散を行う場合は、構築運用ガイド(HornetQ編)の「3.3.5.3.
					サーバサイド負荷分散」及び「3.3.5.5. クライアントサイド負荷分散」を参考に、設定を行う必要がある。
				</p>
</td>
</tr>
</table>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.7.2.2."></a>
<h3 class="title">2.3.7.2.2.JMSキュー設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossの場合は、管理CLIよりキューの登録を行う。WebLogicの以下の設定を参考に、キューの登録設定を行う。
			</p>
<div class="table">
<a name="N15FA1"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;WebLogicのキュー設定
				</b>
</p>
<div class="table-contents">
<table summary="WebLogicのキュー設定
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>#</th><th>queueタグのname属性値</th><th>jndi-nameタグの値</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>exampleQueue</td><td>exampleGlobalQueue</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
			
</p>
<div class="figure">
<a name="N15FB7"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;管理CLIによるキューの登録例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
/subsystem=messaging/hornetq-server=default/jms-queue=exampleQueue:add(entries=["java:jboss/exported/exampleGlobalQueue"])


				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.7.2.3."></a>
<h3 class="title">2.3.7.2.3.JMSトピック設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossの場合は、管理CLIよりトピックの登録を行う。WebLogicの以下の設定を参考に、トピックの登録設定を行う。
			</p>
<div class="table">
<a name="N15FCE"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;WebLogicのキュー設定
				</b>
</p>
<div class="table-contents">
<table summary="WebLogicのキュー設定
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>#</th><th>topicタグのname属性値</th><th>jndi-nameタグの値</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>exampleTopic</td><td>exampleGlobalTopic</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
			
</p>
<div class="figure">
<a name="N15FE4"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;管理CLIによるトピックの登録例
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
/subsystem=messaging/hornetq-server=default/jms-topic=exampleTopic:add(entries=["java:jboss/exported/exampleGlobalTopic"])

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.8."></a>
<h3 class="title">2.3.8.デプロイメント設定</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			weblogicではapp-deployment設定で、アプリケーションのデプロイメント設定を行う。


			</p>
<div class="figure">
<a name="N162AD"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlの構成イメージを以下に示す。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
 &lt;app-deployment&gt;
    &lt;name&gt;monitor&lt;/name&gt;
    &lt;target&gt;insapclstr01,insap01m&lt;/target&gt;
    &lt;module-type&gt;war&lt;/module-type&gt;
    &lt;source-path&gt;/opt/aas/monitor/monitor.war&lt;/source-path&gt;
    &lt;security-dd-model&gt;DDOnly&lt;/security-dd-model&gt;
    &lt;staging-mode&gt;nostage&lt;/staging-mode&gt;
  &lt;/app-deployment&gt;
  
				</pre>
</div>
</div>
<p>
<br class="figure-break">

		
</p>
<p>
			本書では、以下について示す

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>JBossのデプロイメントについて</p>
</li>
<li class="listitem">
<p>デプロイメント順序</p>
</li>
</ul>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.8.1."></a>
<h3 class="title">2.3.8.1.JBossのデプロイメントについて</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossはデプロイメントを制御する方法として、以下のような２つの機能を提供している。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>自動デプロイ(Auto-deploy)</p>
<p>デプロイメントスキャナは、デプロイメントディレクトリ（$jboss.server.bae.dir/deployments）を定期的にチェックし、デプロイメントの存在を確認し、新しいデプロイメントや、差分があればロードして、デプロイ・再デプロイを行う。</p>
</li>
<li class="listitem">
<p>手動デプロイ（Manual deploy）</p>
<p>デプロイメントスキャナはデプロイメントディレクトリにあるコンテンツ自体を監視しません。その代わりに、スキャナはマーカーファイルシステムに依存し、そのマーカーファイルの追加または削除されることをコマンドとしてスキャナへ伝えることによって、コンテンツをアンデプロイまたは再デプロイを決定する。</p>
</li>
</ul>
</div>
<p>
			自動デプロイは、アプリケーションの開発時は非常に便利な機能になるが、商用環境では、それぞれのシステムの運用要件に応じて、自動デプロイを実施しないなどの設定変更が必要になる。
			
			</p>
<div class="figure">
<a name="N162DA"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;デプロイメントスキャナ無効化手順(サーバ起動時のみデプロイを行いたい場合は、scan-enabledプロパティをfalseに設定する
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
/subsystem=deployment-scanner/scanner=default/scanner=default:write-attribute(name=scan-enabled,value=false)

				</pre>
</div>
</div>
<p>
<br class="figure-break">
            
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.8.2."></a>
<h3 class="title">2.3.8.2.デプロイメント順序について</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicのデプロイメント順序は各デプロイメントごとに、deployment-orderに数値を設定し、デプロイメント順の値が低いものが、高いものより先にデプロイされる。

			</p>
<div class="figure">
<a name="N162F1"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlの構成イメージを以下に示す。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
 &lt;app-deployment&gt;
    &lt;name&gt;webappCachingEar&lt;/name&gt;
    &lt;target&gt;examplesServer&lt;/target&gt;
    &lt;module-type&gt;ear&lt;/module-type&gt;
    &lt;source-path&gt;/root/bea-new/weblogic92/samples/server/examples/build/webappCachingEar&lt;/source-path&gt;
    &lt;deployment-order&gt;100&lt;/deployment-order&gt;
    &lt;security-dd-model&gt;DDOnly&lt;/security-dd-model&gt;
  &lt;/app-deployment&gt;
  &lt;app-deployment&gt;
    &lt;name&gt;jdbcRowSetsEar&lt;/name&gt;
    &lt;target&gt;examplesServer&lt;/target&gt;
    &lt;module-type&gt;ear&lt;/module-type&gt;
    &lt;source-path&gt;/root/bea-new/weblogic92/samples/server/examples/build/jdbcRowSetsEar&lt;/source-path&gt;
    &lt;deployment-order&gt;1001&lt;/deployment-order&gt;
    &lt;security-dd-model&gt;DDOnly&lt;/security-dd-model&gt;
  &lt;/app-deployment&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">


		
</p>
<p>
			JBossの場合は、デプロイメント全体で数値による順序の制御はできない。デプロイメンの順序を制御できるのはEARのみである。
			EARが依存するearのファイル名を指定することで、デプロイメントの順序制御が可能である。
			</p>
<div class="figure">
<a name="N162FE"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;EARのMETA-INFフォルダにjboss-deployment-dependencies.xmlを作成し、dependencyタグのname属性でEARのファイル名を指定する。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;jboss umlns="urn:jboss:1.0"&gt;
  &lt;jboss-deployment-dependencies xmlns="urn:jboss:deployment-dependencies:1.0"&gt;
    &lt;dependency name="first.ear" /&gt;
  &lt;/jboss-deployment-dependencies&gt;
&lt;/jboss&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
            
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>本設定はJBoss EAP6.1.xから使用可能となっていますので、ご注意ください</p>
</td>
</tr>
</table>
</div>
<p>
            
		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.9."></a>
<h3 class="title">2.3.9.自動チューニング設定</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicはワークマネージャ機能を提供しており、自動チューニング(self-tuning)が可能になっている。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>スレッド制約（max-threads-constraint）</p>
</li>
</ul>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_2.3.9.1."></a>
<h3 class="title">2.3.9.1.スレッド制約</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>スレッド制約(max-threads-constraint)をデータソースに適用することができる。「default」の名前で、ワークマネージャを設定すると、デフォルトのワークマネージャの設定を変更することができる
        
        </p>
<div class="figure">
<a name="N1632A"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlの構成イメージを以下に示す。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;self-tuning&gt;
    &lt;max-threads-constraint&gt;
      &lt;name&gt;USRPool_MaxThreadsConstraint&lt;/name&gt;
      &lt;target&gt;target1&lt;/target&gt;
      &lt;count&gt;-1&lt;/count&gt;
      &lt;connection-pool-name&gt;TestDataSource&lt;/connection-pool-name&gt;
    &lt;/max-threads-constraint&gt;

    &lt;work-manager&gt;
      &lt;name&gt;default&lt;/name&gt;
      &lt;target&gt;target1&lt;/target&gt;
      &lt;max-threads-constraint&gt;USRPool_MaxThreadsConstraint&lt;/max-threads-constraint&gt;
      &lt;ignore-stuck-threads&gt;false&lt;/ignore-stuck-threads&gt;
    &lt;/work-manager&gt;
  &lt;/self-tuning&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
        
</p>
<p>JBossには自動チューニング機能は存在しないため、チューニングを行い、データソースのコネクションプールの最大値を決定する必要がある。　データソースの設定方法については、「データソースの移行」を参照。</p>
</div>
<br>
<br>
<a name="tubame_2.4."></a>
<h3 class="title">2.4.アプリケーションサーバにおけるWebアプリケーション設定</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではweblogic.xmlを利用してWebアプリケーションごとに以下の設定が可能である。
			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>セッションに関連するパラメータ(session-descriptor)</p>
</li>
<li class="listitem">
<p>JSPに関連するパラメータ(jsp-descriptor)</p>
</li>
<li class="listitem">
<p>コンテナに関連するパラメータ(container-descriptor)</p>
</li>
<li class="listitem">
<p>ワークマネージャーに関連するパラメータ(work-manager)</p>
</li>
<li class="listitem">
<p>charset設定</p>
</li>
</ul>
</div>
<p>

			WebLogicではweblogic-application.xmlを利用してWebアプリケーションごとに以下の設定が可能である。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>起動時終了時のリスナ</p>
</li>
</ul>
</div>
<p>

			本章では、weblogic.xml及びweblogic-applicationで行っている設定をJBossで実施する方法について記載する

		</p>
</div>
<br>
<br>
<a name="tubame_2.4.1."></a>
<h3 class="title">2.4.1.セッションに関連するパラメータの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではweblogic.xmlのsession-descriptorより、セッションに関連する以下の項目のが設定可能である。
			なお、一部のパラメータは、weblogic-application.xmlでも同じパラメータで設定可能となっている。
			セッションタイムアウト設定、セッション永続化設定については、weblogic-application.xmlでのみであるが、セッションに関連するパラメータとして合わせ記載する。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>クッキーの有効/無効化(cookies-enabled)</p>
</li>
<li class="listitem">
<p>クッキー名の設定(cookie-name)</p>
</li>
<li class="listitem">
<p>クッキーのパス設定(cookie-path)</p>
</li>
<li class="listitem">
<p>URLリライティング(url-rewriting-enabled)</p>
</li>
<li class="listitem">
<p>セッションIDの長さ設定(id-length)</p>
</li>
<li class="listitem">
<p>セッションタイムアウト設定(timeout-secs)</p>
</li>
<li class="listitem">
<p>セッション永続化設定(persistent-store-type)</p>
</li>
</ul>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_2.4.1.1."></a>
<h3 class="title">2.4.1.1.クッキーの有効/無効化設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではcookies-enabledの制御により、Webアプリケーション単位で、クッキーを利用したセッション管理を利用する制御ができる。
		</p>
<p>
			JBossの場合は、web.xmlのsession-configのtracking-modeにCOOKIEとすることで、クッキーを利用したセッション管理になり、URLにSessionIDを付与されることを防ぐことができる。

			</p>
<div class="figure">
<a name="N16157"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;web.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;

	&lt;session-config&gt;
		&lt;!-- セッションIDがURLにエンコーディングされるのを抑止する --&gt;
		&lt;tracking-mode&gt;COOKIE&lt;/tracking-mode&gt;
	&lt;/session-config&gt;
&lt;/web-app&gt;


				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_2.4.1.2."></a>
<h3 class="title">2.4.1.2.クッキー名の設定移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではWebアプリケーション単位に、クッキーに設定されるセッションID名(デフォルトでJSESSIONID)を任意に変更することが出来る。</p>
<p>JBossでは、 web.xmlのcookie-configタグ配下にnameを設定することで、クッキーに設定されるセッションID名を変更することができる
        
        </p>
<div class="figure">
<a name="N16170"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;web.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;

	&lt;session-config&gt;
		
		&lt;cookie-config&gt;
		  &lt;name&gt;HOGEJSESSIONID&lt;/name&gt;　
		&lt;/cookie-config&gt;

	&lt;/session-config&gt;
&lt;/web-app&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
        
</p>
</div>
<br>
<br>
<a name="tubame_2.4.1.3."></a>
<h3 class="title">2.4.1.3.クッキーのパス設定移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではWebアプリケーション単位に、セッションのクッキーパスを任意に変更することが出来る。
		</p>
<p>
			JBossでは、 web.xmlのcookie-configタグ配下にpathを設定することで、任意にクッキー名を変更することができる

			</p>
<div class="figure">
<a name="N16189"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;web.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;

	&lt;session-config&gt;
		
		&lt;cookie-config&gt;
			&lt;path&gt;/myPath&lt;/path&gt;
		&lt;/cookie-config&gt;

	&lt;/session-config&gt;
&lt;/web-app&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_2.4.1.4."></a>
<h3 class="title">2.4.1.4.URLリライティング設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではWebアプリケーション単位にURL
			書き換えの制御が可能である。デフォルトはtrueであり、セッション ID が URL
			にエンコーディングされ、クッキーがブラウザで無効の場合にセッション トラッキングが実行される。</p>
<p>
			JBossでは、デフォルトでURL 書き換えが有効であり、URLエンコーディング時に、セッション ID が URL
			にエンコーディングされる。セッション ID が URL
			にエンコーディングされるのを抑止する場合は、web.xmlのsession-configのtracking-modeにCOOKIEを付与する。

			</p>
<div class="figure">
<a name="N161A2"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;web.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;

	&lt;session-config&gt;
		&lt;!-- セッションIDがURLにエンコーディングされるのを抑止する --&gt;
		&lt;tracking-mode&gt;COOKIE&lt;/tracking-mode&gt;
	&lt;/session-config&gt;
&lt;/web-app&gt;


				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_2.4.1.5."></a>
<h3 class="title">2.4.1.5.セッションIDの長さ設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではWebアプリケーションに対して、セッションIDのサイズを設定することが出来る。デフォルトでは52バイトである。また、最小値は&rdquo;8バイト&rdquo;である。</p>
<p>JBossでは、JMXで以下のMBeanオブジェクト名で、sessionIdLength属性を更新することで、セッションIDのサイズを変更することができる。デフォルトは16である。
        
        			</p>
<div class="table">
<a name="N161BB"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;config.xmlのjtaタグで定義されている設定とJBossの対応
				</b>
</p>
<div class="table-contents">
<table summary="config.xmlのjtaタグで定義されている設定とJBossの対応
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>#</th><th>MBeanオブジェクト名</th><th>属性</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>jboss.web:type=Manager,path=/コンテキスト名,host=default-host</td><td>sessionIdLength</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
        
</p>
</div>
<br>
<br>
<a name="tubame_2.4.1.6."></a>
<h3 class="title">2.4.1.6.セッションタイムアウト設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではweblogic-application.xmlのtimeout-secsでセッションタイムアウトを設定できる。デフォルトでは3600秒（60分）である</p>
<p>JBossでは、 web.xmlにsession-timeoutを設定することで、セッションタイムアウトを変更することができる。デフォルトでは30（分）である。
        
        </p>
<div class="figure">
<a name="N161DF"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;web.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					

&lt;web-app version="3.0" xmlns="http://java.sun.com/xml/ns/javaee"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd"&gt;

	&lt;session-config&gt;
		
		&lt;session-timeout&gt;60&lt;/session-timeout&gt;

	&lt;/session-config&gt;
&lt;/web-app&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
        
</p>
</div>
<br>
<br>
<a name="tubame_2.4.1.7."></a>
<h3 class="title">2.4.1.7.セッション永続化設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicでは、weblogic-application.xmlのpersistent-store-typeの設定でHTTPセッションの永続化設定を行う。
			persistent-store-typeにはmemory、file、jdbc、cookie及びreplicated、replicated_if_clusteredが設定できる。
			つまり、HTTPセッションの永続化先として、メモリ、ファイル、データベースをサポートしている。デフォルトでは、HTTPセッションの永続化先として、メモリが採用される。


			</p>
<div class="figure">
<a name="N161F6"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic-application.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;weblogic-application xmlns="http://www.bea.com/ns/weblogic/90"&gt;
   
 &lt;session-descriptor&gt;	
     &lt;persistent-store-type&gt;memory&lt;/persistent-store-type&gt;
     &lt;sharing-enabled&gt;true&lt;/sharing-enabled&gt;
   
 &lt;/session-descriptor&gt;

&lt;/weblogic-application&gt;
				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>JBossはデフォルトでメモリが採用される。</p>
</div>
<br>
<br>
<a name="tubame_2.4.2."></a>
<h3 class="title">2.4.2.JSPに関連するパラメータの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではweblogic.xmlのjsp-descriptorより、JSPに関連する以下の項目のが設定可能である。WebLogicのJSPに関連する設定項目とJBossの対応について示す。
			</p>
<div class="figure">
<a name="N160D0"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;weblogic-web-app
  xmlns="http://www.bea.com/ns/weblogic/90"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:j2ee="http://java.sun.com/xml/ns/j2ee"
  xsi:schemaLocation="http://www.bea.com/ns/weblogic/90 http://www.bea.com/ns/weblogic/90/weblogic-web-app.xsd"&gt;


  &lt;jsp-descriptor&gt;
    &lt;page-check-seconds&gt;-1&lt;/page-check-seconds&gt;
    &lt;verbose&gt;false&lt;/verbose&gt;
    &lt;print-nulls&gt;false&lt;/print-nulls&gt;
  &lt;/jsp-descriptor&gt;

&lt;/weblogic-web-app&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">

			
			
</p>
<div class="table">
<a name="N160DB"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;WebLogicのJSPに関連する設定項目とJBossの対応について
				</b>
</p>
<div class="table-contents">
<table summary="WebLogicのJSPに関連する設定項目とJBossの対応について
				" border="1">
<colgroup>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>#</th><th>WebLogic設定</th><th>設定内容</th><th>JBoss設定</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>page-check-seconds</td><td>JSP ファイルが変更されたために再コンパイルする必要があるかどうかをチェックする間隔を秒単位で設定する
							</td><td>&nbsp;</td>
</tr>
<tr>
<td>2</td><td>verbose</td><td>デバッグ情報をログに表示</td><td>該当機能JBossなし</td>
</tr>
<tr>
<td>3</td><td>print-nulls</td><td>false に設定すると、"null" を含む式は " "
								として出力される。
							</td><td>詳細は「JSPの移行を参照」</td>
</tr>
<tr>
<td>4</td><td>precompile</td><td>true に設定すると、Web アプリケーションのデプロイ (再デプロイ) 時または WebLogic
								Server
								の起動時に、変更されたすべての JSP が自動的にあらかじめコンパイルされる。
							</td><td>デプロイ時にすべてのJSPを自動でプリコンパイルする機能はJBossにない</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">

			JBossにおけるjspに関連する設定項目はhttp://docs.jboss.org/jbossweb/7.0.x/config/jsp.html より確認できる。
			WebLogicのpage-check-secondsと同等のパラメータは、web.xmlのinit-paramにcheckIntervalとして設定可能である。デフォルトは0であり、チェックしない。

			</p>
<div class="figure">
<a name="N1610F"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;web.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;web-app xmlns:j2ee="http://java.sun.com/xml/ns/j2ee"&gt;
	&lt;servlet&gt;
		&lt;servlet-name&gt;jsp&lt;/servlet-name&gt;
		&lt;servlet-class&gt;org.apache.jasper.servlet.JspServlet&lt;/servlet-class&gt;
		&lt;init-param&gt;
			&lt;param-name&gt;checkInterval&lt;/param-name&gt;
			&lt;param-value&gt;30&lt;/param-value&gt;
		&lt;/init-param&gt;
	&lt;/servlet&gt;
	&lt;servlet-mapping&gt;
		&lt;servlet-name&gt;jsp&lt;/servlet-name&gt;
		&lt;url-pattern&gt;*.jsp&lt;/url-pattern&gt;
	&lt;/servlet-mapping&gt;
	
	&lt;error-page&gt;
		&lt;error-code&gt;500&lt;/error-code&gt;
		&lt;location&gt;/error.jsp&lt;/location&gt;
	&lt;/error-page&gt;
&lt;/web-app&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
			
		
</p>
</div>
<br>
<br>
<a name="tubame_2.4.3."></a>
<h3 class="title">2.4.3.コンテナに関連するパラメータの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicではweblogic.xmlのcontainer-descriptorより、コンテナに関連する以下の項目が設定可能である。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>セッションモニタリングの制御(session-monitoring-enabled)</p>
<p>session-monitoring-enabledを true に設定することで、セッションの実行時 MBean を作成でき、セッションのモニタリングが可能である。</p>
</li>
</ul>
</div>
<p>
			
			
</p>
<div class="figure">
<a name="N1612D"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;config.xmlの構成イメージを以下に示す。
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;weblogic-application xmlns="http://www.bea.com/ns/weblogic/90"&gt;

   &lt;container-descriptor&gt;
    &lt;session-monitoring-enabled&gt;true&lt;/session-monitoring-enabled&gt;
   &lt;/container-descriptor&gt;

&lt;/weblogic-application&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
            
		
</p>
</div>
<br>
<br>
<a name="tubame_2.4.3.1."></a>
<h3 class="title">2.4.3.1.セッションモニタリングの制御設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicでは weblogic.xmlのsession-monitoring-enabled要素を true に設定することで、セッションの実行時 MBean を作成でき、セッションのモニタリングが可能である。</p>
<p>JBossでは、起動オプションに、-Dorg.apache.tomcat.util.ENABLE_MODELER=trueすることで,セッションのモニタリングが以下MBeanより可能になる。
        
        </p>
<div class="table">
<a name="N16211"></a>
<p class="title">
<b>Table&nbsp;1.&nbsp;MBean「jboss.web:type=Manager,path=/コンテキストパス,host=default-host」の属性(セッションに関連するものを一部抜粋)
				</b>
</p>
<div class="table-contents">
<table summary="MBean「jboss.web:type=Manager,path=/コンテキストパス,host=default-host」の属性(セッションに関連するものを一部抜粋)
				" border="1">
<colgroup>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th>#</th><th>属性名</th><th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td><td>activeSessions</td><td>使用中のセッションの数</td>
</tr>
<tr>
<td>2</td><td>expiredSessions</td><td>破棄されたセッションの数</td>
</tr>
<tr>
<td>3</td><td>maxActive</td><td>セッションがアクティブになった最大値</td>
</tr>
<tr>
<td>4</td><td>maxActiveSessions</td><td>作成可能なセッション数の最大値</td>
</tr>
<tr>
<td>5</td><td>rejectedSessions</td><td>リジェクトされたセッション数</td>
</tr>
<tr>
<td>6</td><td>sessionAverageAliveTime</td><td>セッションの生存期間のアベレージ</td>
</tr>
<tr>
<td>7</td><td>sessionCounter</td><td>作成されたセッション数</td>
</tr>
<tr>
<td>8</td><td>sessionIdLength</td><td>セッションIDのサイズ</td>
</tr>
<tr>
<td>9</td><td>sessionMaxAliveTimes</td><td>セッションで生存期間がもっと長った時間</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>
<br class="table-break">
            
            
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>JConsoleを利用する際に指定するリモートプロセスは、localhostからのアクセスの場合、「service:jmx:remoting-jmx://localhost:9999」を指定する。 </p>
</td>
</tr>
</table>
</div>
<p>
        
</p>
</div>
<br>
<br>
<a name="tubame_2.4.4."></a>
<h3 class="title">2.4.4.ワークマネージャーに関連するパラメータの移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			WebLogicでは、ワークマネジャーで、WebLogic
			Serverのスレッド制御が可能である。wokr-manangerでは以下の設定が可能である。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>同時接続時の最大スレッド数の制約(max-threads-constraint)</p>
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_2.4.4.1."></a>
<h3 class="title">2.4.4.1.同時接続時の最大スレッド数の制約設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			この設定では、max-threads-constraintタグ内のnameタグで最大接続数を100と設定している。
			ワークマネージャの特徴としては、ひとつの制約設定で、複数のエントリポイントで共有できます。たとえば100に制限された制約を10エントリポイントで共有した場合、統合された
			10のエントリ ポイントからの要求を 100個以下のスレッドで実行します。

			</p>
<div class="figure">
<a name="N1626F"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;?xml version="1.0" encoding="UTF-8"?&gt;

&lt;weblogic-web-app
  xmlns="http://www.bea.com/ns/weblogic/90"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:j2ee="http://java.sun.com/xml/ns/j2ee"
  xsi:schemaLocation="http://www.bea.com/ns/weblogic/90 http://www.bea.com/ns/weblogic/90/weblogic-web-app.xsd"&gt;

  &lt;wl-dispatch-policy&gt;webapp-work-manager&lt;/wl-dispatch-policy&gt;
  &lt;work-manager&gt;
    &lt;name&gt;webapp-work-manager&lt;/name&gt;
    &lt;max-threads-constraint&gt;
      &lt;name&gt;webapp-mtc&lt;/name&gt;
      &lt;count&gt;100&lt;/count&gt;
    &lt;/max-threads-constraint&gt;
  &lt;/work-manager&gt;

&lt;/weblogic-web-app&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
<p>
			JBossの場合は、管理CLIよりWebサブシステムのAJPコネクターのmax-connectionsで、最大接続数の設定を行います。

			</p>
<div class="figure">
<a name="N1627C"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;管理CLI
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
/subsystem=web/connector=ajp/:write-attribute(name=max-connections,value=100)

				</pre>
</div>
</div>
<p>
<br class="figure-break">

			
</p>
<div class="warning" style="margin-left: 0.5in; margin-right: 0.5in;">
<table border="0" summary="Warning">
<tr>
<td valign="top" align="center" rowspan="2" width="25"><img alt="[Warning]" src="images/warning.png"></td><th align="left">Warning</th>
</tr>
<tr>
<td valign="top" align="left">
<p>JBossにはWebLogicと同等なワークマネージャ機能は存在しないが、以下の対応は可能である。
				</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>アプリケーションごとに独立して他との影響をうけないワーカースレッドを持つ場合</p>
<p>AJPコネクタポートを複数定義して、そしてアプリケーションごとに利用するコネクタを分離することができる。
						</p>
</li>
<li class="listitem">
<p>アプリケーションごとに独立して他との影響をうけないワーカースレッドを持つ場合</p>
<p>
							WEB-INF/jboss-web.xml
							にてSemaphoreValveの設定を行い、パラメータconcurrencyで該当アプリケーションの同時並行稼働スレッド数を制限することができる

							</p>
<div class="figure">
<a name="N16295"></a>
<p class="title">
<b>Figure&nbsp;3.&nbsp;jboss-web.xml
								</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
									
&lt;jboss-web&gt;
   &lt;valve&gt;
      &lt;class-name&gt;org.apache.catalina.valves.SemaphoreValve&lt;/class-name&gt;
      &lt;param&gt;
         &lt;param-name&gt;block&lt;/param-name&gt;
         &lt;param-value&gt;false&lt;/param-value&gt;
      &lt;/param&gt;
      &lt;param&gt;
         &lt;param-name&gt;concurrency&lt;/param-name&gt;
         &lt;param-value&gt;10&lt;/param-value&gt;
      &lt;/param&gt;
      &lt;param&gt;
         &lt;param-name&gt;fairness&lt;/param-name&gt;
         &lt;param-value&gt;true&lt;/param-value&gt;
      &lt;/param&gt;
   &lt;/valve&gt;
&lt;/jboss-web&gt;

								</pre>
</div>
</div>
<p>
<br class="figure-break">
						
</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_2.4.5."></a>
<h3 class="title">2.4.5.charset設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicではweblogic.xml のinput-charset要素を用いて、GET データと POST データの読み取りにおける文字エンコーディングを指定できる。
        
        </p>
<div class="figure">
<a name="N163D6"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;weblogic.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
 &lt;input-charset&gt;
     &lt;resource-path&gt;/*&lt;/resource-path&gt;
     &lt;java-charset-name&gt;Windows-31J&lt;/java-charset-name&gt;
 &lt;/input-charset&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
        
</p>
<p>JBossのGETとPOSTデータの文字エンコーディング指定については、「日本語文字化け対応」の「Get及びPostのエンコーディングについて」を参照</p>
</div>
<br>
<br>
<a name="tubame_2.4.6."></a>
<h3 class="title">2.4.6.起動時終了時のリスナ設定の移行</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>WebLogicは、weblogic-application.xmlにてlistener、startup、shutdownタブにより、起動時、終了時のリスナの定義ができる。
		</p>
<p>
			JBossは、WebLogicのようにAPサーバのライフサイクルに応じたリストを登録させるようなAPIは提供していないため、JavaEE標準の機能を利用する。移植方法については、APサーバ固有機能の移行
			の 「WebLogicの起動・停止クラス 」を参照。
		</p>
</div>
<br>
<br>
<a name="tubame_2.5."></a>
<h3 class="title">2.5.日本語文字化け対応</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			サプリケーションサーバは、パラメータのエンコーディング時や、JSPファイルの読み込みなど、エンコーディングを設定することが可能である。
			文字化けが発生する場合は、エンコーディング設定を制御することで、文字化け対応を行う必要がある。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>Get及びPostのエンコーディングについて</p>
</li>
<li class="listitem">
<p>静的コンテンツのエンコーディング</p>
</li>
<li class="listitem">
<p>JSPのエンコーディング</p>
</li>
</ul>
</div>
<p>
			
		
</p>
</div>
<br>
<br>
<a name="tubame_2.5.1."></a>
<h3 class="title">2.5.1.Get及びPostのエンコーディングについて</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JBossのエンコーディングの設定方法について示す。GET リクエストの場合と POST
			リクエストの場合で、エンコーディングの設定方法が異なる。

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>Getリクエスト</p>
<p>AJPコネクタの属性URIEncodingに文字エンコードを設定する。管理CLIでシステムプロパティorg.apache.catalina.connector.URI_ENCODINGに文字コードを設定する</p>
<div class="figure">
<a name="N1636E"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;管理CLI
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
/system-property=org.apache.catalina.connector.URI_ENCODING:add(value="UTF-8")

						</pre>
</div>
</div>
<br class="figure-break">
</li>
<li class="listitem">
<p>Postリクエスト</p>
<p>Postリクエストのエンコーディングを設定する場合、ServletRequest#setCharacterEncoding()メソッドを利用することで、設定することができます。web.xmlで以下のように、filter-class タグに"org.apache.catalina.filters.SetCharacterEncodingFilter" を設定し、encodingに文字コードを設定する。</p>
<div class="figure">
<a name="N1637D"></a>
<p class="title">
<b>Figure&nbsp;2.&nbsp;web.xml
						</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
							
&lt;filter&gt;
      &lt;filter-name&gt;SetCharacterEncoding&lt;/filter-name&gt;
      &lt;filter-class&gt;org.apache.catalina.filters.SetCharacterEncodingFilter&lt;/filter-class&gt;
      &lt;init-param&gt;
          &lt;param-name&gt;encoding&lt;/param-name&gt;
          &lt;param-value&gt;UTF-8&lt;/param-value&gt;
      &lt;/init-param&gt;
  &lt;/filter&gt;
  &lt;filter-mapping&gt;
      &lt;filter-name&gt;SetCharacterEncoding&lt;/filter-name&gt;
      &lt;url-pattern&gt;/*&lt;/url-pattern&gt;
  &lt;/filter-mapping&gt;
&lt;/filter&gt;

						</pre>
</div>
</div>
<br class="figure-break">
</li>
</ul>
</div>
<p>
		
</p>
</div>
<br>
<br>
<a name="tubame_2.5.2."></a>
<h3 class="title">2.5.2.静的コンテンツのエンコーディング</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			静的コンテンツ（*.html,*.txtなど）を読み込む場合は、DefaultServletのfileEncodingを使用することにより、エンコーディングを指定する。

			</p>
<div class="figure">
<a name="N16394"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;web.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;servlet&gt;
  &lt;servlet-name&gt;default&lt;/servlet-name&gt;
  &lt;servlet-class&gt;org.apache.catalina.servlets.DefaultServlet&lt;/servlet-class&gt;
  &lt;init-param&gt;
    &lt;param-name&gt;fileEncoding&lt;/param-name&gt;
    &lt;param-value&gt;EUC-JP&lt;/param-value&gt;
  &lt;/init-param&gt;
&lt;/servlet&gt;


				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
<a name="tubame_2.5.3."></a>
<h3 class="title">2.5.3.JSPのエンコーディング</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JSPのエンコーディングは以下について示す

			</p>
<div class="itemizedlist">
<ul class="itemizedlist" style="list-style-type: disc; ">
<li class="listitem">
<p>ページエンコーディングの一括設定</p>
</li>
<li class="listitem">
<p>JSP仕様変更によるIncludeディレクティブを使用している場合の対応</p>
</li>
</ul>
</div>
<p>

		
</p>
</div>
<br>
<br>
<a name="tubame_2.5.3.1."></a>
<h3 class="title">2.5.3.1.ページエンコーディングの一括設定</h3>
<br>
<div class="section">
<div class="titlepage"></div>
<p>
			JSP2.0で導入されたpage-encoding要素をweb.xmlに設定することで、ページエンコーディングの一括設定が可能である

			</p>
<div class="figure">
<a name="N163BF"></a>
<p class="title">
<b>Figure&nbsp;1.&nbsp;web.xml
				</b>
</p>
<div class="figure-contents">
<pre class="programlisting">
					
&lt;jsp-config&gt;
&lt;jsp-property-group&gt;
    &lt;url-pattern&gt;*&lt;/url-pattern&gt;
    &lt;page-encoding&gt;EUC-JP&lt;/page-encoding&gt;
  &lt;/jsp-property-group&gt;
&lt;/jsp-config&gt;

				</pre>
</div>
</div>
<p>
<br class="figure-break">
		
</p>
</div>
<br>
<br>
</BODY>
</HTML>
